<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>ç­”é¢˜æ¸¸æˆ</title>
  <style>
    /* å…¨å±€é‡ç½® */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      font-family: "Helvetica Neue", Arial, sans-serif;
    }
    body {
      background: #121212;
      color: #ffffff;
      min-height: 100vh;
      padding: 16px;
      overflow-x: hidden;
    }
    /* æ¸¸æˆä¸»å®¹å™¨ */
    .game-container {
      max-width: 500px;
      margin: 0 auto;
      background: #1e1e1e;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      position: relative;
      z-index: 10;
    }
    /* æ ‡é¢˜æ  */
    .game-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .game-title {
      font-size: 22px;
      color: #ffd700;
      margin-bottom: 8px;
    }
    .game-subtitle {
      font-size: 14px;
      color: #aaaaaa;
    }
    /* é¢˜ç›®åŒºåŸŸ */
    .question-area {
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .question-text {
      font-size: 18px;
      color: #ffffff;
      text-align: center;
      margin-bottom: 8px;
    }
    .round-info {
      font-size: 14px;
      color: #888888;
      text-align: right;
    }
    /* é€‰é¡¹ç½‘æ ¼ï¼ˆå¼ºåˆ¶2åˆ—ï¼Œå…±4å¼ å›¾ï¼‰ */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .option-item {
      background: #2d2d2d;
      border-radius: 12px;
      padding: 8px;
      aspect-ratio: 1/1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
      min-height: 120px;
    }
    .option-item:active {
      border-color: #ffd700;
    }
    .option-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    .img-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888888;
      font-size: 14px;
      background: #333333;
      border-radius: 8px;
    }
    /* çŠ¶æ€æ ï¼ˆåˆ†æ•°+å€’è®¡æ—¶ï¼‰ */
    .status-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .status-item {
      text-align: center;
    }
    .status-label {
      font-size: 12px;
      color: #888888;
      margin-bottom: 4px;
    }
    .status-value {
      font-size: 20px;
      color: #ffd700;
      font-weight: bold;
    }
    /* æŒ‰é’®æ ·å¼ï¼ˆæ‰‹æœºç«¯è¶…å¤§ç‚¹å‡»åŒºåŸŸï¼‰ */
    .btn-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    .game-btn {
      flex: 1;
      padding: 16px 0;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      touch-action: manipulation;
      min-height: 48px;
    }
    .btn-primary {
      background: #ffd700;
      color: #121212;
    }
    .btn-secondary {
      background: #444444;
      color: #ffffff;
    }
    /* æ¶ˆæ¯æç¤º */
    .message-box {
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
      font-size: 16px;
    }
    .msg-win {
      background: #006400;
      color: #ffffff;
    }
    .msg-lose {
      background: #8b0000;
      color: #ffffff;
    }
    .msg-normal {
      background: #2d2d2d;
      color: #aaaaaa;
    }
    /* å¹¿å‘ŠåŒºåŸŸ + é—ªçƒåŠ¨ç”» */
    .ad-section {
      margin-bottom: 16px;
      padding: 16px;
      background: #2d2d2d;
      border-radius: 12px;
      position: relative;
      animation: adFlash 1.5s infinite alternate; /* å¹¿å‘Šé—ªçƒ */
    }
    @keyframes adFlash {
      from { opacity: 1; }
      to { opacity: 0.8; box-shadow: 0 0 15px rgba(255, 99, 71, 0.5); }
    }
    .ad-close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .ad-title {
      font-size: 16px;
      color: #ffd700;
      margin-bottom: 12px;
      text-align: center;
    }
    /* å¹¿å‘Šå°é¢GIFå®¹å™¨ */
    .ad-cover {
      width: 100%;
      height: 120px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ad-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .ad-cta {
      display: block;
      width: 100%;
      padding: 12px 0;
      background: #ff6347;
      color: #ffffff;
      text-align: center;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 8px;
    }
    /* å¼¹çª—åŸºç¡€æ ·å¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
    }
    .modal-container {
      background: #1e1e1e;
      border-radius: 16px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
    }
    .modal-title {
      font-size: 20px;
      color: #ffd700;
      text-align: center;
      margin-bottom: 20px;
    }
    .modal-btn-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    .modal-btn {
      flex: 1;
      padding: 12px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    /* å¹¿å‘Šå›¾ç‰‡å¼¹çª— */
    .ad-img-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
    }
    .ad-img-content {
      max-width: 90%;
      max-height: 80%;
      border-radius: 12px;
      overflow: hidden;
    }
    .ad-img-content img {
      width: 100%;
      height: auto;
    }
    .ad-img-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* æˆå°±å¢™æ ·å¼ + éšè—æˆå°±é€»è¾‘ */
    .achievement-wall {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #121212;
      z-index: 300;
      padding: 20px;
      overflow-y: auto;
      display: none;
    }
    .achievement-wall.show {
      display: block;
    }
    .achievement-wall-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .achievement-wall-title {
      font-size: 22px;
      color: #ffd700;
    }
    .achievement-close-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
    }
    .achievement-item {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 4px solid #ffd700;
    }
    .achievement-name {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 4px;
    }
    .achievement-desc {
      font-size: 14px;
      color: #aaaaaa;
      margin-bottom: 4px;
    }
    .achievement-method {
      font-size: 12px;
      color: #ff6347;
      display: none; /* æœªè·å¾—æ—¶éšè—æ–¹æ³• */
    }
    .achievement-item.unlocked .achievement-method {
      display: block; /* è·å¾—åæ˜¾ç¤ºæ–¹æ³• */
    }
    .achievement-item.hidden {
      border-left-color: #9932cc; /* éšè—æˆå°±ç‰¹æ®Šè¾¹æ¡† */
    }
    /* éšè—å…ƒç´  */
    .hidden {
      display: none !important;
    }
    /* éŸ³é¢‘æ§ä»¶éšè— */
    audio {
      display: none;
    }
  </style>
</head>
<body>
  <!-- éŸ³é¢‘å…ƒç´ ï¼ˆéšè—ï¼Œæ‰‹æœºç«¯å…¼å®¹mp3æ ¼å¼ï¼‰ -->
  <audio id="gameBGM" src="game_bgm.mp3" preload="auto" loop></audio> <!-- æ¸¸æˆè½»æ¾BGM -->
  <audio id="ad1BGM" src="ad1_bgm.mp3" preload="auto" loop></audio> <!-- å¹¿å‘Š1å¯çˆ±BGM -->
  <audio id="ad2BGM" src="ad2_bgm.mp3" preload="auto" loop></audio> <!-- å¹¿å‘Š2éªšæ°”BGM -->
  <audio id="correctSound" src="correct_sound.mp3" preload="auto"></audio> <!-- ç­”é¢˜æ­£ç¡®éŸ³æ•ˆ -->
  <audio id="wrongSound" src="wrong_sound.mp3" preload="auto"></audio> <!-- ç­”é¢˜é”™è¯¯éŸ³æ•ˆ -->

  <!-- æ¸¸æˆä¸»å®¹å™¨ -->
  <div class="game-container">
    <!-- æ ‡é¢˜æ  -->
    <div class="game-header">
      <h1 class="game-title">ç­”é¢˜æŒ‘æˆ˜</h1>
      <p class="game-subtitle">ç‚¹å‡»æ­£ç¡®é€‰é¡¹ï¼Œèµ¢å–åˆ†æ•°</p>
    </div>

    <!-- é¢˜ç›®åŒºåŸŸ -->
    <div class="question-area">
      <p class="question-text" id="questionText">å‡†å¤‡å¼€å§‹æ¸¸æˆ</p>
      <p class="round-info">å…³å¡: <span id="roundNum">0</span></p>
    </div>

    <!-- é€‰é¡¹ç½‘æ ¼ï¼ˆå¼ºåˆ¶4å¼ å›¾ï¼‰ -->
    <div class="options-grid" id="optionsGrid"></div>

    <!-- æ¶ˆæ¯æç¤º -->
    <div class="message-box msg-normal" id="messageBox">ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜</div>

    <!-- çŠ¶æ€æ  -->
    <div class="status-bar">
      <div class="status-item">
        <p class="status-label">åˆ†æ•°</p>
        <p class="status-value" id="scoreNum">0</p>
      </div>
      <div class="status-item">
        <p class="status-label">å€’è®¡æ—¶</p>
        <p class="status-value" id="timerNum">--</p>
      </div>
    </div>

    <!-- æŒ‰é’®ç»„ -->
    <div class="btn-group">
      <button class="game-btn btn-primary" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="resetBtn">é‡ç½®æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="achievementBtn">æˆå°±å¢™</button>
      <button class="game-btn btn-secondary" id="resetAchieveBtn">é‡ç½®æˆå°±</button>
    </div>

    <!-- åŸæœ‰å¹¿å‘ŠåŒºåŸŸï¼ˆæ˜¾ç¤ºå¹¿å‘Šå°é¢GIFï¼‰ -->
    <div class="ad-section" id="originalAd">
      <button class="ad-close-btn" id="originalAdClose">Ã—</button>
      <h3 class="ad-title">å¿«â¤ï¸è¿›â¤ï¸æ¥â¤ï¸</h3>
      <!-- å¹¿å‘Šå°é¢GIF -->
      <div class="ad-cover">
        <img src="å¹¿å‘Šå°é¢.gif" alt="å¹¿å‘Šå°é¢" id="adCoverGif">
      </div>
      <a href="javascript:;" class="ad-cta" id="originalAdCta">ç‚¹å‡»æŸ¥çœ‹éšæœºå¹¿å‘Šå›¾</a>
    </div>

    <!-- æ–°å¹¿å‘ŠåŒºåŸŸï¼ˆç«çƒ­æ¢è£…ï¼‰ -->
    <div class="ad-section" id="newAd">
      <button class="ad-close-btn" id="newAdClose">Ã—</button>
      <h3 class="ad-title">â™‚â™‚ç«çƒ­æ¢è£…  åœ¨çº¿æ¼«ç”»â™‚â™‚</h3>
      <a href="javascript:;" class="ad-cta" id="newAdCta">ç‚¹å‡»æŸ¥çœ‹ç²¾å½©å†…å®¹</a>
    </div>
  </div>

  <!-- å¹¿å‘Šå…³é—­ç¡®è®¤å¼¹çª— -->
  <div class="modal-overlay hidden" id="adConfirmModal">
    <div class="modal-container">
      <h3 class="modal-title">ä¸è¿›æ¥çœ‹çœ‹å—ï¼Ÿ</h3>
      <div class="modal-btn-group">
        <button class="modal-btn btn-primary" id="adConfirmBtn">å¥½å§ï¼Œæ¥äº†â¤ï¸</button>
        <button class="modal-btn btn-secondary" id="adCancelBtn">å‘ƒâ†“ï¼Œæˆ‘æ˜¯ç›´ç”·</button>
      </div>
    </div>
  </div>

  <!-- é‡ç½®æˆå°±ç¡®è®¤å¼¹çª— -->
  <div class="modal-overlay hidden" id="resetAchieveModal">
    <div class="modal-container">
      <h3 class="modal-title">æ˜¯å¦é‡ç½®æˆå°±ï¼Ÿ</h3>
      <div class="modal-btn-group">
        <button class="modal-btn btn-primary" id="resetAchieveConfirm">æ˜¯</button>
        <button class="modal-btn btn-secondary" id="resetAchieveYeah">yeahâ™‚</button>
      </div>
    </div>
  </div>

  <!-- å¹¿å‘Šå›¾ç‰‡å¼¹çª— -->
  <div class="ad-img-modal hidden" id="adImgModal">
    <button class="ad-img-close" id="adImgCloseBtn">Ã—</button>
    <div class="ad-img-content" id="adImgContent"></div>
  </div>

  <!-- æˆå°±å¢™ -->
  <div class="achievement-wall" id="achievementWall">
    <div class="achievement-wall-header">
      <h2 class="achievement-wall-title">æˆå°±å¢™</h2>
      <button class="achievement-close-btn" id="achievementWallClose">Ã—</button>
    </div>
    <div id="achievementList"></div>
  </div>

  <script>
    // ========== é…ç½®é¡¹ï¼ˆæ¢å¤åŸæœ‰å†…å®¹+ç§»é™¤å¸•å­—å›¾ç‰‡ï¼‰ ==========
    const CONFIG = {
      // ç­”é¢˜å›¾ç‰‡ç´ æï¼ˆç§»é™¤æ‰€æœ‰å¸¦"å¸•"å­—çš„å›¾ç‰‡ï¼‰
      answerImages: {
        'é…’é¦†ä¼™è®¡': 'é…’é¦†ä¼™è®¡.png',
        'å®‹': 'å®‹.jpg',
        'æœå—': 'æœå—.jpg',
        'Adams': 'Adams.jpg',
        'æ­£ç»è¡£æœ': 'æ­£ç»è¡£æœ.jpg', // ä¿ç•™éå¸•å­—ç´ æ
        'img1': 'img1.jpg',
        'img2': 'img2.jpg',
        'img3': 'img3.jpg',
        'img4': 'img4.jpg'
      },
      // å¹¿å‘Šç´ æï¼ˆæ–°å¹¿å‘Šä»…å«å¸•å­—å›¾ç‰‡ï¼‰
      adMaterials: {
        original: ['å¹¿å‘Š.png', 'å¹¿å‘Š2.jpg', 'å¹¿å‘Š3.jpg'], // åŸæœ‰å¹¿å‘Šç´ æ
        new: ['æ©™å¸•.jpg', 'æ½®ç”·å¸•.jpg', 'æ½®ç”·å¸•çš„åèƒŒ.jpg'], // ä»…å¸•å­—å›¾ç‰‡
        cover: 'å¹¿å‘Šå°é¢.gif'
      },
      // é¢˜åº“ï¼ˆæ¢å¤åŸæœ‰é¢˜ç›®+æ–°å¢é¢˜ç›®ï¼‰
      questions: [
        // åŸæœ‰é¢˜ç›®
        {
          id: 0,
          text: 'æ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç”·åŒ',
          type: 'special',
          onSelect: () => ({ ok: false, msg: 'å“ˆå“ˆéª—ä½ çš„ï¼Œæˆ‘åªè®¾ç½®äº†å•é€‰' })
        },
        {
          id: 1,
          text: 'æ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆ',
          type: 'single',
          correctIdx: 0, // å¯¹åº”img1
          onCorrect: 'ä½ çœ‹èµ·æ¥å¾ˆå¥½åƒ',
          onWrong: 'Cazzoï¼Œä½ ä¸è®¤è¯†æˆ‘å—',
          achievement: 'chef'
        },
        {
          id: 2,
          text: 'æ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ',
          type: 'single',
          correctIdx: 3, // å¯¹åº”img4
          onCorrect: 'éš”å£ä»–ç”·äººåœ¨åŒæŒing',
          onWrong: 'å†é€‰é”™å°±è¿‡æ¥å¿ƒç†æ²»ç–—',
          achievement: 'therapist'
        },
        {
          id: 3,
          text: 'æ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·',
          type: 'multi-text',
          onSelect: (idx) => {
            if (idx === 0 || idx === 1) {
              unlockAchievement('straight');
              return { ok: true, msg: 'ğŸ’æˆ‘ä»¬æ˜¯çœŸæ­£çš„â™‚ç›´ç”·â™‚å‘€' };
            } else {
              unlockAchievement('gayPride');
              return { ok: true, msg: 'ğŸŒˆğŸŒˆğŸŒˆéª„å‚²ä¹‹â™‚GAYğŸŒˆğŸŒˆğŸŒˆ' };
            }
          }
        },
        // æ–°å¢é¢˜ç›®
        {
          id: 4,
          text: 'è°æ²¡æœ‰å¯¹è±¡ï¼Ÿ',
          type: 'single-key',
          correct: 'é…’é¦†ä¼™è®¡',
          msgWin: 'å›ç­”æ­£ç¡®ï¼',
          msgLose: 'å›ç­”é”™è¯¯ï¼',
          achievement: 'pBrother'
        },
        {
          id: 5,
          text: 'é€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€‚',
          type: 'single-key',
          correct: 'å®‹',
          msgWin: 'å®‹é…±å®‹é…±æˆ‘ä»¬å–œæ¬¢ä½ â¤ï¸',
          msgLose: 'å¥½åƒä¹Ÿæ²¡é”™...',
          achievement: 'deepWaterCity'
        },
        {
          id: 6,
          text: 'å¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿ',
          type: 'single-key',
          correct: 'æœå—',
          msgWin: 'æœå“¥è¯·è¡¨æ¼”ä¸€ä¸‹é‚£ä¸ªï¼ğŸ’°ğŸ’°ğŸ’°',
          msgLose: 'ä¸ï¼Œè¿™ä½åº”è¯¥ä¸ä¼šç»™ä½ é’±ã€‚',
          achievement: 'goldCoin'
        },
        {
          id: 7,
          text: 'ä½ å¥½ã€‚è¯·å¬·â€”â€”',
          type: 'single-key',
          correct: 'Adams',
          msgWin: 'â€œæˆ‘å¯æ˜¯ç›´ç”·å‘€ï¼â€',
          msgLose: 'è¯¶ï¼Ÿé‚£ä¹Ÿä¸é”™ã€‚'
        }
      ],
      // æˆå°±é…ç½®ï¼ˆæ¢å¤åŸæœ‰+æ–°å¢+éšè—æˆå°±ï¼‰
      achievements: {
        // åŸæœ‰æˆå°±
        straight: { name: 'æˆ‘æ˜¯ç›´ç”·', desc: 'å‹‡æ•¢æ‰¿è®¤è‡ªå·±çš„èº«ä»½', method: 'é€‰æ‹©ã€Œæ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·ã€é¢˜ç›®ä¸­çš„ç›´ç”·é€‰é¡¹' },
        gayPride: { name: 'éª„å‚²ä¹‹GAY', desc: 'ä¸ºè‡ªå·±çš„èº«ä»½æ„Ÿåˆ°éª„å‚²', method: 'é€‰æ‹©ã€Œæ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·ã€é¢˜ç›®ä¸­çš„GAYé€‰é¡¹' },
        chef: { name: 'ä½ æ˜¯é£Ÿæå—', desc: 'æ‰¾åˆ°çœŸæ­£çš„å¨å¸ˆ', method: 'æ­£ç¡®å›ç­”ã€Œæ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆã€é¢˜ç›®' },
        therapist: { name: 'å¿ƒç†æ²»ç–—å¸ˆ', desc: 'æ‰¾åˆ°å¤±å»çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ', method: 'æ­£ç¡®å›ç­”ã€Œæ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆã€é¢˜ç›®' },
        maxScore: { name: 'å¤©é€‰ç”·åŒğŸŒˆ', desc: 'è¾¾åˆ°æ»¡åˆ†100åˆ†', method: 'åœ¨æ¸¸æˆä¸­è·å¾—100åˆ†' },
        forgotWho: { name: 'å¥½åƒå¿˜äº†è°...', desc: 'æ€»è§‰å¾—æ¼æ‰äº†ä»€ä¹ˆé‡è¦çš„äºº', method: 'è¿ç»­4æ¬¡ä¸é€‰æ‹©img3.jpgå›¾ç‰‡' },
        forceful: { name: 'å¼ºäººæ‰€éš¾â™‚', desc: 'å¯¹æŸä¸ªé€‰é¡¹æœ‰ç€æ‰§ç€çš„åçˆ±', method: 'è¿ç»­4æ¬¡é€‰æ‹©img1.jpgå›¾ç‰‡' },
        omg: { name: 'OMGâ™‚', desc: 'ä½ å‘ç°äº†éšè—çš„ç§˜å¯†ï¼', method: 'é‡ç½®æˆå°±æ—¶é€‰æ‹©"yeahâ™‚"é€‰é¡¹', hidden: true }, // éšè—æˆå°±
        // æ–°å¢æˆå°±
        pBrother: { name: 'P...På¼Ÿï¼Ÿ', desc: 'åœ¨ã€Œè°æ²¡æœ‰å¯¹è±¡ï¼Ÿã€é—®é¢˜ä¸­é€‰æ‹©é…’é¦†ä¼™è®¡', method: 'å›ç­”ã€Œè°æ²¡æœ‰å¯¹è±¡ï¼Ÿã€é—®é¢˜å¹¶é€‰æ‹©é…’é¦†ä¼™è®¡' }, },
        witheredGrass: { name: 'ç”Ÿå‘½ä¸ºä½•è‡ªç§°æ¯è‰ï¼Ÿ', desc: 'è¿ç»­5æ¬¡ä¸é€‰æ‹©Adams', method: 'ç­”é¢˜æ—¶è¿ç»­5æ¬¡ä¸é€‰Adamså›¾ç‰‡' },
        heLovesYou: { name: 'ä»–è¯´ä»–çˆ±ä½ ã€‚', desc: 'æœå—é—®é¢˜ä¸­é€‰æ‹©ç¬¬4å¼ å›¾ç‰‡', method: 'å›ç­”ã€Œå¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿã€æ—¶é€‰ç¬¬4ä¸ªé€‰é¡¹' },
        goldCoin: { name: 'çˆ†ç‚¹é‡‘å¸ï¼Ÿ', desc: 'ç¬¬ä¸€æ¬¡é€‰æ‹©æœå—å¹¶ç­”å¯¹', method: 'é¦–æ¬¡å›ç­”ã€Œå¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿã€æ—¶é€‰å¯¹æœå—' },
        deepWaterCity: { name: 'æ·±æ°´åŸæ•…äº‹', desc: 'æ­£ç¡®å›ç­”ã€Œé€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€', method: 'ç­”å¯¹ã€Œé€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€é—®é¢˜' },
        fashionIcon: { name: 'è¡£å“è¾¾äººâ¤ï¸', desc: 'ç‚¹å¼€æ–°æ·»åŠ çš„å¹¿å‘Š', method: 'ç‚¹å‡»ã€Œâ™‚â™‚ç«çƒ­æ¢è£…ã€å¹¿å‘Šå¹¶æŸ¥çœ‹' },
        schiller: { name: 'Schiller.', desc: 'ç‚¹å¼€åŸæœ‰çš„å¹¿å‘Š', method: 'ç‚¹å‡»åŸæœ‰å¹¿å‘Šå¹¶æŸ¥çœ‹éšæœºå›¾' }
      },
      // æ¸¸æˆå‚æ•°
      timeLimit: 8, // æ¯é¢˜å€’è®¡æ—¶ï¼ˆç§’ï¼‰
      scorePerCorrect: 5, // æ¯é¢˜æ­£ç¡®å¾—åˆ†
      maxScore: 100 // æ»¡åˆ†
    };
// ========== å…¨å±€çŠ¶æ€ï¼ˆæ¢å¤åŸæœ‰ç»Ÿè®¡å˜é‡ï¼‰ ==========
    let gameState = {
      isPlaying: false,
      currentQuestion: null,
      score: 0,
      round: 0,
      timeLeft: 0,
      timer: null,
      // åŸæœ‰ç»Ÿè®¡
      correctCount: 0,
      wrongCount: 0,
      consecutiveImg1Count: 0, // è¿ç»­é€‰img1æ¬¡æ•°
      consecutiveNotImg3Count: 0, // è¿ç»­ä¸é€‰img3æ¬¡æ•°
      // æ–°å¢ç»Ÿè®¡
      consecutiveNotAdams: 0,
      firstChooseChaonan: false,
      hasGotPBrother: false,
      // æˆå°±
      unlockedAchievements: new Set(JSON.parse(localStorage.getItem('unlockedAchievements')) || []),
      triggeredScorePopups: new Set() // å·²è§¦å‘çš„åˆ†æ•°å¼¹çª—
    };

    // ========== DOMå…ƒç´ ï¼ˆæ–°å¢éŸ³é¢‘+é‡ç½®æˆå°±æŒ‰é’®ï¼‰ ==========
    const elements = {
      // éŸ³é¢‘å…ƒç´ 
      gameBGM: document.getElementById('gameBGM'),
      ad1BGM: document.getElementById('ad1BGM'),
      ad2BGM: document.getElementById('ad2BGM'),
      correctSound: document.getElementById('correctSound'),
      wrongSound: document.getElementById('wrongSound'),
      // æ¸¸æˆæ ¸å¿ƒ
      questionText: document.getElementById('questionText'),
      roundNum: document.getElementById('roundNum'),
      optionsGrid: document.getElementById('optionsGrid'),
      messageBox: document.getElementById('messageBox'),
      scoreNum: document.getElementById('scoreNum'),
      timerNum: document.getElementById('timerNum'),
      startBtn: document.getElementById('startBtn'),
      resetBtn: document.getElementById('resetBtn'),
      achievementBtn: document.getElementById('achievementBtn'),
      resetAchieveBtn: document.getElementById('resetAchieveBtn'),
      // å¹¿å‘Š
      originalAd: document.getElementById('originalAd'),
      originalAdClose: document.getElementById('originalAdClose'),
      originalAdCta: document.getElementById('originalAdCta'),
      newAd: document.getElementById('newAd'),
      newAdClose: document.getElementById('newAdClose'),
      newAdCta: document.getElementById('newAdCta'),
      adCoverGif: document.getElementById('adCoverGif'),
      adConfirmModal: document.getElementById('adConfirmModal'),
      adConfirmBtn: document.getElementById('adConfirmBtn'),
      adCancelBtn: document.getElementById('adCancelBtn'),
      adImgModal: document.getElementById('adImgModal'),
      adImgCloseBtn: document.getElementById('adImgCloseBtn'),
      adImgContent: document.getElementById('adImgContent'),
      // é‡ç½®æˆå°±å¼¹çª—
      resetAchieveModal: document.getElementById('resetAchieveModal'),
      resetAchieveConfirm: document.getElementById('resetAchieveConfirm'),
      resetAchieveYeah: document.getElementById('resetAchieveYeah'),
      // æˆå°±å¢™
      achievementWall: document.getElementById('achievementWall'),
      achievementWallClose: document.getElementById('achievementWallClose'),
      achievementList: document.getElementById('achievementList')
    };
// ========== éŸ³é¢‘æ§åˆ¶å‡½æ•°ï¼ˆé€‚é…æ‰‹æœºç«¯æ’­æ”¾è§„åˆ™ï¼‰ ==========
    /** æ’­æ”¾æ¸¸æˆBGM */
    function playGameBGM() {
      pauseAllBGM();
      elements.gameBGM.play().catch(err => {
        console.log('æ¸¸æˆBGMæ’­æ”¾å¤±è´¥ï¼ˆéœ€ç”¨æˆ·äº¤äº’ï¼‰', err);
      });
    }

    /** æ’­æ”¾å¹¿å‘Š1ï¼ˆå¿«è¿›æ¥ï¼‰BGM */
    function playAd1BGM() {
      pauseAllBGM();
      elements.ad1BGM.play().catch(err => {
        console.log('å¹¿å‘Š1BGMæ’­æ”¾å¤±è´¥ï¼ˆéœ€ç”¨æˆ·äº¤äº’ï¼‰', err);
      });
    }

    /** æ’­æ”¾å¹¿å‘Š2ï¼ˆç«çƒ­æ¢è£…ï¼‰BGM */
    function playAd2BGM() {
      pauseAllBGM();
      elements.ad2BGM.play().catch(err => {
        console.log('å¹¿å‘Š2BGMæ’­æ”¾å¤±è´¥ï¼ˆéœ€ç”¨æˆ·äº¤äº’ï¼‰', err);
      });
    }

    /** æš‚åœæ‰€æœ‰BGM */
    function pauseAllBGM() {
      elements.gameBGM.pause();
      elements.ad1BGM.pause();
      elements.ad2BGM.pause();
      // é‡ç½®BGMæ’­æ”¾ä½ç½®ï¼ˆä¸‹æ¬¡æ’­æ”¾ä»å¤´å¼€å§‹ï¼‰
      elements.ad1BGM.currentTime = 0;
      elements.ad2BGM.currentTime = 0;
    }

    /** æ’­æ”¾ç­”é¢˜æ­£ç¡®éŸ³æ•ˆ */
    function playCorrectSound() {
      elements.correctSound.currentTime = 0;
      elements.correctSound.play().catch(err => {
        console.log('æ­£ç¡®éŸ³æ•ˆæ’­æ”¾å¤±è´¥', err);
      });
    }

    /** æ’­æ”¾ç­”é¢˜é”™è¯¯éŸ³æ•ˆ */
    function playWrongSound() {
      elements.wrongSound.currentTime = 0;
      elements.wrongSound.play().catch(err => {
        console.log('é”™è¯¯éŸ³æ•ˆæ’­æ”¾å¤±è´¥', err);
      });
    }

    // ========== å·¥å…·å‡½æ•°ï¼ˆæ¢å¤å›¾ç‰‡åŠ è½½å®¹é”™+æˆå°±å¤„ç†ï¼‰ ==========
    /**
     * å›¾ç‰‡åŠ è½½å®¹é”™ï¼šå¤±è´¥æ—¶æ˜¾ç¤ºå ä½å›¾
     */
    function handleImageError(img, altText) {
      img.onerror = function() {
        const parent = img.parentElement;
        parent.innerHTML = `<div class="img-placeholder">${altText}<br>åŠ è½½å¤±è´¥</div>`;
      };
    }

    /**
     * éšæœºæ‰“ä¹±æ•°ç»„
     */
    function shuffleArray(arr) {
      const newArr = [...arr];
      for (let i = newArr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
      }
      return newArr;
    }

    /**
     * ç”Ÿæˆéšæœº4ä¸ªé€‰é¡¹ï¼ˆå¿…å«æ­£ç¡®ç­”æ¡ˆï¼Œç§»é™¤å¸•å­—å›¾ç‰‡ï¼‰
     */
    function getRandomOptions(correctKey = null, correctIdx = null) {
      const allKeys = Object.keys(CONFIG.answerImages);
      let finalOptions = [];

      if (correctKey) {
        // æ–°å¢é¢˜ç›®ï¼šæŒ‰keyåŒ¹é…
        const otherKeys = allKeys.filter(key => key !== correctKey);
        const randomOthers = shuffleArray(otherKeys).slice(0, 3);
        finalOptions = shuffleArray([...randomOthers, correctKey]);
      } else if (correctIdx !== null) {
        // åŸæœ‰é¢˜ç›®ï¼šæŒ‰ç´¢å¼•åŒ¹é…ï¼ˆimg1/img2/img3/img4ï¼‰
        const imgKeys = ['img1', 'img2', 'img3', 'img4'];
        finalOptions = shuffleArray(imgKeys);
      } else {
        // ç‰¹æ®Šé¢˜ç›®ï¼šéšæœº4ä¸ªéå¸•å­—ç´ æ
        finalOptions = shuffleArray(allKeys).slice(0, 4);
      }
      return finalOptions;
    }

    /**
     * è§£é”æˆå°±ï¼ˆå«éšè—æˆå°±é€»è¾‘ï¼‰
     */
    function unlockAchievement(achievementId) {
      if (gameState.unlockedAchievements.has(achievementId)) return;
      gameState.unlockedAchievements.add(achievementId);
      localStorage.setItem('unlockedAchievements', JSON.stringify(Array.from(gameState.unlockedAchievements)));
      renderAchievementWall();
      // æ˜¾ç¤ºæˆå°±æç¤º
      const achievement = CONFIG.achievements[achievementId];
      showMessage(`è§£é”æˆå°±ï¼š${achievement.name}`, 'win');
    }

    /**
     * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
     */
    function showMessage(text, type = 'normal') {
      elements.messageBox.textContent = text;
      elements.messageBox.className = 'message-box';
      elements.messageBox.classList.add(`msg-${type}`);
    }

    /**
     * æ˜¾ç¤º/éšè—å¼¹çª—
     */
    function toggleModal(modal, show) {
      if (show) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      } else {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    }

    /**
     * æ˜¾ç¤ºåˆ†æ•°é‡Œç¨‹ç¢‘å¼¹çª—ï¼ˆæ¢å¤åŸæœ‰æ»¡åˆ†æˆå°±ï¼‰
     */
    function showScorePopup(score) {
      if (gameState.triggeredScorePopups.has(score)) return;
      gameState.triggeredScorePopups.add(score);
      if (score === 50) {
        showMessage('å·²è·å¾—50åˆ†ï¼ç¦»æ»¡åˆ†ä¸è¿œäº†', 'win');
      } else if (score === CONFIG.maxScore) {
        showMessage('æ»¡åˆ†ï¼è§£é”ã€Œå¤©é€‰ç”·åŒğŸŒˆã€æˆå°±', 'win');
        unlockAchievement('maxScore');
      }
    }

    // ========== æ¸¸æˆæ ¸å¿ƒé€»è¾‘ï¼ˆæ¢å¤åŸæœ‰ç­”é¢˜é€»è¾‘+æ–°å¢éŸ³é¢‘ï¼‰ ==========
    /**
     * åˆå§‹åŒ–æ¸¸æˆ
     */
    function initGame() {
      // ç»‘å®šæŒ‰é’®äº‹ä»¶
      elements.startBtn.addEventListener('click', startGame);
      elements.resetBtn.addEventListener('click', resetGame);
      elements.achievementBtn.addEventListener('click', () => {
        elements.achievementWall.classList.add('show');
        renderAchievementWall();
      });
      elements.achievementWallClose.addEventListener('click', () => {
        elements.achievementWall.classList.remove('show');
      });
      // ç»‘å®šé‡ç½®æˆå°±äº‹ä»¶
      elements.resetAchieveBtn.addEventListener('click', () => {
        toggleModal(elements.resetAchieveModal, true);
      });
      elements.resetAchieveConfirm.addEventListener('click', () => {
        resetAchievements(false);
        toggleModal(elements.resetAchieveModal, false);
      });
      elements.resetAchieveYeah.addEventListener('click', () => {
        resetAchievements(true); // è§¦å‘éšè—æˆå°±
        toggleModal(elements.resetAchieveModal, false);
      });

      // ç»‘å®šå¹¿å‘Šäº‹ä»¶
      bindAdEvents();

      // åˆå§‹åŒ–æˆå°±å¢™
      renderAchievementWall();

      // å¹¿å‘Šå°é¢GIFå®¹é”™
      handleImageError(elements.adCoverGif, 'å¹¿å‘Šå°é¢');

      // é‡ç½®æ¸¸æˆçŠ¶æ€
      resetGame();
    }

    /**
     * å¼€å§‹æ¸¸æˆï¼ˆè§¦å‘æ¸¸æˆBGMæ’­æ”¾ï¼‰
     */
    function startGame() {
      if (gameState.isPlaying) return;
      gameState.isPlaying = true;
      gameState.round = 0;
      gameState.score = 0;
      gameState.correctCount = 0;
      gameState.wrongCount = 0;
      gameState.consecutiveImg1Count = 0;
      gameState.consecutiveNotImg3Count = 0;
      elements.scoreNum.textContent = '0';
      // æ’­æ”¾æ¸¸æˆBGMï¼ˆç”¨æˆ·äº¤äº’åè§¦å‘ï¼Œè§„é¿è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
      playGameBGM();
      nextRound();
    }

    /**
     * ä¸‹ä¸€è½®ç­”é¢˜
     */
    function nextRound() {
      clearInterval(gameState.timer);
      // éšæœºé€‰é¢˜ç›®
      gameState.currentQuestion = shuffleArray(CONFIG.questions)[0];
      gameState.round++;
      gameState.timeLeft = CONFIG.timeLimit;

      // æ›´æ–°UI
      elements.questionText.textContent = gameState.currentQuestion.text;
      elements.roundNum.textContent = gameState.round;
      elements.timerNum.textContent = `${gameState.timeLeft}s`;
      showMessage('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ', 'normal');

      // æ¸²æŸ“4ä¸ªé€‰é¡¹
      renderOptions();

      // å¯åŠ¨å€’è®¡æ—¶
      gameState.timer = setInterval(() => {
        gameState.timeLeft--;
        elements.timerNum.textContent = `${gameState.timeLeft}s`;
        if (gameState.timeLeft <= 0) {
          clearInterval(gameState.timer);
          showMessage('æ—¶é—´åˆ°ï¼å›ç­”é”™è¯¯', 'lose');
          playWrongSound(); // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
          gameState.wrongCount++;
          // é‡ç½®è¿ç»­è®¡æ•°
          gameState.consecutiveImg1Count = 0;
          gameState.consecutiveNotImg3Count = 0;
          gameState.consecutiveNotAdams = 0;
          setTimeout(() => gameState.isPlaying && nextRound(), 1500);
        }
      }, 1000);
    }

    /**
     * æ¸²æŸ“4ä¸ªé€‰é¡¹å›¾ç‰‡
     */
    function renderOptions() {
      elements.optionsGrid.innerHTML = '';
      const q = gameState.currentQuestion;
      let options = [];

      // æ ¹æ®é¢˜ç›®ç±»å‹ç”Ÿæˆé€‰é¡¹
      if (q.type === 'single-key') {
        options = getRandomOptions(q.correct);
      } else if (q.type === 'single') {
        options = getRandomOptions(null, q.correctIdx);
      } else {
        options = getRandomOptions();
      }

      // å¼ºåˆ¶æ¸²æŸ“4ä¸ªé€‰é¡¹
      options.forEach((key, index) => {
        const optionItem = document.createElement('div');
        optionItem.className = 'option-item';
        optionItem.dataset.key = key;
        optionItem.dataset.index = index + 1;

        // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
        const img = document.createElement('img');
        img.src = CONFIG.answerImages[key];
        img.alt = key;
        img.className = 'option-img';
        handleImageError(img, key);

        optionItem.appendChild(img);

        // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆæ‰‹æœºç«¯è§¦æ‘¸+ç‚¹å‡»ï¼‰
        optionItem.addEventListener('click', handleOptionClick);
        optionItem.addEventListener('touchend', (e) => {
          e.preventDefault();
          handleOptionClick.call(optionItem);
        });

        elements.optionsGrid.appendChild(optionItem);
      });
    }

    /**
     * å¤„ç†é€‰é¡¹ç‚¹å‡»ï¼ˆæ–°å¢éŸ³æ•ˆæ’­æ”¾ï¼‰
     */
    function handleOptionClick() {
      if (!gameState.isPlaying) return;
      clearInterval(gameState.timer);
      gameState.isPlaying = false;

      const selectedKey = this.dataset.key;
      const selectedIndex = Number(this.dataset.index);
      const q = gameState.currentQuestion;
      let isCorrect = false;
      let resultMsg = '';

      // ä¸åŒé¢˜å‹çš„ç­”é¢˜é€»è¾‘
      if (q.type === 'single-key') {
        // æ–°å¢é¢˜ç›®ï¼šæŒ‰keyåˆ¤æ–­
        isCorrect = selectedKey === q.correct;
        resultMsg = isCorrect ? q.msgWin : q.msgLose;
      } else if (q.type === 'single') {
        // åŸæœ‰é¢˜ç›®ï¼šæŒ‰ç´¢å¼•åˆ¤æ–­
        isCorrect = (selectedKey === `img${q.correctIdx + 1}`);
        resultMsg = isCorrect ? q.onCorrect : q.onWrong;
      } else if (q.type === 'special' || q.type === 'multi-text') {
        // åŸæœ‰ç‰¹æ®Šé¢˜ç›®
        const res = q.onSelect(selectedIndex - 1);
        isCorrect = res.ok;
        resultMsg = res.msg;
      }

      // æ’­æ”¾éŸ³æ•ˆ
      if (isCorrect) {
        playCorrectSound();
      } else {
        playWrongSound();
      }

      // æ›´æ–°åˆ†æ•°å’Œç»Ÿè®¡
      if (isCorrect) {
        gameState.correctCount++;
        gameState.score += CONFIG.scorePerCorrect;
        if (gameState.score > CONFIG.maxScore) gameState.score = CONFIG.maxScore;
        elements.scoreNum.textContent = gameState.score;
        showMessage(resultMsg, 'win');
        // è§¦å‘åˆ†æ•°å¼¹çª—
        if (gameState.score === 50 || gameState.score === CONFIG.maxScore) {
          showScorePopup(gameState.score);
        }
        // è§£é”é¢˜ç›®å…³è”æˆå°±
        if (q.achievement) {
          unlockAchievement(q.achievement);
        }
      } else {
        gameState.wrongCount++;
        showMessage(resultMsg, 'lose');
        // é‡ç½®è¿ç»­è®¡æ•°
        gameState.consecutiveImg1Count = 0;
        gameState.consecutiveNotImg3Count = 0;
        gameState.consecutiveNotAdams = 0;
      }

      // ========== åŸæœ‰è¿ç»­é€‰æ‹©æˆå°±åˆ¤æ–­ ==========
      // å¼ºäººæ‰€éš¾â™‚ï¼šè¿ç»­é€‰img1
      if (selectedKey === 'img1') {
        gameState.consecutiveImg1Count++;
        if (gameState.consecutiveImg1Count >= 4) {
          unlockAchievement('forceful');
          gameState.consecutiveImg1Count = 0;
        }
      } else {
        gameState.consecutiveImg1Count = 0;
      }

      // å¥½åƒå¿˜äº†è°...ï¼šè¿ç»­ä¸é€‰img3
      if (selectedKey !== 'img3') {
        gameState.consecutiveNotImg3Count++;
        if (gameState.consecutiveNotImg3Count >= 4) {
          unlockAchievement('forgotWho');
          gameState.consecutiveNotImg3Count = 0;
        }
      } else {
        gameState.consecutiveNotImg3Count = 0;
      }

      // ========== æ–°å¢æˆå°±åˆ¤æ–­ ==========
      // P...På¼Ÿï¼Ÿ
      if (q.id === 4 && selectedKey === 'é…’é¦†ä¼™è®¡' && !gameState.hasGotPBrother) {
        unlockAchievement('pBrother');
        gameState.hasGotPBrother = true;
      }

      // ç”Ÿå‘½ä¸ºä½•è‡ªç§°æ¯è‰ï¼Ÿ
      if (selectedKey !== 'Adams') {
        gameState.consecutiveNotAdams++;
        if (gameState.consecutiveNotAdams >= 5) {
          unlockAchievement('witheredGrass');
          gameState.consecutiveNotAdams = 0;
        }
      } else {
        gameState.consecutiveNotAdams = 0;
      }

      // ä»–è¯´ä»–çˆ±ä½ ã€‚
      if (q.id === 6 && selectedIndex === 4) {
        unlockAchievement('heLovesYou');
      }

      // çˆ†ç‚¹é‡‘å¸ï¼Ÿï¼ˆé¦–æ¬¡é€‰å¯¹æœå—ï¼‰
      if (q.id === 6 && isCorrect && !gameState.firstChooseChaonan) {
        unlockAchievement('goldCoin');
        gameState.firstChooseChaonan = true;
      }

      // æ·±æ°´åŸæ•…äº‹
      if (q.id === 5 && isCorrect) {
        unlockAchievement('deepWaterCity');
      }

      // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€è½®
      setTimeout(() => {
        gameState.isPlaying = true;
        // æ¢å¤æ¸¸æˆBGMï¼ˆå¦‚æœè¢«å¹¿å‘ŠBGMæ‰“æ–­ï¼‰
        playGameBGM();
        nextRound();
      }, 1500);
    }

    /**
     * é‡ç½®æ¸¸æˆï¼ˆæš‚åœæ‰€æœ‰BGMï¼‰
     */
    function resetGame() {
      clearInterval(gameState.timer);
      pauseAllBGM(); // æš‚åœæ‰€æœ‰éŸ³é¢‘
      gameState = {
        isPlaying: false,
        currentQuestion: null,
        score: 0,
        round: 0,
        timeLeft: 0,
        timer: null,
        correctCount: 0,
        wrongCount: 0,
        consecutiveImg1Count: 0,
        consecutiveNotImg3Count: 0,
        consecutiveNotAdams: 0,
        firstChooseChaonan: false,
        hasGotPBrother: false,
        unlockedAchievements: gameState.unlockedAchievements,
        triggeredScorePopups: new Set()
      };

      // æ›´æ–°UI
      elements.scoreNum.textContent = '0';
      elements.timerNum.textContent = '--';
      elements.roundNum.textContent = '0';
      elements.questionText.textContent = 'å‡†å¤‡å¼€å§‹æ¸¸æˆ';
      elements.optionsGrid.innerHTML = '';
      showMessage('ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜', 'normal');
    }

    /**
     * é‡ç½®æˆå°±ï¼ˆå«éšè—æˆå°±è§¦å‘ï¼‰
     */
    function resetAchievements(isYeah) {
      gameState.unlockedAchievements.clear();
      localStorage.removeItem('unlockedAchievements');
      renderAchievementWall();
      showMessage('æˆå°±å·²é‡ç½®', 'normal');
      // è§¦å‘éšè—æˆå°±OMGâ™‚
      if (isYeah) {
        unlockAchievement('omg');
      }
    }

    /**
     * æ¸²æŸ“æˆå°±å¢™ï¼ˆéšè—æˆå°±è·å¾—åæ˜¾ç¤ºæ–¹æ³•ï¼‰
     */
    function renderAchievementWall() {
      elements.achievementList.innerHTML = '';
      Object.entries(CONFIG.achievements).forEach(([id, achievement]) => {
        const isUnlocked = gameState.unlockedAchievements.has(id);
        const isHidden = achievement.hidden || false;

        const item = document.createElement('div');
        item.className = `achievement-item ${isUnlocked ? 'unlocked' : ''} ${isHidden ? 'hidden' : ''}`;
        item.innerHTML = `
          <h3 class="achievement-name">${isUnlocked ? 'âœ…' : 'ğŸ”’'} ${achievement.name}</h3>
          <p class="achievement-desc">${achievement.desc}</p>
          <p class="achievement-method">è§£é”æ–¹æ³•ï¼š${achievement.method}</p>
        `;
        elements.achievementList.appendChild(item);
      });
    }
// ========== å¹¿å‘Šé€»è¾‘ï¼ˆBGMåˆ‡æ¢+é—ªçƒ+GIF+å¸•å­—å›¾ç‰‡ï¼‰ ==========
    /**
     * ç»‘å®šå¹¿å‘Šäº‹ä»¶
     */
    function bindAdEvents() {
      // åŸæœ‰å¹¿å‘Šå…³é—­æŒ‰é’®
      elements.originalAdClose.addEventListener('click', () => {
        toggleModal(elements.adConfirmModal, true);
      });

      // åŸæœ‰å¹¿å‘ŠCTAï¼ˆæ’­æ”¾å¯çˆ±BGMï¼‰
      elements.originalAdCta.addEventListener('click', () => {
        showRandomAdImg('original');
        playAd1BGM(); // å¹¿å‘Š1å¯çˆ±æ´»æ³¼BGM
      });

      // æ–°å¹¿å‘Šå…³é—­æŒ‰é’®
      elements.newAdClose.addEventListener('click', () => {
        elements.newAd.style.display = 'none';
        showMessage('å·²å…³é—­æ¢è£…å¹¿å‘Š', 'normal');
        // æ¢å¤æ¸¸æˆBGMï¼ˆå¦‚æœæ¸¸æˆåœ¨è¿›è¡Œï¼‰
        if (gameState.isPlaying) playGameBGM();
      });

      // æ–°å¹¿å‘ŠCTAï¼ˆæ’­æ”¾éªšæ°”BGMï¼‰
      elements.newAdCta.addEventListener('click', () => {
        showRandomAdImg('new');
        playAd2BGM(); // å¹¿å‘Š2éªšæ°”æš§æ˜§BGM
      });

      // å¹¿å‘Šç¡®è®¤å¼¹çª—æŒ‰é’®
      elements.adConfirmBtn.addEventListener('click', () => {
        toggleModal(elements.adConfirmModal, false);
        showRandomAdImg('original');
        playAd1BGM();
      });

      elements.adCancelBtn.addEventListener('click', () => {
        toggleModal(elements.adConfirmModal, false);
        elements.originalAd.style.display = 'none';
        showMessage('å·²å…³é—­å¹¿å‘Šä¸“åŒº', 'normal');
      });

      // å¹¿å‘Šå›¾ç‰‡å¼¹çª—å…³é—­ï¼ˆæ¢å¤æ¸¸æˆBGMï¼‰
      elements.adImgCloseBtn.addEventListener('click', () => {
        toggleModal(elements.adImgModal, false);
        pauseAllBGM();
        // æ¢å¤æ¸¸æˆBGMï¼ˆå¦‚æœæ¸¸æˆåœ¨è¿›è¡Œï¼‰
        if (gameState.isPlaying) playGameBGM();
      });

      // ç‚¹å‡»å¹¿å‘Šå¼¹çª—ç©ºç™½å¤„å…³é—­
      elements.adImgModal.addEventListener('click', (e) => {
        if (e.target === elements.adImgModal) {
          toggleModal(elements.adImgModal, false);
          pauseAllBGM();
          if (gameState.isPlaying) playGameBGM();
        }
      });
    }

    /**
     * æ˜¾ç¤ºéšæœºå¹¿å‘Šå›¾ï¼ˆæ–°å¹¿å‘Šä»…æ˜¾ç¤ºå¸•å­—å›¾ç‰‡ï¼‰
     */
    function showRandomAdImg(type) {
      const adImgs = type === 'original' ? CONFIG.adMaterials.original : CONFIG.adMaterials.new;
      const randomImg = shuffleArray(adImgs)[0];

      // æ¸²æŸ“å¹¿å‘Šå›¾
      elements.adImgContent.innerHTML = `<img src="${randomImg}" alt="å¹¿å‘Šå›¾">`;
      const img = elements.adImgContent.querySelector('img');
      handleImageError(img, 'å¹¿å‘Šå›¾');

      // æ˜¾ç¤ºå¼¹çª—
      toggleModal(elements.adImgModal, true);

      // è§£é”å¯¹åº”æˆå°±
      if (type === 'original') {
        unlockAchievement('schiller');
      } else {
        unlockAchievement('fashionIcon');
      }
    }

    // ========== åˆå§‹åŒ– ==========
    window.addEventListener('load', initGame);
  </script>
</body>
</html>