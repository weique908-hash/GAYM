<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>ç­”é¢˜æ¸¸æˆ</title>
  <style>
    /* å…¨å±€é‡ç½® */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation; /* ç¦ç”¨ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾ */
      font-family: "Helvetica Neue", Arial, sans-serif;
    }
    body {
      background: #121212; /* æ·±è‰²èƒŒæ™¯ï¼Œæå‡æ–‡å­—å¯¹æ¯”åº¦ */
      color: #ffffff; /* ç™½è‰²æ–‡å­—ï¼Œç¡®ä¿æ¸…æ™° */
      min-height: 100vh;
      padding: 16px;
      overflow-x: hidden;
    }
    /* æ¸¸æˆä¸»å®¹å™¨ */
    .game-container {
      max-width: 500px;
      margin: 0 auto;
      background: #1e1e1e;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      position: relative;
      z-index: 10;
    }
    /* æ ‡é¢˜æ  */
    .game-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .game-title {
      font-size: 22px;
      color: #ffd700; /* é‡‘è‰²æ ‡é¢˜ï¼Œçªå‡º */
      margin-bottom: 8px;
    }
    .game-subtitle {
      font-size: 14px;
      color: #aaaaaa;
    }
    /* é¢˜ç›®åŒºåŸŸ */
    .question-area {
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .question-text {
      font-size: 18px;
      color: #ffffff;
      text-align: center;
      margin-bottom: 8px;
    }
    .round-info {
      font-size: 14px;
      color: #888888;
      text-align: right;
    }
    /* é€‰é¡¹ç½‘æ ¼ï¼ˆå¼ºåˆ¶2åˆ—ï¼Œå…±4å¼ å›¾ï¼‰ */
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .option-item {
      background: #2d2d2d;
      border-radius: 12px;
      padding: 8px;
      aspect-ratio: 1/1; /* æ­£æ–¹å½¢é€‰é¡¹ */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
      min-height: 120px; /* æ‰‹æœºç«¯æœ€å°ç‚¹å‡»åŒºåŸŸ */
    }
    .option-item:active {
      border-color: #ffd700; /* ç‚¹å‡»åé¦ˆ */
    }
    .option-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    .img-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888888;
      font-size: 14px;
      background: #333333;
      border-radius: 8px;
    }
    /* çŠ¶æ€æ ï¼ˆåˆ†æ•°+å€’è®¡æ—¶ï¼‰ */
    .status-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .status-item {
      text-align: center;
    }
    .status-label {
      font-size: 12px;
      color: #888888;
      margin-bottom: 4px;
    }
    .status-value {
      font-size: 20px;
      color: #ffd700;
      font-weight: bold;
    }
    /* æŒ‰é’®æ ·å¼ï¼ˆæ‰‹æœºç«¯è¶…å¤§ç‚¹å‡»åŒºåŸŸï¼‰ */
    .btn-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    .game-btn {
      flex: 1;
      padding: 16px 0;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      touch-action: manipulation;
      min-height: 48px; /* æ‰‹æœºç«¯æœ€å°ç‚¹å‡»é«˜åº¦ */
    }
    .btn-primary {
      background: #ffd700;
      color: #121212;
    }
    .btn-secondary {
      background: #444444;
      color: #ffffff;
    }
    /* æ¶ˆæ¯æç¤º */
    .message-box {
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
      font-size: 16px;
    }
    .msg-win {
      background: #006400;
      color: #ffffff;
    }
    .msg-lose {
      background: #8b0000;
      color: #ffffff;
    }
    .msg-normal {
      background: #2d2d2d;
      color: #aaaaaa;
    }
    /* å¹¿å‘ŠåŒºåŸŸ */
    .ad-section {
      margin-bottom: 16px;
      padding: 16px;
      background: #2d2d2d;
      border-radius: 12px;
      position: relative;
    }
    .ad-close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ad-title {
      font-size: 16px;
      color: #ffd700;
      margin-bottom: 12px;
      text-align: center;
    }
    .ad-cta {
      display: block;
      width: 100%;
      padding: 12px 0;
      background: #ff6347;
      color: #ffffff;
      text-align: center;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 8px;
    }
    /* å¼¹çª—åŸºç¡€æ ·å¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
    }
    .modal-container {
      background: #1e1e1e;
      border-radius: 16px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
    }
    .modal-title {
      font-size: 20px;
      color: #ffd700;
      text-align: center;
      margin-bottom: 20px;
    }
    .modal-btn-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    .modal-btn {
      flex: 1;
      padding: 12px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    /* å¹¿å‘Šå›¾ç‰‡å¼¹çª— */
    .ad-img-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
    }
    .ad-img-content {
      max-width: 90%;
      max-height: 80%;
      border-radius: 12px;
      overflow: hidden;
    }
    .ad-img-content img {
      width: 100%;
      height: auto;
    }
    .ad-img-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* æˆå°±å¢™æ ·å¼ */
    .achievement-wall {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #121212;
      z-index: 300;
      padding: 20px;
      overflow-y: auto;
      display: none;
    }
    .achievement-wall.show {
      display: block;
    }
    .achievement-wall-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .achievement-wall-title {
      font-size: 22px;
      color: #ffd700;
    }
    .achievement-close-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
    }
    .achievement-item {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 4px solid #ffd700;
    }
    .achievement-name {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 4px;
    }
    .achievement-desc {
      font-size: 14px;
      color: #aaaaaa;
    }
    /* éšè—å…ƒç´  */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- æ¸¸æˆä¸»å®¹å™¨ -->
  <div class="game-container">
    <!-- æ ‡é¢˜æ  -->
    <div class="game-header">
      <h1 class="game-title">ç­”é¢˜æŒ‘æˆ˜</h1>
      <p class="game-subtitle">ç‚¹å‡»æ­£ç¡®é€‰é¡¹ï¼Œèµ¢å–åˆ†æ•°</p>
    </div>

    <!-- é¢˜ç›®åŒºåŸŸ -->
    <div class="question-area">
      <p class="question-text" id="questionText">å‡†å¤‡å¼€å§‹æ¸¸æˆ</p>
      <p class="round-info">å…³å¡: <span id="roundNum">0</span></p>
    </div>

    <!-- é€‰é¡¹ç½‘æ ¼ï¼ˆå¼ºåˆ¶4å¼ å›¾ï¼‰ -->
    <div class="options-grid" id="optionsGrid"></div>

    <!-- æ¶ˆæ¯æç¤º -->
    <div class="message-box msg-normal" id="messageBox">ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜</div>

    <!-- çŠ¶æ€æ  -->
    <div class="status-bar">
      <div class="status-item">
        <p class="status-label">åˆ†æ•°</p>
        <p class="status-value" id="scoreNum">0</p>
      </div>
      <div class="status-item">
        <p class="status-label">å€’è®¡æ—¶</p>
        <p class="status-value" id="timerNum">--</p>
      </div>
    </div>

    <!-- æŒ‰é’®ç»„ -->
    <div class="btn-group">
      <button class="game-btn btn-primary" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="resetBtn">é‡ç½®æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="achievementBtn">æˆå°±å¢™</button>
    </div>

    <!-- åŸæœ‰å¹¿å‘ŠåŒºåŸŸ -->
    <div class="ad-section" id="originalAd">
      <button class="ad-close-btn" id="originalAdClose">Ã—</button>
      <h3 class="ad-title">å¹¿å‘Šä¸“åŒº</h3>
      <a href="javascript:;" class="ad-cta" id="originalAdCta">ç‚¹å‡»æŸ¥çœ‹éšæœºå¹¿å‘Šå›¾</a>
    </div>

    <!-- æ–°å¹¿å‘ŠåŒºåŸŸ -->
    <div class="ad-section" id="newAd">
      <button class="ad-close-btn" id="newAdClose">Ã—</button>
      <h3 class="ad-title">â™‚ç«çƒ­æ¢è£…â™‚  â™‚åœ¨çº¿æ¼«ç”»â™‚</h3>
      <a href="javascript:;" class="ad-cta" id="newAdCta">ç‚¹å‡»æŸ¥çœ‹ç²¾å½©å†…å®¹</a>
    </div>
  </div>

  <!-- å¹¿å‘Šå…³é—­ç¡®è®¤å¼¹çª— -->
  <div class="modal-overlay hidden" id="adConfirmModal">
    <div class="modal-container">
      <h3 class="modal-title">ä¸è¿›æ¥çœ‹çœ‹å—ï¼Ÿ</h3>
      <div class="modal-btn-group">
        <button class="modal-btn btn-primary" id="adConfirmBtn">å¥½å§ï¼Œæ¥äº†â¤ï¸</button>
        <button class="modal-btn btn-secondary" id="adCancelBtn">å‘ƒâ†“ï¼Œæˆ‘æ˜¯ç›´ç”·</button>
      </div>
    </div>
  </div>

  <!-- å¹¿å‘Šå›¾ç‰‡å¼¹çª— -->
  <div class="ad-img-modal hidden" id="adImgModal">
    <button class="ad-img-close" id="adImgCloseBtn">Ã—</button>
    <div class="ad-img-content" id="adImgContent"></div>
  </div>

  <!-- æˆå°±å¢™ -->
  <div class="achievement-wall" id="achievementWall">
    <div class="achievement-wall-header">
      <h2 class="achievement-wall-title">æˆå°±å¢™</h2>
      <button class="achievement-close-btn" id="achievementWallClose">Ã—</button>
    </div>
    <div id="achievementList"></div>
  </div>

  <script>
    // ========== é…ç½®é¡¹ ==========
    const CONFIG = {
      // ç­”é¢˜å›¾ç‰‡ç´ æï¼ˆå«å®¹é”™å ä½å›¾ï¼‰
      answerImages: {
        'é…’é¦†ä¼™è®¡': 'é…’é¦†ä¼™è®¡.png',
        'å®‹': 'å®‹.jpg',
        'æœå—': 'æœå—.jpg',
        'Adams': 'Adams.jpg',
        'æ©™å¸•': 'æ©™å¸•.jpg',
        'æ­£ç»è¡£æœ': 'æ­£ç»è¡£æœ.jpg',
        'æ½®ç”·å¸•': 'æ½®ç”·å¸•.jpg',
        'æ½®ç”·å¸•çš„åèƒŒ': 'æ½®ç”·å¸•çš„åèƒŒ.jpg',
        'img1': 'img1.jpg',
        'img2': 'img2.jpg',
        'img3': 'img3.jpg',
        'img4': 'img4.jpg'
      },
      // å¹¿å‘Šç´ æ
      adMaterials: {
        original: ['å¹¿å‘Š.png', 'å¹¿å‘Š2.jpg', 'å¹¿å‘Š3.jpg'],
        new: ['æ©™å¸•.jpg', 'æ­£ç»è¡£æœ.jpg', 'æ½®ç”·å¸•.jpg', 'æ½®ç”·å¸•çš„åèƒŒ.jpg'],
        cover: 'å¹¿å‘Šå°é¢.gif'
      },
      // é¢˜åº“
      questions: [
        {
          id: 1,
          text: 'è°æ²¡æœ‰å¯¹è±¡ï¼Ÿ',
          correct: 'é…’é¦†ä¼™è®¡',
          msgWin: 'å›ç­”æ­£ç¡®ï¼',
          msgLose: 'å›ç­”é”™è¯¯ï¼'
        },
        {
          id: 2,
          text: 'é€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€‚',
          correct: 'å®‹',
          msgWin: 'å®‹é…±å®‹é…±æˆ‘ä»¬å–œæ¬¢ä½ â¤ï¸',
          msgLose: 'å¥½åƒä¹Ÿæ²¡é”™...'
        },
        {
          id: 3,
          text: 'å¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿ',
          correct: 'æœå—',
          msgWin: 'æœå“¥è¯·è¡¨æ¼”ä¸€ä¸‹é‚£ä¸ªï¼ğŸ’°ğŸ’°ğŸ’°',
          msgLose: 'ä¸ï¼Œè¿™ä½åº”è¯¥ä¸ä¼šç»™ä½ é’±ã€‚'
        },
        {
          id: 4,
          text: 'ä½ å¥½ã€‚è¯·å¬·â€”â€”',
          correct: 'Adams',
          msgWin: 'â€œæˆ‘å¯æ˜¯ç›´ç”·å‘€ï¼â€',
          msgLose: 'è¯¶ï¼Ÿé‚£ä¹Ÿä¸é”™ã€‚'
        }
      ],
      // æˆå°±é…ç½®
      achievements: {
        pBrother: { name: 'P...På¼Ÿï¼Ÿ', desc: 'åœ¨ã€Œè°æ²¡æœ‰å¯¹è±¡ï¼Ÿã€é—®é¢˜ä¸­é€‰æ‹©é…’é¦†ä¼™è®¡' },
        witheredGrass: { name: 'ç”Ÿå‘½ä¸ºä½•è‡ªç§°æ¯è‰ï¼Ÿ', desc: 'è¿ç»­5æ¬¡ä¸é€‰æ‹©Adams' },
        heLovesYou: { name: 'ä»–è¯´ä»–çˆ±ä½ ã€‚', desc: 'æœå—é—®é¢˜ä¸­é€‰æ‹©ç¬¬4å¼ å›¾ç‰‡' },
        goldCoin: { name: 'çˆ†ç‚¹é‡‘å¸ï¼Ÿ', desc: 'ç¬¬ä¸€æ¬¡é€‰æ‹©æœå—å¹¶ç­”å¯¹' },
        deepWaterCity: { name: 'æ·±æ°´åŸæ•…äº‹', desc: 'æ­£ç¡®å›ç­”ã€Œé€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€' },
        fashionIcon: { name: 'è¡£å“è¾¾äººâ¤ï¸', desc: 'ç‚¹å¼€æ–°æ·»åŠ çš„å¹¿å‘Š' },
        schiller: { name: 'Schiller.', desc: 'ç‚¹å¼€åŸæœ‰çš„å¹¿å‘Š' }
      },
      // æ¸¸æˆå‚æ•°
      timeLimit: 8, // æ¯é¢˜å€’è®¡æ—¶ï¼ˆç§’ï¼‰
      scorePerCorrect: 5 // æ¯é¢˜æ­£ç¡®å¾—åˆ†
    };

    // ========== å…¨å±€çŠ¶æ€ ==========
    let gameState = {
      isPlaying: false,
      currentQuestion: null,
      score: 0,
      round: 0,
      timeLeft: 0,
      timer: null,
      consecutiveNotAdams: 0,
      firstChooseChaonan: false,
      hasGotPBrother: false,
      unlockedAchievements: new Set(JSON.parse(localStorage.getItem('unlockedAchievements')) || [])
    };

    // ========== DOMå…ƒç´  ==========
    const elements = {
      // æ¸¸æˆæ ¸å¿ƒ
      questionText: document.getElementById('questionText'),
      roundNum: document.getElementById('roundNum'),
      optionsGrid: document.getElementById('optionsGrid'),
      messageBox: document.getElementById('messageBox'),
      scoreNum: document.getElementById('scoreNum'),
      timerNum: document.getElementById('timerNum'),
      startBtn: document.getElementById('startBtn'),
      resetBtn: document.getElementById('resetBtn'),
      achievementBtn: document.getElementById('achievementBtn'),
      // å¹¿å‘Š
      originalAd: document.getElementById('originalAd'),
      originalAdClose: document.getElementById('originalAdClose'),
      originalAdCta: document.getElementById('originalAdCta'),
      newAd: document.getElementById('newAd'),
      newAdClose: document.getElementById('newAdClose'),
      newAdCta: document.getElementById('newAdCta'),
      adConfirmModal: document.getElementById('adConfirmModal'),
      adConfirmBtn: document.getElementById('adConfirmBtn'),
      adCancelBtn: document.getElementById('adCancelBtn'),
      adImgModal: document.getElementById('adImgModal'),
      adImgCloseBtn: document.getElementById('adImgCloseBtn'),
      adImgContent: document.getElementById('adImgContent'),
      // æˆå°±å¢™
      achievementWall: document.getElementById('achievementWall'),
      achievementWallClose: document.getElementById('achievementWallClose'),
      achievementList: document.getElementById('achievementList')
    };
// ========== å·¥å…·å‡½æ•° ==========
    /**
     * å›¾ç‰‡åŠ è½½å®¹é”™ï¼šå¤±è´¥æ—¶æ˜¾ç¤ºå ä½å›¾
     * @param {HTMLImageElement} img å›¾ç‰‡å…ƒç´ 
     * @param {string} altText æ›¿ä»£æ–‡æœ¬
     */
    function handleImageError(img, altText) {
      img.onerror = function() {
        const parent = img.parentElement;
        parent.innerHTML = `<div class="img-placeholder">${altText}<br>åŠ è½½å¤±è´¥</div>`;
      };
    }

    /**
     * éšæœºæ‰“ä¹±æ•°ç»„
     * @param {Array} arr åŸæ•°ç»„
     * @returns {Array} æ‰“ä¹±åçš„æ•°ç»„
     */
    function shuffleArray(arr) {
      const newArr = [...arr];
      for (let i = newArr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
      }
      return newArr;
    }

    /**
     * ç”Ÿæˆéšæœº4ä¸ªé€‰é¡¹ï¼ˆå¿…å«æ­£ç¡®ç­”æ¡ˆï¼‰
     * @param {string} correctKey æ­£ç¡®ç­”æ¡ˆçš„key
     * @returns {Array} 4ä¸ªé€‰é¡¹çš„keyæ•°ç»„
     */
    function getRandomOptions(correctKey) {
      const allKeys = Object.keys(CONFIG.answerImages);
      // è¿‡æ»¤æ­£ç¡®ç­”æ¡ˆï¼Œéšæœºé€‰3ä¸ª
      const otherKeys = allKeys.filter(key => key !== correctKey);
      const randomOthers = shuffleArray(otherKeys).slice(0, 3);
      // åˆå¹¶å¹¶æ‰“ä¹±
      const finalOptions = shuffleArray([...randomOthers, correctKey]);
      return finalOptions;
    }

    /**
     * è§£é”æˆå°±
     * @param {string} achievementId æˆå°±ID
     */
    function unlockAchievement(achievementId) {
      if (gameState.unlockedAchievements.has(achievementId)) return;
      gameState.unlockedAchievements.add(achievementId);
      localStorage.setItem('unlockedAchievements', JSON.stringify(Array.from(gameState.unlockedAchievements)));
      // æ›´æ–°æˆå°±å¢™
      renderAchievementWall();
      // æ˜¾ç¤ºæç¤ºï¼ˆå¯æ‰©å±•å¼¹çª—ï¼‰
      showMessage(`è§£é”æˆå°±ï¼š${CONFIG.achievements[achievementId].name}`, 'win');
    }

    /**
     * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
     * @param {string} text æ¶ˆæ¯æ–‡æœ¬
     * @param {string} type ç±»å‹ï¼šwin/lose/normal
     */
    function showMessage(text, type = 'normal') {
      elements.messageBox.textContent = text;
      elements.messageBox.className = 'message-box';
      elements.messageBox.classList.add(`msg-${type}`);
    }

    /**
     * æ˜¾ç¤º/éšè—å¼¹çª—
     * @param {HTMLElement} modal å¼¹çª—å…ƒç´ 
     * @param {boolean} show æ˜¯å¦æ˜¾ç¤º
     */
    function toggleModal(modal, show) {
      if (show) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      } else {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    }
// ========== æ¸¸æˆæ ¸å¿ƒé€»è¾‘ ==========
    /**
     * åˆå§‹åŒ–æ¸¸æˆ
     */
    function initGame() {
      // ç»‘å®šæŒ‰é’®äº‹ä»¶
      elements.startBtn.addEventListener('click', startGame);
      elements.resetBtn.addEventListener('click', resetGame);
      elements.achievementBtn.addEventListener('click', () => {
        elements.achievementWall.classList.add('show');
        renderAchievementWall();
      });
      elements.achievementWallClose.addEventListener('click', () => {
        elements.achievementWall.classList.remove('show');
      });

      // ç»‘å®šå¹¿å‘Šäº‹ä»¶
      bindAdEvents();

      // åˆå§‹åŒ–æˆå°±å¢™
      renderAchievementWall();

      // é‡ç½®æ¸¸æˆçŠ¶æ€
      resetGame();
    }

    /**
     * å¼€å§‹æ¸¸æˆ
     */
    function startGame() {
      if (gameState.isPlaying) return;
      gameState.isPlaying = true;
      gameState.round = 0;
      gameState.score = 0;
      elements.scoreNum.textContent = '0';
      nextRound();
    }

    /**
     * ä¸‹ä¸€è½®ç­”é¢˜
     */
    function nextRound() {
      // æ¸…é™¤å€’è®¡æ—¶
      if (gameState.timer) clearInterval(gameState.timer);

      // éšæœºé€‰é¢˜ç›®
      gameState.currentQuestion = shuffleArray(CONFIG.questions)[0];
      gameState.round++;
      gameState.timeLeft = CONFIG.timeLimit;

      // æ›´æ–°UI
      elements.questionText.textContent = gameState.currentQuestion.text;
      elements.roundNum.textContent = gameState.round;
      elements.timerNum.textContent = `${gameState.timeLeft}s`;
      showMessage('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ', 'normal');

      // æ¸²æŸ“4ä¸ªé€‰é¡¹
      renderOptions();

      // å¯åŠ¨å€’è®¡æ—¶
      gameState.timer = setInterval(() => {
        gameState.timeLeft--;
        elements.timerNum.textContent = `${gameState.timeLeft}s`;
        if (gameState.timeLeft <= 0) {
          clearInterval(gameState.timer);
          showMessage('æ—¶é—´åˆ°ï¼å›ç­”é”™è¯¯', 'lose');
          gameState.consecutiveNotAdams = 0;
          setTimeout(() => gameState.isPlaying && nextRound(), 1500);
        }
      }, 1000);
    }

    /**
     * æ¸²æŸ“4ä¸ªé€‰é¡¹å›¾ç‰‡
     */
    function renderOptions() {
      elements.optionsGrid.innerHTML = '';
      const correctKey = gameState.currentQuestion.correct;
      const options = getRandomOptions(correctKey);

      // å¼ºåˆ¶æ¸²æŸ“4ä¸ªé€‰é¡¹ï¼ˆä¸¥æ ¼æ§åˆ¶æ•°é‡ï¼‰
      options.forEach((key, index) => {
        const optionItem = document.createElement('div');
        optionItem.className = 'option-item';
        optionItem.dataset.key = key;
        optionItem.dataset.index = index + 1; // 1-4ç´¢å¼•

        // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
        const img = document.createElement('img');
        img.src = CONFIG.answerImages[key];
        img.alt = key;
        img.className = 'option-img';
        // å›¾ç‰‡åŠ è½½å®¹é”™
        handleImageError(img, key);

        optionItem.appendChild(img);

        // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆæ‰‹æœºç«¯è§¦æ‘¸+ç‚¹å‡»ï¼‰
        optionItem.addEventListener('click', handleOptionClick);
        optionItem.addEventListener('touchend', (e) => {
          e.preventDefault();
          handleOptionClick.call(optionItem);
        });

        elements.optionsGrid.appendChild(optionItem);
      });
    }

    /**
     * å¤„ç†é€‰é¡¹ç‚¹å‡»
     */
    function handleOptionClick() {
      if (!gameState.isPlaying) return;
      clearInterval(gameState.timer);
      gameState.isPlaying = false;

      const selectedKey = this.dataset.key;
      const selectedIndex = Number(this.dataset.index);
      const correctKey = gameState.currentQuestion.correct;
      const isCorrect = selectedKey === correctKey;

      // æ›´æ–°åˆ†æ•°å’Œæ¶ˆæ¯
      if (isCorrect) {
        gameState.score += CONFIG.scorePerCorrect;
        elements.scoreNum.textContent = gameState.score;
        showMessage(gameState.currentQuestion.msgWin, 'win');
      } else {
        showMessage(gameState.currentQuestion.msgLose, 'lose');
      }

      // ========== æˆå°±åˆ¤æ–­é€»è¾‘ ==========
      // 1. P...På¼Ÿï¼Ÿ
      if (gameState.currentQuestion.id === 1 && selectedKey === 'é…’é¦†ä¼™è®¡' && !gameState.hasGotPBrother) {
        unlockAchievement('pBrother');
        gameState.hasGotPBrother = true;
      }

      // 2. ç”Ÿå‘½ä¸ºä½•è‡ªç§°æ¯è‰ï¼Ÿ
      if (selectedKey !== 'Adams') {
        gameState.consecutiveNotAdams++;
        if (gameState.consecutiveNotAdams >= 5) {
          unlockAchievement('witheredGrass');
          gameState.consecutiveNotAdams = 0;
        }
      } else {
        gameState.consecutiveNotAdams = 0;
      }

      // 3. ä»–è¯´ä»–çˆ±ä½ ã€‚
      if (gameState.currentQuestion.id === 3 && selectedIndex === 4) {
        unlockAchievement('heLovesYou');
      }

      // 4. çˆ†ç‚¹é‡‘å¸ï¼Ÿ
      if (gameState.currentQuestion.id === 3 && isCorrect && !gameState.firstChooseChaonan) {
        unlockAchievement('goldCoin');
        gameState.firstChooseChaonan = true;
      }

      // 5. æ·±æ°´åŸæ•…äº‹
      if (gameState.currentQuestion.id === 2 && isCorrect) {
        unlockAchievement('deepWaterCity');
      }

      // å»¶è¿Ÿè¿›å…¥ä¸‹ä¸€è½®
      setTimeout(() => {
        gameState.isPlaying = true;
        nextRound();
      }, 1500);
    }

    /**
     * é‡ç½®æ¸¸æˆ
     */
    function resetGame() {
      clearInterval(gameState.timer);
      gameState = {
        isPlaying: false,
        currentQuestion: null,
        score: 0,
        round: 0,
        timeLeft: 0,
        timer: null,
        consecutiveNotAdams: 0,
        firstChooseChaonan: false,
        hasGotPBrother: false,
        unlockedAchievements: gameState.unlockedAchievements
      };

      // æ›´æ–°UI
      elements.scoreNum.textContent = '0';
      elements.timerNum.textContent = '--';
      elements.roundNum.textContent = '0';
      elements.questionText.textContent = 'å‡†å¤‡å¼€å§‹æ¸¸æˆ';
      elements.optionsGrid.innerHTML = '';
      showMessage('ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜', 'normal');
    }

    /**
     * æ¸²æŸ“æˆå°±å¢™
     */
    function renderAchievementWall() {
      elements.achievementList.innerHTML = '';
      Object.entries(CONFIG.achievements).forEach(([id, achievement]) => {
        const isUnlocked = gameState.unlockedAchievements.has(id);
        const item = document.createElement('div');
        item.className = 'achievement-item';
        item.innerHTML = `
          <h3 class="achievement-name">${isUnlocked ? 'âœ…' : 'ğŸ”’'} ${achievement.name}</h3>
          <p class="achievement-desc">${achievement.desc}</p>
        `;
        elements.achievementList.appendChild(item);
      });
    }
// ========== å¹¿å‘Šé€»è¾‘ ==========
    /**
     * ç»‘å®šå¹¿å‘Šäº‹ä»¶
     */
    function bindAdEvents() {
      // åŸæœ‰å¹¿å‘Šå…³é—­æŒ‰é’®
      elements.originalAdClose.addEventListener('click', () => {
        toggleModal(elements.adConfirmModal, true);
      });

      // åŸæœ‰å¹¿å‘ŠCTA
      elements.originalAdCta.addEventListener('click', () => {
        showRandomAdImg('original');
      });

      // æ–°å¹¿å‘Šå…³é—­æŒ‰é’®
      elements.newAdClose.addEventListener('click', () => {
        elements.newAd.style.display = 'none';
        showMessage('å·²å…³é—­æ–°å¹¿å‘Š', 'normal');
      });

      // æ–°å¹¿å‘ŠCTA
      elements.newAdCta.addEventListener('click', () => {
        showRandomAdImg('new');
      });

      // å¹¿å‘Šç¡®è®¤å¼¹çª—æŒ‰é’®
      elements.adConfirmBtn.addEventListener('click', () => {
        toggleModal(elements.adConfirmModal, false);
        showRandomAdImg('original');
      });

      elements.adCancelBtn.addEventListener('click', () => {
        toggleModal(elements.adConfirmModal, false);
        elements.originalAd.style.display = 'none';
        showMessage('å·²å…³é—­åŸæœ‰å¹¿å‘Š', 'normal');
      });

      // å¹¿å‘Šå›¾ç‰‡å¼¹çª—å…³é—­
      elements.adImgCloseBtn.addEventListener('click', () => {
        toggleModal(elements.adImgModal, false);
      });

      // ç‚¹å‡»å¹¿å‘Šå¼¹çª—ç©ºç™½å¤„å…³é—­
      elements.adImgModal.addEventListener('click', (e) => {
        if (e.target === elements.adImgModal) {
          toggleModal(elements.adImgModal, false);
        }
      });
    }

    /**
     * æ˜¾ç¤ºéšæœºå¹¿å‘Šå›¾
     * @param {string} type å¹¿å‘Šç±»å‹ï¼šoriginal/new
     */
    function showRandomAdImg(type) {
      const adImgs = type === 'original' ? CONFIG.adMaterials.original : CONFIG.adMaterials.new;
      const randomImg = shuffleArray(adImgs)[0];

      // æ¸²æŸ“å¹¿å‘Šå›¾
      elements.adImgContent.innerHTML = `<img src="${randomImg}" alt="å¹¿å‘Šå›¾">`;
      // å›¾ç‰‡å®¹é”™
      const img = elements.adImgContent.querySelector('img');
      handleImageError(img, 'å¹¿å‘Šå›¾');

      // æ˜¾ç¤ºå¼¹çª—
      toggleModal(elements.adImgModal, true);

      // è§£é”å¯¹åº”æˆå°±
      if (type === 'original') {
        unlockAchievement('schiller');
      } else {
        unlockAchievement('fashionIcon');
      }
    }

    // ========== åˆå§‹åŒ– ==========
    window.addEventListener('load', initGame);
  </script>
</body>
</html>