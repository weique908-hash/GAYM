<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ä½ å¥½å•Šæˆ‘æ˜¯ç”·åŒ</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ffb86b;--muted:#94a3b8;--win:#34d399;--lose:#fb7185;font-family:Inter,system-ui,Arial}
    html,body{height:100%;margin:0;padding:12px;background:linear-gradient(180deg,var(--bg),#071025);color:#e6eef8;display:flex;align-items:center;justify-content:center}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .game-area{display:flex;flex-direction:column;gap:12px}
    .board{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .cell{background:#0c1220;border-radius:8px;padding:6px;display:flex;align-items:center;justify-content:center;min-height:100px;cursor:pointer;pointer-events:auto !important;position:relative;z-index:10}
    .cell img{max-width:100%;max-height:100%;object-fit:contain;border-radius:6px}
    .sidebar{display:flex;flex-direction:row;gap:10px;width:100%}
    .stat{flex:1;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;text-align:center}
    .stat-label{font-size:12px;color:var(--muted)}
    .stat-value{font-size:18px;font-weight:700}
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .btn{background:var(--accent);border:none;padding:10px 16px;border-radius:8px;font-weight:700;cursor:pointer;pointer-events:auto !important;position:relative;z-index:10;font-size:14px}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
    .btn#btnEndGame{display:none}/* åˆå§‹éšè—ç»“æŸæ¸¸æˆæŒ‰é’® */
    .message{padding:8px;border-radius:8px;text-align:center;margin:8px 0;display:none;font-size:14px}
    .message.win{color:var(--win);display:block}
    .message.lose{color:var(--lose);display:block}
    .message.limit{color:var(--accent);font-size:16px;font-weight:700;animation:pulse 0.5s ease-in-out infinite alternate;background:rgba(255,184,107,0.1);border:1px solid rgba(255,184,107,0.3);display:block}
    @keyframes pulse{from{transform:scale(1);opacity:0.9}to{transform:scale(1.05);opacity:1}}
    /* é€šç”¨å¼¹çª—æ ·å¼ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ */
    .popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--card);border-radius:12px;padding:24px;border:2px solid var(--accent);z-index:1000;animation:popup 0.3s ease-in-out;display:none;width:85%;max-width:350px;text-align:center}
    .popup.show{display:block}
    @keyframes popup{0%{opacity:0;transform:translate(-50%,-60%) scale(0.9)}100%{opacity:1;transform:translate(-50%,-50%) scale(1)}}
    /* åˆ†æ•°é‡Œç¨‹ç¢‘å¼¹çª— */
    .score-popup .popup-icon{font-size:32px;margin-bottom:12px;color:var(--accent)}
    .score-popup h3{font-size:20px;margin:0 0 8px;color:var(--accent)}
    .score-popup p{font-size:14px;margin:0 0 16px;color:var(--muted)}
    /* æˆå°±è§£é”å¼¹çª— */
    .achievement-popup{padding:20px}
    .achievement-popup .popup-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .achievement-popup .achievement-icon{width:48px;height:48px;border-radius:50%;background:var(--accent);display:flex;align-items:center;justify-content:center;font-size:24px;color:#071025}
    .achievement-popup .achievement-info{text-align:left}
    .achievement-popup h3{font-size:18px;margin:0 0 4px;color:var(--win)}
    .achievement-popup p{font-size:12px;margin:0;color:var(--muted)}
    .achievement-popup .popup-body{font-size:14px;margin-bottom:16px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01)}
    /* é®ç½©å±‚ */
    .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:999;display:none}
    .overlay.show{display:block}
    /* å¹¿å‘ŠåŒºåŸŸ */
    footer.ad{margin-top:12px;padding:12px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;position:relative}
    .ad-close-btn{position:absolute;top:6px;right:6px;background:var(--lose);color:white;border:none;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;z-index:10;pointer-events:auto !important}
    .cta{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:10px;background:var(--accent);color:#071025;font-weight:700;text-decoration:none;pointer-events:auto !important;font-size:14px}
    .flash{animation:flash 1s linear infinite}
    @keyframes flash{0%,100%{opacity:1}50%{opacity:0.25}}
    /* æ¨¡æ€æ¡†æ ·å¼ï¼ˆæ‰‹æœºç«¯é€‚é…ï¼‰ */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;align-items:center;justify-content:center}
    .modal.show{display:flex}
    .modal-content{background:var(--card);padding:24px;border-radius:12px;width:85%;max-width:400px;border:1px solid rgba(255,255,255,0.05)}
    .modal-title{font-size:18px;margin:0 0 16px;color:var(--accent);text-align:center}
    .modal-buttons{display:flex;flex-direction:column;gap:10px}
    .modal-btn{padding:12px 16px;border-radius:8px;border:none;font-weight:700;cursor:pointer;text-align:center;pointer-events:auto !important;position:relative;z-index:1001;font-size:14px}
    .modal-btn.option1{background:var(--win);color:#071025}
    .modal-btn.option2{background:var(--lose);color:white}
    .modal-btn.option3{background:var(--accent);color:#071025}
  </style>
</head>
<body>
  <div class="card">
    <header>
      <h1>ä½ å¥½å•Šæˆ‘æ˜¯ç”·åŒ</h1>
      <div style="font-size:12px;color:var(--muted)">ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‘æˆ˜</div>
    </header>

    <div class="game-area">
      <div class="board">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-size:13px;color:var(--muted)">å…³å¡ï¼š<span id="round">â€”</span></div>
          <div id="questionText" style="font-size:13px;color:var(--muted)">é¢˜ç›®å°†éšæœºå‡ºç°</div>
        </div>

        <div id="grid" class="grid"></div>
        <div id="message" class="message"></div>
        <div class="controls">
          <button id="btnStart" class="btn">å¼€å§‹â™‚æ¸¸æˆ</button>
          <button id="btnRestart" class="btn secondary">é‡ç½®</button>
          <button id="btnEndGame" class="btn secondary">ç»“æŸæ¸¸æˆ</button>
        </div>
      </div>

      <div class="sidebar">
        <div class="stat">
          <div class="stat-label">å€’è®¡æ—¶</div>
          <div id="timer" class="stat-value">--</div>
        </div>
        <div class="stat">
          <div class="stat-label">åˆ†æ•°</div>
          <div id="score" class="stat-value">0</div>
        </div>
      </div>
    </div>

    <!-- å¹¿å‘ŠåŒºåŸŸ -->
    <footer class="ad">
      <button id="adCloseBtn" class="ad-close-btn">Ã—</button>
      <div style="font-size:13px;color:var(--muted)">å¹¿å‘ŠåŒº</div>
      <a class="cta flash" href="https://ä½ çš„æ¨å¹¿é“¾æ¥.com">ç‚¹å‡»â™‚è¿™é‡Œ</a>
    </footer>
  </div>

  <!-- å¹¿å‘Šå…³é—­ç¡®è®¤æ¨¡æ€æ¡† -->
  <div id="adCloseModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title">ä¸è¿›æ¥çœ‹çœ‹å—ï¼Ÿ</h3>
      <div class="modal-buttons">
        <button id="btnAdOption1" class="modal-btn option1">å¥½å§ï¼Œæ¥äº†â¤ï¸</button>
        <button id="btnAdOption2" class="modal-btn option2">å‘ƒâ†“ï¼Œæˆ‘æ˜¯ç›´ç”·ã€‚</button>
        <button id="btnAdOption3" class="modal-btn option3">ä½ ä¸çœ‹çœ‹æˆ‘å—ï¼Ÿ</button>
      </div>
    </div>
  </div>

  <!-- å¼¹çª—ç›¸å…³ -->
  <div class="overlay" id="overlay"></div>
  <!-- åˆ†æ•°é‡Œç¨‹ç¢‘å¼¹çª—ï¼ˆ50åˆ†/100åˆ†ï¼‰ -->
  <div class="popup score-popup" id="scorePopup">
    <div class="popup-icon" id="scorePopupIcon">ğŸ‰</div>
    <h3 id="scorePopupTitle">å¤ªæ£’äº†ï¼</h3>
    <p id="scorePopupDesc">ä½ å·²ç»è·å¾—äº†50åˆ†ï¼</p>
    <button class="btn" id="scorePopupBtn">ç»§ç»­æŒ‘æˆ˜</button>
  </div>
  <!-- æˆå°±è§£é”å¼¹çª— -->
  <div class="popup achievement-popup" id="achievementPopup">
    <div class="popup-header">
      <div class="achievement-icon">ğŸ†</div>
      <div class="achievement-info">
        <h3 id="achievementName">æˆå°±è§£é”ï¼</h3>
        <p id="achievementDesc">å®Œæˆäº†æŸä¸ªæˆå°±</p>
      </div>
    </div>
    <div class="popup-body" id="achievementMsg">
      æ­å–œä½ è§£é”äº†æ–°æˆå°±ï¼
    </div>
    <button class="btn" id="achievementPopupBtn">å¤ªæ£’äº†</button>
  </div>

  <script>
    window.onload = function() {
      const CONFIG = {
        images: ["img1.jpg", "img2.jpg", "img3.jpg", "img4.jpg"],
        adLink: "https://ä½ çš„æ¨å¹¿é“¾æ¥.com",
        timeLimit: 8,
        maxScore: 100,
        pointsPerCorrect: 5,
      };

      // é¢˜ç›®é…ç½®ï¼ˆæ–°å¢æˆå°±å…³è”ï¼‰
      const QUESTIONS = [
        {
          id:1,
          text: 'æ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç”·åŒ',
          type:'special',
          onSelect: () => ({ ok: false, msg: 'å“ˆå“ˆéª—ä½ çš„ï¼Œæˆ‘åªè®¾ç½®äº†å•é€‰' })
        },
        {
          id:2,
          text: 'æ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆ',
          type:'single',
          correctIdx: 0,
          onCorrect: 'ä½ çœ‹èµ·æ¥å¾ˆå¥½åƒ',
          onWrong: 'Cazzoï¼Œä½ ä¸è®¤è¯†æˆ‘å—',
          achievement: 'chef' // å…³è”æˆå°±ï¼šå¨å¸ˆ
        },
        {
          id:3,
          text: 'æ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ',
          type:'single',
          correctIdx: 3,
          onCorrect: 'éš”å£ä»–ç”·äººåœ¨åŒæŒing',
          onWrong: 'å†é€‰é”™å°±è¿‡æ¥å¿ƒç†æ²»ç–—',
          achievement: 'therapist' // å…³è”æˆå°±ï¼šå¿ƒç†æ²»ç–—å¸ˆ
        },
        {
          id:4,
          text: 'æ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·',
          type:'multi-text',
          onSelect: (idx) => {
            if(idx === 0 || idx === 1) {
              unlockAchievement('straight'); // è§£é”æˆå°±ï¼šç›´ç”·
              return { ok: true, msg: 'ğŸ’æˆ‘ä»¬æ˜¯çœŸæ­£çš„â™‚ç›´ç”·â™‚å‘€' };
            } else {
              unlockAchievement('gayPride'); // è§£é”æˆå°±ï¼šéª„å‚²ä¹‹GAY
              return { ok: true, msg: 'ğŸŒˆğŸŒˆğŸŒˆéª„å‚²ä¹‹â™‚GAYğŸŒˆğŸŒˆğŸŒˆ' };
            }
          }
        }
      ];

      // æˆå°±é…ç½®ï¼ˆæ–°å¢æˆå°±æè¿°ï¼‰
      const ACHIEVEMENTS = {
        straight: {
          name: 'æˆ‘æ˜¯ç›´ç”·',
          desc: 'é€‰æ‹©"ç›´ç”·"é€‰é¡¹',
          msg: 'ğŸ’ ä½ é€‰æ‹©äº†ç›´ç”·é€‰é¡¹ï¼Œæœç„¶æ˜¯çº¯çº¯çš„â™‚ç›´ç”·ï¼'
        },
        gayPride: {
          name: 'éª„å‚²ä¹‹GAY',
          desc: 'é€‰æ‹©"GAY"é€‰é¡¹',
          msg: 'ğŸŒˆ éª„å‚²çš„GAYï¼ä¸ºä½ æ„Ÿåˆ°è‡ªè±ªï¼'
        },
        chef: {
          name: 'ä½ æ˜¯é£Ÿæå—',
          desc: 'æ­£ç¡®æ‰¾å‡ºå¨å¸ˆ',
          msg: 'ğŸ‘¨â€ğŸ³ ä½ æ‰¾å‡ºäº†çœŸæ­£çš„å¨å¸ˆï¼Œå°å¿ƒè¢«åšæˆç¾é£Ÿå“¦ï¼'
        },
        therapist: {
          name: 'å¿ƒç†æ²»ç–—å¸ˆ',
          desc: 'æ­£ç¡®æ‰¾å‡ºå¿ƒç†æ²»ç–—å¸ˆ',
          msg: 'ğŸ§  æ‰¾åˆ°å¿ƒç†æ²»ç–—å¸ˆäº†ï¼éœ€è¦èŠèŠä½ çš„æ„Ÿæƒ…é—®é¢˜å—ï¼Ÿ'
        },
        maxScore: {
          name: 'å¤©é€‰ç”·åŒğŸŒˆ',
          desc: 'è¾¾åˆ°æ»¡åˆ†100åˆ†',
          msg: 'ğŸ† æ»¡åˆ†ï¼ä½ å°±æ˜¯å¤©é€‰ä¹‹å­ï¼Œç”·åŒä¹‹ç¥ï¼'
        }
      };

      // DOMå…ƒç´ è·å–ï¼ˆæ–°å¢å¼¹çª—å…ƒç´ ï¼‰
      const gridEl = document.getElementById('grid');
      const timerEl = document.getElementById('timer');
      const scoreEl = document.getElementById('score');
      const messageEl = document.getElementById('message');
      const questionTextEl = document.getElementById('questionText');
      const roundEl = document.getElementById('round');
      const btnStart = document.getElementById('btnStart');
      const btnRestart = document.getElementById('btnRestart');
      const btnEndGame = document.getElementById('btnEndGame');
      const adCloseBtn = document.getElementById('adCloseBtn');
      const adCloseModal = document.getElementById('adCloseModal');
      const btnAdOption1 = document.getElementById('btnAdOption1');
      const btnAdOption2 = document.getElementById('btnAdOption2');
      const btnAdOption3 = document.getElementById('btnAdOption3');
      // å¼¹çª—å…ƒç´ 
      const overlay = document.getElementById('overlay');
      const scorePopup = document.getElementById('scorePopup');
      const scorePopupIcon = document.getElementById('scorePopupIcon');
      const scorePopupTitle = document.getElementById('scorePopupTitle');
      const scorePopupDesc = document.getElementById('scorePopupDesc');
      const scorePopupBtn = document.getElementById('scorePopupBtn');
      const achievementPopup = document.getElementById('achievementPopup');
      const achievementName = document.getElementById('achievementName');
      const achievementDesc = document.getElementById('achievementDesc');
      const achievementMsg = document.getElementById('achievementMsg');
      const achievementPopupBtn = document.getElementById('achievementPopupBtn');

      // æ¸¸æˆçŠ¶æ€ï¼ˆæ–°å¢æˆå°±ç›¸å…³çŠ¶æ€ï¼‰
      let timeLeft = CONFIG.timeLimit;
      let timer = null;
      let score = 0;
      let round = 0;
      let currentQuestion = null;
      let playable = false;
      let gameActive = false;
      let unlockedAchievements = new Set(); // å·²è§£é”æˆå°±é›†åˆ
      let triggeredScorePopups = new Set(); // å·²è§¦å‘çš„åˆ†æ•°å¼¹çª—é›†åˆ

      // æ˜¾ç¤ºé€šç”¨å¼¹çª—ï¼ˆé®ç½©+å¼¹çª—è”åŠ¨ï¼‰
      function showPopup(popupEl) {
        overlay.classList.add('show');
        popupEl.classList.add('show');
        // æ‰‹æœºç«¯ï¼šå¼¹çª—æ˜¾ç¤ºæ—¶ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
        document.body.style.overflow = 'hidden';
      }

      // å…³é—­é€šç”¨å¼¹çª—
      function closePopup(popupEl) {
        overlay.classList.remove('show');
        popupEl.classList.remove('show');
        document.body.style.overflow = 'auto';
      }

      // æ˜¾ç¤ºåˆ†æ•°é‡Œç¨‹ç¢‘å¼¹çª—ï¼ˆ50åˆ†/100åˆ†ï¼‰
      function showScorePopup(score) {
        if (triggeredScorePopups.has(score)) return; // é¿å…é‡å¤è§¦å‘
        triggeredScorePopups.add(score);

        if (score === 50) {
          scorePopupIcon.textContent = 'ğŸ‰';
          scorePopupTitle.textContent = 'å¤ªæ£’äº†ï¼';
          scorePopupDesc.textContent = 'ä½ å·²ç»è·å¾—äº†50åˆ†ï¼ç¦»æ»¡åˆ†ä¸è¿œäº†ï¼';
        } else if (score === CONFIG.maxScore) {
          scorePopupIcon.textContent = 'ğŸ†';
          scorePopupTitle.textContent = 'æ»¡åˆ†ï¼';
          scorePopupDesc.textContent = 'ä½ è·å¾—äº†100åˆ†ï¼å¤©é€‰ç”·åŒéä½ è«å±ï¼';
          unlockAchievement('maxScore'); // 100åˆ†è§£é”æˆå°±
        }

        showPopup(scorePopup);
      }

      // è§£é”æˆå°±å¹¶æ˜¾ç¤ºå¼¹çª—
      function unlockAchievement(achievementId) {
        if (unlockedAchievements.has(achievementId)) return; // é¿å…é‡å¤è§£é”
        unlockedAchievements.add(achievementId);

        const achievement = ACHIEVEMENTS[achievementId];
        if (achievement) {
          achievementName.textContent = achievement.name;
          achievementDesc.textContent = achievement.desc;
          achievementMsg.textContent = achievement.msg;
          showPopup(achievementPopup);
        }
      }

      // éšæœºæ‰“ä¹±æ•°ç»„
      function shuffleArr(arr) {
        const newArr = [...arr];
        const indexes = Array.from(arr.keys());
        for (let i = newArr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
          [indexes[i], indexes[j]] = [indexes[j], indexes[i]];
        }
        return { arr: newArr, indexes };
      }

      // æ¸²æŸ“æ¸¸æˆç½‘æ ¼
      function renderGrid() {
        gridEl.innerHTML = '';
        const { arr: shuffledImgs, indexes: originalIndexes } = shuffleArr(CONFIG.images);
        shuffledImgs.forEach((imgSrc, i) => {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.setAttribute('data-original-idx', originalIndexes[i]);
          const img = document.createElement('img');
          img.src = imgSrc;
          img.alt = `è§’è‰²${i+1}`;
          cell.appendChild(img);
          // æ‰‹æœºç«¯è§¦æ‘¸ä¼˜å…ˆ
          cell.ontouchend = (e) => {
            e.preventDefault();
            handleCellClick(cell);
          };
          cell.onclick = () => handleCellClick(cell);
          gridEl.appendChild(cell);
        });
      }

      // å¼€å§‹æ–°ä¸€è½®
      function startRound() {
        if (timer) clearInterval(timer);
        timeLeft = CONFIG.timeLimit;
        timerEl.textContent = `${timeLeft}s`;
        round++;
        roundEl.textContent = round;
        currentQuestion = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
        questionTextEl.textContent = currentQuestion.text;
        renderGrid();
        playable = true;
        showMessage('', '');

        timer = setInterval(() => {
          timeLeft--;
          timerEl.textContent = `${timeLeft}s`;
          if (timeLeft <= 0) {
            clearInterval(timer);
            playable = false;
            showMessage('æ‚é±¼ æ…¢æ­»äº†', 'lose');
            setTimeout(() => gameActive && startRound(), 1000);
          }
        }, 1000);
      }

      // å¤„ç†å•å…ƒæ ¼ç‚¹å‡»
      function handleCellClick(cell) {
        if (!playable) return;
        playable = false;
        clearInterval(timer);
        const originalIdx = Number(cell.getAttribute('data-original-idx'));
        const res = currentQuestion.onSelect ? currentQuestion.onSelect(originalIdx) : null;

        if (currentQuestion.type === 'single') {
          if (originalIdx === currentQuestion.correctIdx) {
            if (score < CONFIG.maxScore) {
              score += CONFIG.pointsPerCorrect;
              if (score > CONFIG.maxScore) score = CONFIG.maxScore;
              scoreEl.textContent = score;
              showMessage(currentQuestion.onCorrect, 'win');
              // æ£€æŸ¥åˆ†æ•°é‡Œç¨‹ç¢‘
              if (score === 50 || score === CONFIG.maxScore) {
                showScorePopup(score);
              }
              // æ£€æŸ¥æˆå°±è§£é”
              if (currentQuestion.achievement) {
                unlockAchievement(currentQuestion.achievement);
              }
            } else {
              showMessage('å·²ç»...æé™äº†â™‚â™‚â™‚', 'limit');
            }
          } else {
            showMessage(currentQuestion.onWrong, 'lose');
          }
        } else if (res) {
          res.ok ? showMessage(res.msg, 'win') : showMessage(res.msg, 'lose');
          if (res.ok && score < CONFIG.maxScore) {
            score += CONFIG.pointsPerCorrect;
            if (score > CONFIG.maxScore) score = CONFIG.maxScore;
            scoreEl.textContent = score;
            // æ£€æŸ¥åˆ†æ•°é‡Œç¨‹ç¢‘
            if (score === 50 || score === CONFIG.maxScore) {
              showScorePopup(score);
            }
          }
        }

        // å¼¹çª—æ˜¾ç¤ºæ—¶ä¸è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€è½®ï¼Œå…³é—­å¼¹çª—åå†ç»§ç»­
        if (!scorePopup.classList.contains('show') && !achievementPopup.classList.contains('show')) {
          setTimeout(() => gameActive && startRound(), 1000);
        }
      }

      // æ˜¾ç¤ºæ¸¸æˆæ¶ˆæ¯
      function showMessage(text, type) {
        messageEl.textContent = text;
        messageEl.className = 'message';
        if (type === 'win') messageEl.classList.add('win');
        else if (type === 'lose') messageEl.classList.add('lose');
        else if (type === 'limit') messageEl.classList.add('limit');
      }

      // é‡ç½®æ¸¸æˆ
      function resetGame() {
        if (timer) clearInterval(timer);
        round = 0;
        score = 0;
        timeLeft = CONFIG.timeLimit;
        timerEl.textContent = '--';
        scoreEl.textContent = '0';
        roundEl.textContent = 'â€”';
        gridEl.innerHTML = '';
        showMessage('ç‚¹å‡»"å¼€å§‹â™‚æ¸¸æˆ"å¼€å§‹æŒ‘æˆ˜', '');
        btnEndGame.style.display = 'none';
        gameActive = false;
        // é‡ç½®å¼¹çª—è§¦å‘çŠ¶æ€
        triggeredScorePopups.clear();
      }

      // ç»“æŸæ¸¸æˆ
      function endGame() {
        gameActive = false;
        if (timer) clearInterval(timer);
        playable = false;
        resetGame();
        showMessage('æ¸¸æˆå·²ç»“æŸ', 'win');
      }

      // å¹¿å‘Šç›¸å…³é€»è¾‘
      function openAd() {
        const newTab = window.open(CONFIG.adLink, '_blank');
        !newTab && showMessage('è¯·å…è®¸å¼¹å‡ºçª—å£æŸ¥çœ‹å¹¿å‘Š', 'lose');
        adCloseModal.classList.remove('show');
      }

      function closeAdWithInsult() {
        showMessage('æ”¾ä½ çš„å±ã€‚', 'lose');
        adCloseModal.classList.remove('show');
        document.querySelector('footer.ad').style.display = 'none';
      }

      function closeAdWithTaunt() {
        showMessage('ä½ ç…å•¥ï¼Ÿ', 'lose');
        adCloseModal.classList.remove('show');
        document.querySelector('footer.ad').style.display = 'none';
      }

      // äº‹ä»¶ç»‘å®šï¼ˆæ–°å¢å¼¹çª—æŒ‰é’®äº‹ä»¶ï¼‰
      // å¼€å§‹æ¸¸æˆ
      btnStart.ontouchend = (e) => {
        e.preventDefault();
        gameActive = true;
        btnEndGame.style.display = 'inline-block';
        startRound();
      };
      btnStart.onclick = () => {
        gameActive = true;
        btnEndGame.style.display = 'inline-block';
        startRound();
      };

      // é‡ç½®æ¸¸æˆ
      btnRestart.ontouchend = (e) => {
        e.preventDefault();
        resetGame();
      };
      btnRestart.onclick = resetGame;

      // ç»“æŸæ¸¸æˆ
      btnEndGame.ontouchend = (e) => {
        e.preventDefault();
        endGame();
      };
      btnEndGame.onclick = endGame;

      // å¹¿å‘Šå…³é—­
      adCloseBtn.ontouchend = (e) => {
        e.preventDefault();
        adCloseModal.classList.add('show');
      };
      adCloseBtn.onclick = () => adCloseModal.classList.add('show');

      // æ¨¡æ€æ¡†é€‰é¡¹
      btnAdOption1.ontouchend = (e) => {
        e.preventDefault();
        openAd();
      };
      btnAdOption1.onclick = openAd;

      btnAdOption2.ontouchend = (e) => {
        e.preventDefault();
        closeAdWithInsult();
      };
      btnAdOption2.onclick = closeAdWithInsult;

      btnAdOption3.ontouchend = (e) => {
        e.preventDefault();
        closeAdWithTaunt();
      };
      btnAdOption3.onclick = closeAdWithTaunt;

      // å¼¹çª—æŒ‰é’®
      scorePopupBtn.ontouchend = (e) => {
        e.preventDefault();
        closePopup(scorePopup);
        // å…³é—­å¼¹çª—åç»§ç»­ä¸‹ä¸€è½®
        if (gameActive) {
          setTimeout(() => startRound(), 300);
        }
      };
      scorePopupBtn.onclick = () => {
        closePopup(scorePopup);
        if (gameActive) {
          setTimeout(() => startRound(), 300);
        }
      };

      achievementPopupBtn.ontouchend = (e) => {
        e.preventDefault();
        closePopup(achievementPopup);
        // å…³é—­å¼¹çª—åç»§ç»­ä¸‹ä¸€è½®
        if (gameActive) {
          setTimeout(() => startRound(), 300);
        }
      };
      achievementPopupBtn.onclick = () => {
        closePopup(achievementPopup);
        if (gameActive) {
          setTimeout(() => startRound(), 300);
        }
      };

      // æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
      adCloseModal.ontouchend = (e) => {
        if (e.target === adCloseModal) adCloseModal.classList.remove('show');
      };
      adCloseModal.onclick = (e) => {
        if (e.target === adCloseModal) adCloseModal.classList.remove('show');
      };

      // åˆå§‹åŒ–
      resetGame();
    };
  </script>
</body>
</html>