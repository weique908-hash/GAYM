<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä½ å¥½å•Šæˆ‘æ˜¯ç”·åŒ</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ffb86b;--muted:#94a3b8;--win:#34d399;--lose:#fb7185;font-family:Inter,system-ui,Arial}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#071025);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{font-size:18px;margin:0}
    p.lead{margin:6px 0 0;font-size:13px;color:var(--muted)}
    .game-area{display:flex;gap:12px;margin-top:12px}
    .board{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .cell{background:#0c1220;border-radius:8px;padding:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;min-height:120px}
    .cell img{max-width:100%;max-height:100%;object-fit:contain;border-radius:6px}
    .sidebar{width:220px;display:flex;flex-direction:column;gap:10px}
    .stat{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;text-align:center}
    .controls{display:flex;gap:8px}
    .btn{background:var(--accent);border:none;padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
    .message{padding:8px;border-radius:8px;text-align:center;display:none}
    .message.show{display:block}
    .message.win{color:var(--win)}
    .message.lose{color:var(--lose)}
    .score-notice{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(15,23,36,0.95);border:2px solid var(--accent);border-radius:8px;padding:12px 20px;font-size:18px;font-weight:700;color:var(--accent);z-index:999;animation:popup 0.3s ease-in-out;display:none}
    .score-notice.show{display:block}
    @keyframes popup{0%{opacity:0;transform:translateX(-50%) translateY(-20px)}100%{opacity:1;transform:translateX(-50%) translateY(0)}}
    footer.ad{margin-top:12px;display:flex;justify-content:space-between;align-items:center}
    .cta{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;background:var(--accent);color:#071025;font-weight:700;text-decoration:none}
    .flash{animation:flash 1s linear infinite}
    @keyframes flash{0%,100%{opacity:1}50%{opacity:0.25}}
    @media (max-width:700px){.game-area{flex-direction:column}.sidebar{width:100%;flex-direction:row}}
  </style>
</head>
<body>
  <div class="card">
    <header>
      <div>
        <h1>ä½ å¥½å•Šæˆ‘æ˜¯ç”·åŒ</h1>
        <p class="lead">æ¯å…³æ˜¯éšæœºé¢˜ç›®ã€‚è¯·æŒ‰ä¸‹é¢â€œå¼€å§‹â€æµ‹è¯•ã€‚å›¾ç‰‡ä¸å¹¿å‘Šç´ æè¯·æ›¿æ¢ä¸ºä½ çš„æ–‡ä»¶æˆ–å¤–é“¾ã€‚</p>
      </div>
      <div style="font-size:12px;color:var(--muted)">é€‚åˆå½“ä½œäº’åŠ¨å¹¿å‘Šç´ æ</div>
    </header>

    <div class="game-area">
      <div class="board">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-size:13px;color:var(--muted)">å…³å¡ï¼š<span id="round">â€”</span></div>
          <div id="questionText" style="font-size:13px;color:var(--muted)">é¢˜ç›®å°†éšæœºå‡ºç°</div>
        </div>

        <div id="grid" class="grid" aria-label="è§’è‰²ç½‘æ ¼"></div>
        <div id="message" class="message" role="status" aria-live="polite"></div>
      </div>

      <aside class="sidebar">
        <div class="stat"><div style="font-size:12px;color:var(--muted)">å€’è®¡æ—¶</div><div id="timer" style="font-size:18px;font-weight:700">--</div></div>
        <div class="stat"><div style="font-size:12px;color:var(--muted)">åˆ†æ•°</div><div id="score" style="font-size:18px;font-weight:700">0</div></div>
        <div class="controls"><button id="btnRestart" class="btn secondary">é‡ç½®</button><button id="btnStart" class="btn">å¼€å§‹</button></div>
        <div style="font-size:12px;color:var(--muted);margin-top:6px">æç¤ºï¼šç‚¹å‡»ä»»ä¸€å›¾ç‰‡é€‰æ‹©ç­”æ¡ˆï¼ˆå•é€‰ï¼‰</div>
      </aside>
    </div>

    <footer class="ad">
      <div style="font-size:13px;color:var(--muted)">å¹¿å‘ŠåŒºï¼ˆç‚¹å‡»å¯è·³è½¬åˆ°ä½ çš„æ¨å¹¿é¡µé¢ï¼‰</div>
      <a id="ctaLink" class="cta" href="#" role="link">
        <img id="ctaImg" src="flash.gif" alt="ç‚¹å‡»â™‚è¿™é‡Œï¼ˆæˆ‘è¿˜æ²¡è°ƒå¥½ï¼‰" style="width:36px;height:36px;object-fit:cover;border-radius:6px"> 
        <span class="flash">ç‚¹å‡»â™‚è¿™é‡Œï¼ˆæˆ‘è¿˜æ²¡è°ƒå¥½ï¼‰</span>
      </a>
    </footer>
  </div>
  <div id="scoreNotice" class="score-notice"></div>

  <script>
    const CONFIG = {
      images: [
        "img1.jpg",
        "img2.jpg",
        "img3.jpg",
        "img4.jpg"
      ],
      adMedia: "ad-banner.gif",
      adLink: "https://ä½ çš„æ¨å¹¿é“¾æ¥.com",
      timeLimit: 12,
      maxScore: 100, // æ–°å¢ï¼šæ»¡åˆ†è®¾ç½®
    };

    const QUESTIONS = [
      {
        id:1,
        text: 'æ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç”·åŒ',
        type:'special-single',
        onSelect: function(idx){
          return {ok:false, msg:'å“ˆå“ˆéª—ä½ çš„ï¼Œæˆ‘åªè®¾ç½®äº†å•é€‰'};
        }
      },
      {
        id:2,
        text: 'æ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆ',
        type:'single',
        correctOriginalIndex: 0,
        onCorrectMsg: 'ä½ çœ‹èµ·æ¥å¾ˆå¥½åƒ',
        onWrongMsg: 'Cazzoï¼Œä½ ä¸è®¤è¯†æˆ‘å—'
      },
      {
        id:3,
        text: 'æ‰¾å‡ºå”¯ä¸€ä¸€ä¸ªdndäººç‰©',
        type:'single',
        correctOriginalIndex: 1,
        onCorrectMsg: 'ğŸ¶é»‘å¿ƒå°è›‹ç³•ä¸€æšå£ç‰™ğŸ°',
        onWrongMsg: 'æ··è›‹ äºšå½“æ–¯è¦æ¥ç‚¸ä½ å®¶äº†'
      },
      {
        id:4,
        text: 'æ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ',
        type:'single',
        correctOriginalIndex: 3,
        onWrongMsg: 'å†é€‰é”™å°±è¿‡æ¥å¿ƒç†æ²»ç–—',
        onCorrectMsg: 'éš”å£ä»–ç”·äººåœ¨åŒæŒing'
      },
      {
        id:5,
        text: 'æ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·',
        type:'single-multi-text',
        onSelect: function(originalIndex){
          if(originalIndex===0||originalIndex===1) return {ok:true, msg:'ğŸ’æˆ‘ä»¬æ˜¯çœŸæ­£çš„â™‚ç›´ç”·â™‚å‘€'};
          return {ok:true, msg:'ğŸŒˆğŸŒˆğŸŒˆéª„å‚²ä¹‹â™‚GAYğŸŒˆğŸŒˆğŸŒˆ'};
        }
      }
    ];

    let gridEl = document.getElementById('grid');
    let timerEl = document.getElementById('timer');
    let scoreEl = document.getElementById('score');
    let messageEl = document.getElementById('message');
    let questionTextEl = document.getElementById('questionText');
    let roundEl = document.getElementById('round');
    let ctaLink = document.getElementById('ctaLink');
    let ctaImg = document.getElementById('ctaImg');
    let scoreNoticeEl = document.getElementById('scoreNotice');

    let timeLeft = CONFIG.timeLimit;
    let timer = null;
    let score = 0;
    let round = 0;
    let currentQuestion = null;
    let playable = false;
    let shuffledOriginalIndexes = [];
    let triggeredScoreNotices = new Set();

    ctaImg.src = CONFIG.adMedia;
    ctaLink.href = CONFIG.adLink;

    function shuffleArrayWithIndex(array) {
      const newArr = [...array];
      const originalIndexes = Array.from(array.keys());
      for (let i = newArr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        [originalIndexes[i], originalIndexes[j]] = [originalIndexes[j], originalIndexes[i]];
      }
      return { shuffledArr: newArr, originalIndexes: originalIndexes };
    }

    function showScoreNotice(text) {
      scoreNoticeEl.textContent = text;
      scoreNoticeEl.classList.add('show');
      setTimeout(() => {
        scoreNoticeEl.classList.remove('show');
      }, 3000);
    }

    function checkScoreMilestone() {
      if (score >= 50 && !triggeredScoreNotices.has(50)) {
        showScoreNotice('å¤ªæ£’äº†ï¼50åˆ†ï¼');
        triggeredScoreNotices.add(50);
      }
      if (score >= CONFIG.maxScore && !triggeredScoreNotices.has(CONFIG.maxScore)) {
        showScoreNotice('100åˆ†ï¼å¤©å‘ä½ å°±æ˜¯ç”·åŒä¹‹ç¥ï¼');
        triggeredScoreNotices.add(CONFIG.maxScore);
      }
    }

    function renderGrid(){
      gridEl.innerHTML = '';
      const imgs = CONFIG.images.slice(0,4);
      const { shuffledArr, originalIndexes } = shuffleArrayWithIndex(imgs);
      shuffledOriginalIndexes = originalIndexes;
      for(let i=0;i<4;i++){
        const cell = document.createElement('button');
        cell.className = 'cell';
        cell.setAttribute('data-visual-index', i);
        const img = document.createElement('img');
        img.alt = `è§’è‰² ${i+1}`;
        img.src = shuffledArr[i] || '';
        cell.appendChild(img);
        cell.addEventListener('click', onCellClick);
        gridEl.appendChild(cell);
      }
    }

    function startRound(){
      if(timer) clearInterval(timer);
      timeLeft = CONFIG.timeLimit;
      timerEl.textContent = timeLeft + 's';
      round++;
      roundEl.textContent = round;
      currentQuestion = QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)];
      questionTextEl.textContent = currentQuestion.text;
      renderGrid();
      playable = true;
      setMessage('','');
      timer = setInterval(()=>{
        timeLeft--;
        timerEl.textContent = timeLeft + 's';
        if(timeLeft<=0){
          clearInterval(timer);
          playable = false;
          handleTimeout();
        }
      },1000);
    }

    function handleTimeout(){
      if(!currentQuestion) return;
      if(currentQuestion.type==='special-single'){
        setMessage('å“ˆå“ˆéª—ä½ çš„ï¼Œæˆ‘åªè®¾ç½®äº†å•é€‰','lose');
        return;
      }
      setMessage('æ‚é±¼ æ…¢æ­»äº†','lose');
      setTimeout(()=>{startRound();},1300);
    }

    function onCellClick(e){
      if(!playable) return;
      playable = false;
      clearInterval(timer);
      const visualIndex = Number(e.currentTarget.getAttribute('data-visual-index'));
      const originalIndex = shuffledOriginalIndexes[visualIndex];

      if(currentQuestion.type==='special-single'){
        setMessage('å“ˆå“ˆéª—ä½ çš„ï¼Œæˆ‘åªè®¾ç½®äº†å•é€‰','lose');
        setTimeout(()=>{startRound();},1200);
        return;
      }

      if(currentQuestion.type==='single'){
        if(originalIndex===currentQuestion.correctOriginalIndex){
          // ä¿®æ”¹ï¼šåˆ†æ•°ä¸è¶…è¿‡æ»¡åˆ†
          if (score < CONFIG.maxScore) {
            score += 10;
            scoreEl.textContent = score;
            checkScoreMilestone();
            setMessage(currentQuestion.onCorrectMsg,'win');
          } else {
            // æ»¡åˆ†åæ˜¾ç¤ºæé™æç¤º
            setMessage('å·²ç»...æé™äº†â™‚â™‚â™‚','win');
          }
        } else {
          setMessage(currentQuestion.onWrongMsg,'lose');
        }
        setTimeout(()=>{startRound();},1300);
        return;
      }

      if(currentQuestion.type==='single-multi-text'){
        const res = currentQuestion.onSelect(originalIndex);
        if(res){
          if(res.ok){
            // ä¿®æ”¹ï¼šåˆ†æ•°ä¸è¶…è¿‡æ»¡åˆ†
            if (score < CONFIG.maxScore) {
              score += 6;
              scoreEl.textContent = score;
              checkScoreMilestone();
              setMessage(res.msg,'win');
            } else {
              // æ»¡åˆ†åæ˜¾ç¤ºæé™æç¤º
              setMessage('å·²ç»...æé™äº†â™‚â™‚â™‚','win');
            }
          }
          else setMessage(res.msg,'lose');
        }
        setTimeout(()=>{startRound();},1300);
        return;
      }

      setMessage('å‘ç”Ÿé”™è¯¯ï¼Œé‡è¯•','lose');
      setTimeout(()=>{startRound();},1200);
    }

    function setMessage(text, type){
      messageEl.className = 'message';
      if(type==='win') messageEl.classList.add('win','show');
      else if(type==='lose') messageEl.classList.add('lose','show');
      if(text) messageEl.textContent = text; else messageEl.textContent = '';
    }

    document.getElementById('btnStart').addEventListener('click', ()=>{ 
      round=0; 
      score=0; 
      scoreEl.textContent=score;
      triggeredScoreNotices.clear();
      startRound(); 
    });
    document.getElementById('btnRestart').addEventListener('click', ()=>{ 
      if(timer) clearInterval(timer); 
      round=0; 
      score=0; 
      scoreEl.textContent=score; 
      timeLeft=CONFIG.timeLimit; 
      timerEl.textContent='--'; 
      gridEl.innerHTML=''; 
      setMessage('ç‚¹å‡»â€œå¼€å§‹â€å¼€å§‹æ¸¸æˆ','');
      triggeredScoreNotices.clear();
    });

    setMessage('ç‚¹å‡»â€œå¼€å§‹â€å¼€å§‹æ¸¸æˆ','');
  </script>
</body>
</html>