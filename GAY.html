<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>ç­”é¢˜æŒ‘æˆ˜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      font-family: "Helvetica Neue", Arial, sans-serif;
      pointer-events: auto !important;
    }
    body {
      background: #121212;
      color: #ffffff;
      min-height: 100vh;
      padding: 16px;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      opacity: 1 !important;
    }
    .game-container {
      max-width: 500px;
      margin: 0 auto;
      background: #1e1e1e;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      position: relative;
      z-index: 10;
    }
    .game-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .game-title {
      font-size: 22px;
      color: #ffd700;
      margin-bottom: 8px;
    }
    .game-subtitle {
      font-size: 14px;
      color: #aaaaaa;
    }
    .question-area {
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .question-text {
      font-size: 18px;
      color: #ffffff;
      text-align: center;
      margin-bottom: 8px;
    }
    .round-info {
      font-size: 14px;
      color: #888888;
      text-align: right;
    }
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .option-item {
      background: #2d2d2d;
      border-radius: 12px;
      padding: 8px;
      aspect-ratio: 1/1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
      min-height: 120px;
      z-index: 15;
      position: relative;
    }
    .option-item:active, .option-item:focus {
      border-color: #ffd700;
      outline: none;
    }
    .option-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    .img-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888888;
      font-size: 14px;
      background: #333333;
      border-radius: 8px;
    }
    .status-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .status-item {
      text-align: center;
    }
    .status-label {
      font-size: 12px;
      color: #888888;
      margin-bottom: 4px;
    }
    .status-value {
      font-size: 20px;
      color: #ffd700;
      font-weight: bold;
    }
    .btn-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    .game-btn {
      flex: 1;
      padding: 16px 0;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      touch-action: manipulation;
      min-height: 48px;
      z-index: 999;
      position: relative;
    }
    .btn-primary {
      background: #ffd700;
      color: #121212;
    }
    .btn-secondary {
      background: #444444;
      color: #ffffff;
    }
    .game-btn:active {
      opacity: 0.8;
    }
    .message-box {
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
      font-size: 16px;
    }
    .msg-win {
      background: #006400;
      color: #ffffff;
    }
    .msg-lose {
      background: #8b0000;
      color: #ffffff;
    }
    .msg-normal {
      background: #2d2d2d;
      color: #aaaaaa;
    }
    /* å¹¿å‘Šå‘¼å¸é—ªçƒåŠ¨ç”» */
    .ad-section {
      margin-bottom: 16px;
      padding: 16px;
      background: #2d2d2d;
      border-radius: 12px;
      position: relative;
      animation: breath 2s infinite ease-in-out;
      z-index: 15;
    }
    @keyframes breath {
      0%,100% { opacity: 0.8; box-shadow: 0 0 8px rgba(255, 99, 71, 0.3); }
      50% { opacity: 1; box-shadow: 0 0 15px rgba(255, 99, 71, 0.6); }
    }
    .ad-close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      position: relative;
    }
    .ad-title {
      font-size: 16px;
      color: #ffd700;
      margin-bottom: 12px;
      text-align: center;
    }
    .ad-cover {
      width: 100%;
      height: 120px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ad-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .ad-cta {
      display: block;
      width: 100%;
      padding: 12px 0;
      background: #ff6347;
      color: #ffffff;
      text-align: center;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 8px;
      z-index: 999;
      position: relative;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
    }
    .modal-container {
      background: #1e1e1e;
      border-radius: 16px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
      z-index: 110;
    }
    .modal-title {
      font-size: 20px;
      color: #ffd700;
      text-align: center;
      margin-bottom: 20px;
    }
    .modal-btn-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    .modal-btn {
      flex: 1;
      padding: 12px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      z-index: 120;
      position: relative;
    }
    .ad-img-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
    }
    .ad-img-content {
      max-width: 90%;
      max-height: 80%;
      border-radius: 12px;
      overflow: hidden;
      z-index: 210;
    }
    .ad-img-content img {
      width: 100%;
      height: auto;
    }
    .ad-img-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 220;
      position: relative;
    }
    .achievement-wall {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #121212;
      z-index: 300;
      padding: 20px;
      overflow-y: auto;
      display: none;
    }
    .achievement-wall.show {
      display: block;
    }
    .achievement-wall-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .achievement-wall-title {
      font-size: 22px;
      color: #ffd700;
    }
    .achievement-close-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 310;
      position: relative;
    }
    /* æˆå°±æ ·å¼ï¼šéšè—æˆå°±ç´«è‰²è¾¹æ¡† + æœªè¾¾æˆä»…æ˜¾ç¤ºåç§° */
    .achievement-item {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 4px solid #ffd700;
    }
    .achievement-item.hidden {
      border-left-color: #9932cc;
    }
    .achievement-name {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 4px;
    }
    /* æœªè·å¾—æˆå°±éšè—æè¿°å’Œæ–¹æ³• */
    .achievement-desc, .achievement-method {
      display: none;
    }
    /* å·²è·å¾—æˆå°±æ˜¾ç¤ºæè¿°å’Œæ–¹æ³• */
    .achievement-item.unlocked .achievement-desc {
      display: block;
      font-size: 14px;
      color: #aaaaaa;
      margin-bottom: 4px;
    }
    .achievement-item.unlocked .achievement-method {
      display: block;
      font-size: 12px;
      color: #ff6347;
    }
    .hidden-cls {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- æ¸¸æˆä¸»å®¹å™¨ -->
  <div class="game-container">
    <div class="game-header">
      <h1 class="game-title">è·‘å›¢â™‚é‡Œä¸æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä¸æ¥å—ï¼</h1>
      <p class="game-subtitle">ç‚¹å‡»æ­£ç¡®é€‰é¡¹ï¼Œèµ¢å–åˆ†æ•°</p>
    </div>

    <div class="question-area">
      <p class="question-text" id="questionText">å‡†å¤‡å¼€å§‹æ¸¸æˆ</p>
      <p class="round-info">å…³å¡: <span id="roundNum">0</span></p>
    </div>

    <div class="options-grid" id="optionsGrid"></div>

    <div class="message-box msg-normal" id="messageBox">ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜</div>

    <div class="status-bar">
      <div class="status-item">
        <p class="status-label">åˆ†æ•°</p>
        <p class="status-value" id="scoreNum">0</p>
      </div>
      <div class="status-item">
        <p class="status-label">å€’è®¡æ—¶</p>
        <p class="status-value" id="timerNum">--</p>
      </div>
    </div>

    <div class="btn-group">
      <button class="game-btn btn-primary" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="resetBtn">é‡ç½®æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="achievementBtn">æˆå°±å¢™</button>
      <button class="game-btn btn-secondary" id="resetAchieveBtn">é‡ç½®æˆå°±</button>
    </div>

    <!-- åŸæœ‰å¹¿å‘ŠåŒºåŸŸï¼šæ˜¾ç¤ºå¹¿å‘Šå°é¢GIF -->
    <div class="ad-section" id="originalAd">
      <button class="ad-close-btn" id="originalAdClose">Ã—</button>
      <h3 class="ad-title">å¿«â¤ï¸è¿›â¤ï¸æ¥â¤ï¸</h3>
      <div class="ad-cover">
        <img src="å¹¿å‘Šå°é¢.gif" alt="å¹¿å‘Šå°é¢" id="adCoverGif">
      </div>
      <a href="javascript:;" class="ad-cta" id="originalAdCta">ç‚¹å‡»æŸ¥çœ‹éšæœºå¹¿å‘Šå›¾</a>
    </div>

    <!-- æ–°å¹¿å‘ŠåŒºåŸŸï¼šå¸•å­—å›¾ç‰‡ä»…ç”¨äºæ­¤å¹¿å‘Š -->
    <div class="ad-section" id="newAd">
      <button class="ad-close-btn" id="newAdClose">Ã—</button>
      <h3 class="ad-title">â™‚â™‚ç«çƒ­æ¢è£… åœ¨çº¿æ¼«ç”»â™‚â™‚</h3>
      <a href="javascript:;" class="ad-cta" id="newAdCta">ç‚¹å‡»æŸ¥çœ‹æ½®æµç©¿æ­</a>
    </div>
  </div>

  <!-- å¹¿å‘Šå…³é—­ç¡®è®¤å¼¹çª— -->
  <div class="modal-overlay hidden-cls" id="adConfirmModal">
    <div class="modal-container">
      <h3 class="modal-title">ä¸è¿›æ¥çœ‹çœ‹å—ï¼Ÿ</h3>
      <div class="modal-btn-group">
        <button class="modal-btn btn-primary" id="adConfirmBtn">å¥½å§ï¼Œæ¥äº†â¤ï¸</button>
        <button class="modal-btn btn-secondary" id="adCancelBtn">å‘ƒâ†“ï¼Œæˆ‘æ˜¯ç›´ç”·</button>
      </div>
    </div>
  </div>

  <!-- é‡ç½®æˆå°±ç¡®è®¤å¼¹çª— -->
  <div class="modal-overlay hidden-cls" id="resetAchieveModal">
    <div class="modal-container">
      <h3 class="modal-title">æ˜¯å¦é‡ç½®æˆå°±ï¼Ÿ</h3>
      <div class="modal-btn-group">
        <button class="modal-btn btn-primary" id="resetAchieveConfirm">æ˜¯</button>
        <button class="modal-btn btn-secondary" id="resetAchieveYeah">yeahâ™‚</button>
      </div>
    </div>
  </div>

  <!-- å¹¿å‘Šå›¾ç‰‡å¼¹çª— -->
  <div class="ad-img-modal hidden-cls" id="adImgModal">
    <button class="ad-img-close" id="adImgCloseBtn">Ã—</button>
    <div class="ad-img-content" id="adImgContent"></div>
  </div>

  <!-- æˆå°±å¢™ -->
  <div class="achievement-wall" id="achievementWall">
    <div class="achievement-wall-header">
      <h2 class="achievement-wall-title">æˆå°±å¢™</h2>
      <button class="achievement-close-btn" id="achievementWallClose">Ã—</button>
    </div>
    <div id="achievementList"></div>
  </div>

  <script>
// ========== é…ç½®é¡¹ ==========
    const CONFIG = {
      // ç­”é¢˜ç´ æï¼šç§»é™¤å¸•å­—å›¾ç‰‡ï¼Œä»…ä¿ç•™æ ¸å¿ƒè§’è‰²
      answerImages: {
        'é…’é¦†ä¼™è®¡': 'é…’é¦†ä¼™è®¡.png',
        'å®‹': 'å®‹.jpg',
        'æœå—': 'æœå—.jpg',
        'Adams': 'Adams.jpg',
        'æ­£ç»è¡£æœ': 'æ­£ç»è¡£æœ.jpg',
        'img1': 'img1.jpg',
        'img2': 'img2.jpg',
        'img3': 'img3.jpg',
        'img4': 'img4.jpg'
      },
      // å¹¿å‘Šç´ æï¼šä¿ç•™å¸•å­—å›¾ç‰‡ç”¨äºæ–°å¹¿å‘Š
      adMaterials: {
        original: ['å¹¿å‘Š.png', 'å¹¿å‘Š2.jpg', 'å¹¿å‘Š3.jpg'],
        new: ['æ©™å¸•.jpg', 'æ½®ç”·å¸•.jpg', 'æ½®ç”·å¸•çš„åèƒŒ.jpg'],
        cover: 'å¹¿å‘Šå°é¢.gif'
      },
      // æ¢å¤æ‰€æœ‰åˆå§‹é¢˜ç›®
      questions: [
        {id:0,text:'æ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç”·åŒ',type:'special',onSelect:()=>({ok:false,msg:'å“ˆå“ˆéª—ä½ çš„ï¼Œæˆ‘åªè®¾ç½®äº†å•é€‰'})},
        {id:1,text:'æ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆ',type:'single',correctIdx:0,onCorrect:'ä½ çœ‹èµ·æ¥å¾ˆå¥½åƒ',onWrong:'Cazzoï¼Œä½ ä¸è®¤è¯†æˆ‘å—',achievement:'chef'},
        {id:2,text:'æ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ',type:'single',correctIdx:3,onCorrect:'éš”å£ä»–ç”·äººåœ¨åŒæŒing',onWrong:'å†é€‰é”™å°±è¿‡æ¥å¿ƒç†æ²»ç–—',achievement:'therapist'},
        {id:3,text:'æ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·',type:'multi-text',onSelect:(idx)=>{if(idx===0||idx===1){unlockAchievement('straight');return{ok:true,msg:'ğŸ’æˆ‘ä»¬æ˜¯çœŸæ­£çš„â™‚ç›´ç”·â™‚å‘€'};}else{unlockAchievement('gayPride');return{ok:true,msg:'ğŸŒˆğŸŒˆğŸŒˆéª„å‚²ä¹‹â™‚GAYğŸŒˆğŸŒˆğŸŒˆ'};}}},
        {id:4,text:'è°æ²¡æœ‰å¯¹è±¡ï¼Ÿ',type:'single-key',correct:'é…’é¦†ä¼™è®¡',msgWin:'å›ç­”æ­£ç¡®ï¼',msgLose:'å›ç­”é”™è¯¯ï¼',achievement:'pBrother'},
        {id:5,text:'é€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€‚',type:'single-key',correct:'å®‹',msgWin:'å®‹é…±å®‹é…±æˆ‘ä»¬å–œæ¬¢ä½ â¤ï¸',msgLose:'å¥½åƒä¹Ÿæ²¡é”™...',achievement:'deepWaterCity'},
        {id:6,text:'å¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿ',type:'single-key',correct:'æœå—',msgWin:'æœå“¥è¯·è¡¨æ¼”ä¸€ä¸‹é‚£ä¸ªï¼ğŸ’°ğŸ’°ğŸ’°',msgLose:'ä¸ï¼Œè¿™ä½åº”è¯¥ä¸ä¼šç»™ä½ é’±ã€‚',achievement:'goldCoin'},
        {id:7,text:'ä½ å¥½ã€‚è¯·å¬·â€”â€”',type:'single-key',correct:'Adams',msgWin:'â€œæˆ‘å¯æ˜¯ç›´ç”·å‘€ï¼â€',msgLose:'è¯¶ï¼Ÿé‚£ä¹Ÿä¸é”™ã€‚'}
      ],
      // æ¢å¤æ‰€æœ‰åˆå§‹æˆå°± + éšè—æˆå°±æ ‡è®°
      achievements: {
        straight: {name:'æˆ‘æ˜¯ç›´ç”·',desc:'å‹‡æ•¢æ‰¿è®¤è‡ªå·±çš„èº«ä»½',method:'é€‰æ‹©ã€Œæ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·ã€é¢˜ç›®ä¸­çš„ç›´ç”·é€‰é¡¹'},
        gayPride: {name:'éª„å‚²ä¹‹GAY',desc:'ä¸ºè‡ªå·±çš„èº«ä»½æ„Ÿåˆ°éª„å‚²',method:'é€‰æ‹©ã€Œæ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·ã€é¢˜ç›®ä¸­çš„GAYé€‰é¡¹'},
        chef: {name:'ä½ æ˜¯é£Ÿæå—',desc:'æ‰¾åˆ°çœŸæ­£çš„å¨å¸ˆ',method:'æ­£ç¡®å›ç­”ã€Œæ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆã€é¢˜ç›®'},
        therapist: {name:'å¿ƒç†æ²»ç–—å¸ˆ',desc:'æ‰¾åˆ°å¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ',method:'æ­£ç¡®å›ç­”ã€Œæ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆã€é¢˜ç›®'},
        maxScore: {name:'å¤©é€‰ç”·åŒğŸŒˆ',desc:'è¾¾åˆ°æ»¡åˆ†100åˆ†',method:'åœ¨æ¸¸æˆä¸­è·å¾—100åˆ†'},
        forgotWho: {name:'å¥½åƒå¿˜äº†è°...',desc:'æ€»è§‰å¾—æ¼æ‰äº†ä»€ä¹ˆé‡è¦çš„äºº',method:'è¿ç»­4æ¬¡ä¸é€‰æ‹©img3.jpgå›¾ç‰‡'},
        forceful: {name:'å¼ºäººæ‰€éš¾â™‚',desc:'å¯¹æŸä¸ªé€‰é¡¹æœ‰ç€æ‰§ç€çš„åçˆ±',method:'è¿ç»­4æ¬¡é€‰æ‹©img1.jpgå›¾ç‰‡'},
        omg: {name:'OMGâ™‚',desc:'ä½ å‘ç°äº†éšè—çš„ç§˜å¯†ï¼',method:'é‡ç½®æˆå°±æ—¶é€‰æ‹©"yeahâ™‚"é€‰é¡¹',hidden: true},
        pBrother: {name:'P...På¼Ÿï¼Ÿ',desc:'åœ¨ã€Œè°æ²¡æœ‰å¯¹è±¡ï¼Ÿã€é—®é¢˜ä¸­é€‰æ‹©é…’é¦†ä¼™è®¡',method:'å›ç­”ã€Œè°æ²¡æœ‰å¯¹è±¡ï¼Ÿã€é—®é¢˜å¹¶é€‰æ‹©é…’é¦†ä¼™è®¡'},
        witheredGrass: {name:'ç”Ÿå‘½ä¸ºä½•è‡ªç§°æ¯è‰ï¼Ÿ',desc:'è¿ç»­5æ¬¡ä¸é€‰æ‹©Adams',method:'ç­”é¢˜æ—¶è¿ç»­5æ¬¡ä¸é€‰Adamså›¾ç‰‡'},
        heLovesYou: {name:'ä»–è¯´ä»–çˆ±ä½ ã€‚',desc:'æœå—é¢˜ç›®ä¸­é€‰é”™img4è§¦å‘',method:'å›ç­”ã€Œå¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿã€æ—¶é€‰é”™è¯¯é€‰é¡¹img4'},
        goldCoin: {name:'çˆ†ç‚¹é‡‘å¸ï¼Ÿ',desc:'ç¬¬ä¸€æ¬¡é€‰æ‹©æœå—å¹¶ç­”å¯¹',method:'é¦–æ¬¡å›ç­”ã€Œå¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿã€æ—¶é€‰å¯¹æœå—'},
        deepWaterCity: {name:'æ·±æ°´åŸæ•…äº‹',desc:'æ­£ç¡®å›ç­”ã€Œé€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€',method:'ç­”å¯¹ã€Œé€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€é—®é¢˜'},
        fashionIcon: {name:'è¡£å“è¾¾äººâ¤ï¸',desc:'ç‚¹å¼€æ–°æ·»åŠ çš„å¹¿å‘Š',method:'ç‚¹å‡»ã€Œâ™‚â™‚ç«çƒ­æ¢è£… åœ¨çº¿æ¼«ç”»â™‚â™‚ã€å¹¿å‘Šå¹¶æŸ¥çœ‹'},
        schiller: {name:'Schiller.',desc:'ç‚¹å¼€åŸæœ‰å¹¿å‘Šå¹¶çœ‹åˆ°æŒ‡å®šå›¾ç‰‡',method:'ç‚¹å‡»åŸæœ‰å¹¿å‘Šä¸”éšæœºåˆ°ç¬¬ä¸€å¼ å¹¿å‘Šå›¾æ—¶è§£é”'}
      },
      timeLimit: 10, // å€’è®¡æ—¶æ”¹ä¸º10s
      scorePerCorrect: 5,
      maxScore: 100,
      maxAdRepeat: 2, // å¹¿å‘Šå›¾ç‰‡æœ€å¤šé‡å¤2æ¬¡
      maxQuestionRepeat: 2 // é¢˜ç›®æœ€å¤šè¿ç»­å‡ºç°2æ¬¡
    };

    // ========== å…¨å±€çŠ¶æ€ ==========
    let gameState = {
      isPlaying: false,
      currentQuestion: null,
      score: 0,
      round: 0,
      timeLeft: 0,
      timer: null,
      correctCount: 0,
      wrongCount: 0,
      consecutiveImg1Count: 0,
      consecutiveNotImg3Count: 0,
      consecutiveNotAdams: 0,
      firstChooseChaonan: false,
      hasGotPBrother: false,
      unlockedAchievements: new Set(JSON.parse(localStorage.getItem('unlockedAchievements')) || []),
      triggeredScorePopups: new Set(),
      // æ–°å¢ï¼šå¹¿å‘Šå›¾ç‰‡è®¡æ•°
      adImgRecord: { original: { lastImg: '', repeatCount: 0 }, new: { lastImg: '', repeatCount: 0 } },
      // æ–°å¢ï¼šé¢˜ç›®è®¡æ•°
      questionRecord: { lastId: -1, repeatCount: 0 },
      // æ–°å¢ï¼šé€‰é¡¹ä½ç½®è®¡æ•°
      positionRecord: { lastPos: -1, repeatCount: 0 }
    };

    // ========== DOMå…ƒç´  ==========
    const el = {
      questionText: document.getElementById('questionText'),
      roundNum: document.getElementById('roundNum'),
      optionsGrid: document.getElementById('optionsGrid'),
      messageBox: document.getElementById('messageBox'),
      scoreNum: document.getElementById('scoreNum'),
      timerNum: document.getElementById('timerNum'),
      startBtn: document.getElementById('startBtn'),
      resetBtn: document.getElementById('resetBtn'),
      achievementBtn: document.getElementById('achievementBtn'),
      resetAchieveBtn: document.getElementById('resetAchieveBtn'),
      originalAd: document.getElementById('originalAd'),
      originalAdClose: document.getElementById('originalAdClose'),
      originalAdCta: document.getElementById('originalAdCta'),
      newAd: document.getElementById('newAd'),
      newAdClose: document.getElementById('newAdClose'),
      newAdCta: document.getElementById('newAdCta'),
      adCoverGif: document.getElementById('adCoverGif'),
      adConfirmModal: document.getElementById('adConfirmModal'),
      adConfirmBtn: document.getElementById('adConfirmBtn'),
      adCancelBtn: document.getElementById('adCancelBtn'),
      adImgModal: document.getElementById('adImgModal'),
      adImgCloseBtn: document.getElementById('adImgCloseBtn'),
      adImgContent: document.getElementById('adImgContent'),
      resetAchieveModal: document.getElementById('resetAchieveModal'),
      resetAchieveConfirm: document.getElementById('resetAchieveConfirm'),
      resetAchieveYeah: document.getElementById('resetAchieveYeah'),
      achievementWall: document.getElementById('achievementWall'),
      achievementWallClose: document.getElementById('achievementWallClose'),
      achievementList: document.getElementById('achievementList')
    };
// ========== å·¥å…·å‡½æ•° ==========
    function handleImageError(img, altText) {
      img.onerror = () => {
        img.parentElement.innerHTML = `<div class="img-placeholder">${altText}<br>åŠ è½½å¤±è´¥</div>`;
      };
    }

    function shuffleArray(arr) {
      const newArr = [...arr];
      for (let i = newArr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
      }
      return newArr;
    }

    // å·¥å…·å‡½æ•°ï¼šè·å–ä¸é‡å¤çš„å¹¿å‘Šå›¾ç‰‡ï¼ˆæœ€å¤šé‡å¤2æ¬¡ï¼‰
    function getNonRepeatAdImg(type) {
      const adImgs = type === 'original' ? CONFIG.adMaterials.original : CONFIG.adMaterials.new;
      const record = gameState.adImgRecord[type];
      let candidateImgs = shuffleArray(adImgs);
      
      // é‡å¤æ¬¡æ•°æœªè¾¾ä¸Šé™ï¼Œä¿ç•™ä¸Šæ¬¡å›¾ç‰‡ï¼›è¾¾ä¸Šé™åˆ™æ’é™¤ä¸Šæ¬¡å›¾ç‰‡
      if (record.repeatCount >= CONFIG.maxAdRepeat) {
        candidateImgs = candidateImgs.filter(img => img !== record.lastImg);
      }
      const selectedImg = candidateImgs[0];

      // æ›´æ–°è®¡æ•°
      if (selectedImg === record.lastImg) {
        record.repeatCount++;
      } else {
        record.lastImg = selectedImg;
        record.repeatCount = 1;
      }
      return selectedImg;
    }

    // å·¥å…·å‡½æ•°ï¼šè·å–ä¸é‡å¤çš„é¢˜ç›®ï¼ˆæœ€å¤šè¿ç»­å‡ºç°2æ¬¡ï¼‰
    function getNonRepeatQuestion() {
      const record = gameState.questionRecord;
      let candidateQuestions = shuffleArray(CONFIG.questions);
      
      // é‡å¤æ¬¡æ•°æœªè¾¾ä¸Šé™ï¼Œä¿ç•™ä¸Šæ¬¡é¢˜ç›®ï¼›è¾¾ä¸Šé™åˆ™æ’é™¤ä¸Šæ¬¡é¢˜ç›®
      if (record.repeatCount >= CONFIG.maxQuestionRepeat) {
        candidateQuestions = candidateQuestions.filter(q => q.id !== record.lastId);
      }
      const selectedQ = candidateQuestions[0];

      // æ›´æ–°è®¡æ•°
      if (selectedQ.id === record.lastId) {
        record.repeatCount++;
      } else {
        record.lastId = selectedQ.id;
        record.repeatCount = 1;
      }
      return selectedQ;
    }

    function getRandomOptions(correctKey = null, correctIdx = null) {
      const allKeys = Object.keys(CONFIG.answerImages);
      let finalOptions = [];
      if (correctKey) {
        const otherKeys = allKeys.filter(key => key !== correctKey);
        const randomOthers = shuffleArray(otherKeys).slice(0, 3);
        finalOptions = shuffleArray([...randomOthers, correctKey]);
      } else if (correctIdx !== null) {
        const imgKeys = ['img1', 'img2', 'img3', 'img4'];
        finalOptions = shuffleArray(imgKeys);
      } else {
        finalOptions = shuffleArray(allKeys).slice(0, 4);
      }
      return finalOptions;
    }

    function unlockAchievement(achievementId) {
      if (gameState.unlockedAchievements.has(achievementId)) return;
      gameState.unlockedAchievements.add(achievementId);
      localStorage.setItem('unlockedAchievements', JSON.stringify(Array.from(gameState.unlockedAchievements)));
      renderAchievementWall();
      const achievement = CONFIG.achievements[achievementId];
      showMessage(`è§£é”æˆå°±ï¼š${achievement.name}`, 'win');
    }

    function showMessage(text, type = 'normal') {
      el.messageBox.textContent = text;
      el.messageBox.className = `message-box msg-${type}`;
    }

    function toggleModal(modal, show) {
      if (show) {
        modal.classList.remove('hidden-cls');
        document.body.style.overflow = 'hidden';
      } else {
        modal.classList.add('hidden-cls');
        document.body.style.overflow = 'auto';
      }
    }

    function showScorePopup(score) {
      if (gameState.triggeredScorePopups.has(score)) return;
      gameState.triggeredScorePopups.add(score);
      if (score === 50) showMessage('å·²è·å¾—50åˆ†ï¼ç¦»æ»¡åˆ†ä¸è¿œäº†', 'win');
      if (score === CONFIG.maxScore) {
        showMessage('æ»¡åˆ†ï¼è§£é”ã€Œå¤©é€‰ç”·åŒğŸŒˆã€æˆå°±', 'win');
        unlockAchievement('maxScore');
      }
    }

    // ========== æ¸¸æˆæ ¸å¿ƒé€»è¾‘ ==========
    function initGame() {
      bindAllEvents();
      handleImageError(el.adCoverGif, 'å¹¿å‘Šå°é¢');
      renderAchievementWall();
      resetGame();
    }

    function bindAllEvents() {
      // æ¸¸æˆæŒ‰é’®ï¼šæ”¹ä¸ºtouchendè§¦å‘ï¼ˆæ¾æ‰‹ç”Ÿæ•ˆï¼‰
      el.startBtn.addEventListener('click', startGame);
      el.startBtn.addEventListener('touchend', (e) => {e.preventDefault(); startGame();}, { passive: false });

      el.resetBtn.addEventListener('click', resetGame);
      el.resetBtn.addEventListener('touchend', (e) => {e.preventDefault(); resetGame();}, { passive: false });

      el.achievementBtn.addEventListener('click', () => {
        el.achievementWall.classList.add('show');
        renderAchievementWall();
      });
      el.achievementBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        el.achievementWall.classList.add('show');
        renderAchievementWall();
      }, { passive: false });

      el.achievementWallClose.addEventListener('click', () => el.achievementWall.classList.remove('show'));
      el.achievementWallClose.addEventListener('touchend', (e) => {
        e.preventDefault();
        el.achievementWall.classList.remove('show');
      }, { passive: false });

      // é‡ç½®æˆå°±äº‹ä»¶
      el.resetAchieveBtn.addEventListener('click', () => toggleModal(el.resetAchieveModal, true));
      el.resetAchieveBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        toggleModal(el.resetAchieveModal, true);
      }, { passive: false });

      el.resetAchieveConfirm.addEventListener('click', () => {
        resetAchievements(false);
        toggleModal(el.resetAchieveModal, false);
      });
      el.resetAchieveConfirm.addEventListener('touchend', (e) => {
        e.preventDefault();
        resetAchievements(false);
        toggleModal(el.resetAchieveModal, false);
      }, { passive: false });

      el.resetAchieveYeah.addEventListener('click', () => {
        resetAchievements(true); // yeahâ™‚ä¸é‡ç½®æˆå°±
        toggleModal(el.resetAchieveModal, false);
      });
      el.resetAchieveYeah.addEventListener('touchend', (e) => {
        e.preventDefault();
        resetAchievements(true);
        toggleModal(el.resetAchieveModal, false);
      }, { passive: false });

      // ç»‘å®šå¹¿å‘Šäº‹ä»¶
      bindAdEvents();
    }

    function startGame() {
      if (gameState.isPlaying) return;
      gameState.isPlaying = true;
      gameState.round = 0;
      gameState.score = 0;
      gameState.correctCount = 0;
      gameState.wrongCount = 0;
      gameState.consecutiveImg1Count = 0;
      gameState.consecutiveNotImg3Count = 0;
      gameState.consecutiveNotAdams = 0;
      gameState.questionRecord = { lastId: -1, repeatCount: 0 };
      gameState.positionRecord = { lastPos: -1, repeatCount: 0 };
      el.scoreNum.textContent = '0';
      nextRound();
    }

    function nextRound() {
      clearInterval(gameState.timer);
      // æ›¿æ¢ä¸ºä¸é‡å¤é¢˜ç›®
      gameState.currentQuestion = getNonRepeatQuestion();
      gameState.round++;
      gameState.timeLeft = CONFIG.timeLimit;
      el.questionText.textContent = gameState.currentQuestion.text;
      el.roundNum.textContent = gameState.round;
      el.timerNum.textContent = `${gameState.timeLeft}s`;
      showMessage('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ', 'normal');
      renderOptions();
      gameState.timer = setInterval(() => {
        gameState.timeLeft--;
        el.timerNum.textContent = `${gameState.timeLeft}s`;
        if (gameState.timeLeft <= 0) {
          clearInterval(gameState.timer);
          // å€’è®¡æ—¶ç»“æŸæ–‡å­—ä¿®æ”¹
          showMessage('æ…¢æ­»äº† æ‚é±¼âˆ ( á› ã€âˆ )_', 'lose');
          gameState.wrongCount++;
          gameState.consecutiveImg1Count = 0;
          gameState.consecutiveNotImg3Count = 0;
          gameState.consecutiveNotAdams = 0;
          gameState.positionRecord = { lastPos: -1, repeatCount: 0 };
          setTimeout(() => gameState.isPlaying && nextRound(), 1500);
        }
      }, 1000);
    }

    function renderOptions() {
      el.optionsGrid.innerHTML = '';
      const q = gameState.currentQuestion;
      let options = [];
      if (q.type === 'single-key') options = getRandomOptions(q.correct);
      else if (q.type === 'single') options = getRandomOptions(null, q.correctIdx);
      else options = getRandomOptions();

      options.forEach((key, index) => {
        const optionItem = document.createElement('div');
        optionItem.className = 'option-item';
        optionItem.dataset.key = key;
        optionItem.dataset.index = index + 1; // ä½ç½®ç´¢å¼•1-4

        const img = document.createElement('img');
        img.src = CONFIG.answerImages[key];
        img.alt = key;
        img.className = 'option-img';
        handleImageError(img, key);
        optionItem.appendChild(img);

        // é€‰é¡¹æ”¹ä¸ºtouchendè§¦å‘ï¼ˆæ¾æ‰‹ç”Ÿæ•ˆï¼‰
        optionItem.addEventListener('click', handleOptionClick);
        optionItem.addEventListener('touchend', (e) => {
          e.preventDefault();
          handleOptionClick.call(optionItem);
        }, { passive: false });

        el.optionsGrid.appendChild(optionItem);
      });
    }
function handleOptionClick() {
      if (!gameState.isPlaying) return;
      clearInterval(gameState.timer);
      gameState.isPlaying = false;

      const selectedKey = this.dataset.key;
      const selectedIndex = Number(this.dataset.index);
      const q = gameState.currentQuestion;
      let isCorrect = false;
      let resultMsg = '';

      // ========== æ–°å¢ï¼šé€‰é¡¹ä½ç½®è®¡æ•° ==========
      const posRecord = gameState.positionRecord;
      if (selectedIndex === posRecord.lastPos) {
        posRecord.repeatCount++;
        if (posRecord.repeatCount > 10) {
          showMessage('ä¸è®¸æˆ³äº†ï¼ï¼ï¼', 'normal');
        }
      } else {
        posRecord.lastPos = selectedIndex;
        posRecord.repeatCount = 1;
      }

      // ========== åŸæœ‰ç­”é¢˜é€»è¾‘ ==========
      if (q.type === 'single-key') {
        isCorrect = selectedKey === q.correct;
        resultMsg = isCorrect ? q.msgWin : q.msgLose;

        // ========== æ–°å¢ï¼šæœå—é¢˜ç›®é€‰é”™img4è§¦å‘æˆå°± ==========
        if (q.id === 6 && selectedKey === 'img4' && !isCorrect) {
          unlockAchievement('heLovesYou');
        }
      } else if (q.type === 'single') {
        isCorrect = (selectedKey === `img${q.correctIdx + 1}`);
        resultMsg = isCorrect ? q.onCorrect : q.onWrong;
      } else if (q.type === 'special' || q.type === 'multi-text') {
        const res = q.onSelect(selectedIndex - 1);
        isCorrect = res.ok;
        resultMsg = res.msg;
      }

      // ========== æ–°å¢ï¼šæ»¡åˆ†åä»…æ˜¾ç¤ºæŒ‡å®šæ–‡å­— ==========
      if (gameState.score === CONFIG.maxScore) {
        resultMsg = 'å·²ç»...æ»¡äº†...â™‚â™‚â™‚';
      }

      if (isCorrect) {
        gameState.correctCount++;
        gameState.score += CONFIG.scorePerCorrect;
        if (gameState.score > CONFIG.maxScore) gameState.score = CONFIG.maxScore;
        el.scoreNum.textContent = gameState.score;
        showMessage(resultMsg, 'win');
        if (gameState.score === 50 || gameState.score === CONFIG.maxScore) showScorePopup(gameState.score);
        if (q.achievement) unlockAchievement(q.achievement);

        // è¿ç»­é€‰æ‹©ç»Ÿè®¡ï¼ˆæˆå°±ç”¨ï¼‰
        if (selectedKey === 'img1') gameState.consecutiveImg1Count++;
        else gameState.consecutiveImg1Count = 0;

        if (selectedKey !== 'img3') gameState.consecutiveNotImg3Count++;
        else gameState.consecutiveNotImg3Count = 0;

        if (selectedKey !== 'Adams') gameState.consecutiveNotAdams++;
        else gameState.consecutiveNotAdams = 0;

        // è¿ç»­é€‰æ‹©æˆå°±åˆ¤å®š
        if (gameState.consecutiveImg1Count >= 4) unlockAchievement('forceful');
        if (gameState.consecutiveNotImg3Count >= 4) unlockAchievement('forgotWho');
        if (gameState.consecutiveNotAdams >= 5) unlockAchievement('witheredGrass');
      } else {
        gameState.wrongCount++;
        showMessage(resultMsg, 'lose');
        gameState.consecutiveImg1Count = 0;
        gameState.consecutiveNotImg3Count = 0;
        gameState.consecutiveNotAdams = 0;
      }

      setTimeout(() => {
        gameState.isPlaying = true;
        nextRound();
      }, 1500);
    }

    function resetGame() {
      clearInterval(gameState.timer);
      gameState = {
        isPlaying: false,
        currentQuestion: null,
        score: 0,
        round: 0,
        timeLeft: 0,
        timer: null,
        correctCount: 0,
        wrongCount: 0,
        consecutiveImg1Count: 0,
        consecutiveNotImg3Count: 0,
        consecutiveNotAdams: 0,
        firstChooseChaonan: false,
        hasGotPBrother: false,
        unlockedAchievements: gameState.unlockedAchievements,
        triggeredScorePopups: new Set(),
        adImgRecord: { original: { lastImg: '', repeatCount: 0 }, new: { lastImg: '', repeatCount: 0 } },
        questionRecord: { lastId: -1, repeatCount: 0 },
        positionRecord: { lastPos: -1, repeatCount: 0 }
      };
      el.scoreNum.textContent = '0';
      el.timerNum.textContent = '--';
      el.roundNum.textContent = '0';
      el.questionText.textContent = 'å‡†å¤‡å¼€å§‹æ¸¸æˆ';
      el.optionsGrid.innerHTML = '';
      showMessage('ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜', 'normal');
    }

    // ========== é‡ç½®æˆå°±é€»è¾‘ä¿®æ”¹ï¼šyeahâ™‚ä¸é‡ç½® ==========
    function resetAchievements(isYeah) {
      if (!isYeah) {
        gameState.unlockedAchievements.clear();
        localStorage.removeItem('unlockedAchievements');
      }
      // æ— è®ºæ˜¯å¦é‡ç½®éƒ½è§£é”omgæˆå°±
      if (!gameState.unlockedAchievements.has('omg')) {
        unlockAchievement('omg');
      }
      renderAchievementWall();
      showMessage(isYeah ? 'è§£é”éšè—æˆå°±ï¼' : 'æˆå°±å·²é‡ç½®', 'normal');
    }

    // æˆå°±å¢™æ¸²æŸ“ï¼šæœªè¾¾æˆä»…æ˜¾ç¤ºåç§°
    function renderAchievementWall() {
      el.achievementList.innerHTML = '';
      Object.entries(CONFIG.achievements).forEach(([id, achievement]) => {
        const isUnlocked = gameState.unlockedAchievements.has(id);
        const isHidden = achievement.hidden || false;
        const item = document.createElement('div');
        item.className = `achievement-item ${isUnlocked ? 'unlocked' : ''} ${isHidden ? 'hidden' : ''}`;
        item.innerHTML = `
          <h3 class="achievement-name">${isUnlocked ? 'âœ…' : 'ğŸ”’'} ${achievement.name}</h3>
          <p class="achievement-desc">${achievement.desc}</p>
          <p class="achievement-method">${achievement.method}</p>
        `;
        el.achievementList.appendChild(item);
      });
    }

    // ========== å¹¿å‘Šé€»è¾‘ä¿®æ”¹ï¼šå›¾ç‰‡æœ€å¤šé‡å¤2æ¬¡ ==========
    function bindAdEvents() {
      // åŸæœ‰å¹¿å‘Šå…³é—­
      el.originalAdClose.addEventListener('click', () => toggleModal(el.adConfirmModal, true));
      el.originalAdClose.addEventListener('touchend', (e) => {
        e.preventDefault();
        toggleModal(el.adConfirmModal, true);
      }, { passive: false });

      // åŸæœ‰å¹¿å‘Šç‚¹å‡»
      el.originalAdCta.addEventListener('click', () => {
        showRandomAdImg('original');
      });
      el.originalAdCta.addEventListener('touchend', (e) => {
        e.preventDefault();
        showRandomAdImg('original');
      }, { passive: false });

      // æ–°å¹¿å‘Šå…³é—­
      el.newAdClose.addEventListener('click', () => {
        el.newAd.style.display = 'none';
        showMessage('å·²å…³é—­æ¢è£…å¹¿å‘Š', 'normal');
      });
      el.newAdClose.addEventListener('touchend', (e) => {
        e.preventDefault();
        el.newAd.style.display = 'none';
        showMessage('å·²å…³é—­æ¢è£…å¹¿å‘Š', 'normal');
      }, { passive: false });

      // æ–°å¹¿å‘Šç‚¹å‡»ï¼ˆå¸•å­—å›¾ç‰‡å±•ç¤ºï¼‰
      el.newAdCta.addEventListener('click', () => {
        showRandomAdImg('new');
        unlockAchievement('fashionIcon');
      });
      el.newAdCta.addEventListener('touchend', (e) => {
        e.preventDefault();
        showRandomAdImg('new');
        unlockAchievement('fashionIcon');
      }, { passive: false });

      // å¹¿å‘Šå¼¹çª—ç¡®è®¤æŒ‰é’®
      el.adConfirmBtn.addEventListener('click', () => {
        toggleModal(el.adConfirmModal, false);
        showRandomAdImg('original');
      });
      el.adConfirmBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        toggleModal(el.adConfirmModal, false);
        showRandomAdImg('original');
      }, { passive: false });

      // å¹¿å‘Šå¼¹çª—å–æ¶ˆæŒ‰é’®
      el.adCancelBtn.addEventListener('click', () => {
        toggleModal(el.adConfirmModal, false);
        el.originalAd.style.display = 'none';
        showMessage('å·²å…³é—­å¹¿å‘Šä¸“åŒº', 'normal');
      });
      el.adCancelBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        toggleModal(el.adConfirmModal, false);
        el.originalAd.style.display = 'none';
        showMessage('å·²å…³é—­å¹¿å‘Šä¸“åŒº', 'normal');
      }, { passive: false });

      // å¹¿å‘Šå›¾ç‰‡å¼¹çª—å…³é—­
      el.adImgCloseBtn.addEventListener('click', () => {
        toggleModal(el.adImgModal, false);
      });
      el.adImgCloseBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        toggleModal(el.adImgModal, false);
      }, { passive: false });

      // ç‚¹å‡»ç©ºç™½å¤„å…³é—­å¹¿å‘Šå¼¹çª—
      el.adImgModal.addEventListener('click', (e) => {
        if (e.target === el.adImgModal) {
          toggleModal(el.adImgModal, false);
        }
      });
    }

    // å¹¿å‘Šå›¾ç‰‡éšæœºå±•ç¤ºï¼šæœ€å¤šé‡å¤2æ¬¡
    function showRandomAdImg(type) {
      const selectedImg = getNonRepeatAdImg(type);

      el.adImgContent.innerHTML = `<img src="${selectedImg}" alt="å¹¿å‘Šå›¾">`;
      const img = el.adImgContent.querySelector('img');
      handleImageError(img, 'å¹¿å‘Šå›¾');

      toggleModal(el.adImgModal, true);

      // Schilleræˆå°±åˆ¤å®š
      if (type === 'original' && selectedImg === CONFIG.adMaterials.original[0]) {
        unlockAchievement('schiller');
      }
    }

    // åˆå§‹åŒ–æ¸¸æˆ
    document.addEventListener('DOMContentLoaded', initGame);
  </script>
</body>
</html>