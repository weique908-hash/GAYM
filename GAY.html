<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>ç­”é¢˜æŒ‘æˆ˜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      font-family: "Helvetica Neue", Arial, sans-serif;
      pointer-events: auto !important;
    }
    body {
      background: #121212;
      color: #ffffff;
      min-height: 100vh;
      padding: 16px;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    .game-container {
      max-width: 500px;
      margin: 0 auto;
      background: #1e1e1e;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      position: relative;
      z-index: 10;
    }
    .game-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .game-title {
      font-size: 22px;
      color: #ffd700;
      margin-bottom: 8px;
    }
    .game-subtitle {
      font-size: 14px;
      color: #aaaaaa;
    }
    .question-area {
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .question-text {
      font-size: 18px;
      color: #ffffff;
      text-align: center;
      margin-bottom: 8px;
    }
    .round-info {
      font-size: 14px;
      color: #888888;
      text-align: right;
    }
    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .option-item {
      background: #2d2d2d;
      border-radius: 12px;
      padding: 8px;
      aspect-ratio: 1/1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.2s;
      min-height: 120px;
      z-index: 15;
      position: relative;
    }
    .option-item:active, .option-item:focus {
      border-color: #ffd700;
      outline: none;
    }
    .option-img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    .img-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #888888;
      font-size: 14px;
      background: #333333;
      border-radius: 8px;
    }
    .status-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 12px;
      background: #2d2d2d;
      border-radius: 12px;
    }
    .status-item {
      text-align: center;
    }
    .status-label {
      font-size: 12px;
      color: #888888;
      margin-bottom: 4px;
    }
    .status-value {
      font-size: 20px;
      color: #ffd700;
      font-weight: bold;
    }
    .btn-group {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }
    .game-btn {
      flex: 1;
      padding: 16px 0;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      touch-action: manipulation;
      min-height: 48px;
      z-index: 999;
      position: relative;
    }
    .btn-primary {
      background: #ffd700;
      color: #121212;
    }
    .btn-secondary {
      background: #444444;
      color: #ffffff;
    }
    .game-btn:active {
      opacity: 0.8;
    }
    .message-box {
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
      font-size: 16px;
    }
    .msg-win {
      background: #006400;
      color: #ffffff;
    }
    .msg-lose {
      background: #8b0000;
      color: #ffffff;
    }
    .msg-normal {
      background: #2d2d2d;
      color: #aaaaaa;
    }
    .ad-section {
      margin-bottom: 16px;
      padding: 16px;
      background: #2d2d2d;
      border-radius: 12px;
      position: relative;
      animation: adFlash 1.5s infinite alternate;
      z-index: 15;
    }
    @keyframes adFlash {
      from { opacity: 1; }
      to { opacity: 0.8; box-shadow: 0 0 15px rgba(255, 99, 71, 0.5); }
    }
    .ad-close-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      position: relative;
    }
    .ad-title {
      font-size: 16px;
      color: #ffd700;
      margin-bottom: 12px;
      text-align: center;
    }
    .ad-cover {
      width: 100%;
      height: 120px;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .ad-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .ad-cta {
      display: block;
      width: 100%;
      padding: 12px 0;
      background: #ff6347;
      color: #ffffff;
      text-align: center;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      margin-top: 8px;
      z-index: 999;
      position: relative;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 20px;
    }
    .modal-container {
      background: #1e1e1e;
      border-radius: 16px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
      z-index: 110;
    }
    .modal-title {
      font-size: 20px;
      color: #ffd700;
      text-align: center;
      margin-bottom: 20px;
    }
    .modal-btn-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    .modal-btn {
      flex: 1;
      padding: 12px 0;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      z-index: 120;
      position: relative;
    }
    .ad-img-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
    }
    .ad-img-content {
      max-width: 90%;
      max-height: 80%;
      border-radius: 12px;
      overflow: hidden;
      z-index: 210;
    }
    .ad-img-content img {
      width: 100%;
      height: auto;
    }
    .ad-img-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 220;
      position: relative;
    }
    .achievement-wall {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #121212;
      z-index: 300;
      padding: 20px;
      overflow-y: auto;
      display: none;
    }
    .achievement-wall.show {
      display: block;
    }
    .achievement-wall-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .achievement-wall-title {
      font-size: 22px;
      color: #ffd700;
    }
    .achievement-close-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #8b0000;
      color: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 20px;
      z-index: 310;
      position: relative;
    }
    .achievement-item {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 4px solid #ffd700;
    }
    .achievement-name {
      font-size: 18px;
      color: #ffffff;
      margin-bottom: 4px;
    }
    .achievement-desc {
      font-size: 14px;
      color: #aaaaaa;
      margin-bottom: 4px;
    }
    .achievement-method {
      font-size: 12px;
      color: #ff6347;
      display: none;
    }
    .achievement-item.unlocked .achievement-method {
      display: block;
    }
    .achievement-item.hidden {
      border-left-color: #9932cc;
    }
    .hidden {
      display: none !important;
    }
    audio {
      display: none;
    }
  </style>
</head>
<body>
  <!-- éŸ³é¢‘å…ƒç´ ï¼ˆå›½å†…å¯è®¿é—®å…è´¹é“¾æ¥ï¼Œæ— éœ€æœ¬åœ°æ–‡ä»¶ï¼‰ -->
  <audio id="gameBGM" src="https://music.163.com/song/media/outer/url?id=1395427736.mp3" preload="auto" loop>
  <audio id="ad1BGM" src="https://music.163.com/song/media/outer/url?id=1407552309.mp3" preload="auto" loop>
  <audio id="ad2BGM" src="https://music.163.com/song/media/outer/url?id=1868277153.mp3" preload="auto" loop>
  <audio id="correctSound" src="https://freesound.org/data/previews/580/580470_11750506-lq.mp3" preload="auto">
  <audio id="wrongSound" src="https://freesound.org/data/previews/342/342746_6103102-lq.mp3" preload="auto">

  <!-- æ¸¸æˆä¸»å®¹å™¨ -->
  <div class="game-container">
    <div class="game-header">
      <h1 class="game-title">ç­”é¢˜æŒ‘æˆ˜</h1>
      <p class="game-subtitle">ç‚¹å‡»æ­£ç¡®é€‰é¡¹ï¼Œèµ¢å–åˆ†æ•°</p>
    </div>

    <div class="question-area">
      <p class="question-text" id="questionText">å‡†å¤‡å¼€å§‹æ¸¸æˆ</p>
      <p class="round-info">å…³å¡: <span id="roundNum">0</span></p>
    </div>

    <div class="options-grid" id="optionsGrid"></div>

    <div class="message-box msg-normal" id="messageBox">ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜</div>

    <div class="status-bar">
      <div class="status-item">
        <p class="status-label">åˆ†æ•°</p>
        <p class="status-value" id="scoreNum">0</p>
      </div>
      <div class="status-item">
        <p class="status-label">å€’è®¡æ—¶</p>
        <p class="status-value" id="timerNum">--</p>
      </div>
    </div>

    <div class="btn-group">
      <button class="game-btn btn-primary" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="resetBtn">é‡ç½®æ¸¸æˆ</button>
      <button class="game-btn btn-secondary" id="achievementBtn">æˆå°±å¢™</button>
      <button class="game-btn btn-secondary" id="resetAchieveBtn">é‡ç½®æˆå°±</button>
    </div>

    <!-- åŸæœ‰å¹¿å‘ŠåŒºåŸŸ -->
    <div class="ad-section" id="originalAd">
      <button class="ad-close-btn" id="originalAdClose">Ã—</button>
      <h3 class="ad-title">å¿«â¤ï¸è¿›â¤ï¸æ¥â¤ï¸</h3>
      <div class="ad-cover">
        <img src="å¹¿å‘Šå°é¢.gif" alt="å¹¿å‘Šå°é¢" id="adCoverGif">
      </div>
      <a href="javascript:;" class="ad-cta" id="originalAdCta">ç‚¹å‡»æŸ¥çœ‹éšæœºå¹¿å‘Šå›¾</a>
    </div>

    <!-- æ–°å¹¿å‘ŠåŒºåŸŸ -->
    <div class="ad-section" id="newAd">
      <button class="ad-close-btn" id="newAdClose">Ã—</button>
      <h3 class="ad-title">â™‚â™‚ç«çƒ­æ¢è£…  åœ¨çº¿æ¼«ç”»â™‚â™‚</h3>
      <a href="javascript:;" class="ad-cta" id="newAdCta">ç‚¹å‡»æŸ¥çœ‹ç²¾å½©å†…å®¹</a>
    </div>
  </div>

  <!-- å¹¿å‘Šå…³é—­ç¡®è®¤å¼¹çª— -->
  <div class="modal-overlay hidden" id="adConfirmModal">
    <div class="modal-container">
      <h3 class="modal-title">ä¸è¿›æ¥çœ‹çœ‹å—ï¼Ÿ</h3>
      <div class="modal-btn-group">
        <button class="modal-btn btn-primary" id="adConfirmBtn">å¥½å§ï¼Œæ¥äº†â¤ï¸</button>
        <button class="modal-btn btn-secondary" id="adCancelBtn">å‘ƒâ†“ï¼Œæˆ‘æ˜¯ç›´ç”·</button>
      </div>
    </div>
  </div>

  <!-- é‡ç½®æˆå°±ç¡®è®¤å¼¹çª— -->
  <div class="modal-overlay hidden" id="resetAchieveModal">
    <div class="modal-container">
      <h3 class="modal-title">æ˜¯å¦é‡ç½®æˆå°±ï¼Ÿ</h3>
      <div class="modal-btn-group">
        <button class="modal-btn btn-primary" id="resetAchieveConfirm">æ˜¯</button>
        <button class="modal-btn btn-secondary" id="resetAchieveYeah">yeahâ™‚</button>
      </div>
    </div>
  </div>

  <!-- å¹¿å‘Šå›¾ç‰‡å¼¹çª— -->
  <div class="ad-img-modal hidden" id="adImgModal">
    <button class="ad-img-close" id="adImgCloseBtn">Ã—</button>
    <div class="ad-img-content" id="adImgContent"></div>
  </div>

  <!-- æˆå°±å¢™ -->
  <div class="achievement-wall" id="achievementWall">
    <div class="achievement-wall-header">
      <h2 class="achievement-wall-title">æˆå°±å¢™</h2>
      <button class="achievement-close-btn" id="achievementWallClose">Ã—</button>
    </div>
    <div id="achievementList"></div>
  </div>

  <script>
// ========== é…ç½®é¡¹ ==========
    const CONFIG = {
      answerImages: {
        'é…’é¦†ä¼™è®¡': 'é…’é¦†ä¼™è®¡.png',
        'å®‹': 'å®‹.jpg',
        'æœå—': 'æœå—.jpg',
        'Adams': 'Adams.jpg',
        'æ­£ç»è¡£æœ': 'æ­£ç»è¡£æœ.jpg',
        'img1': 'img1.jpg',
        'img2': 'img2.jpg',
        'img3': 'img3.jpg',
        'img4': 'img4.jpg',
        'æ©™å¸•': 'æ©™å¸•.jpg',
        'æ½®ç”·å¸•': 'æ½®ç”·å¸•.jpg',
        'æ½®ç”·å¸•çš„åèƒŒ': 'æ½®ç”·å¸•çš„åèƒŒ.jpg'
      },
      adMaterials: {
        original: ['å¹¿å‘Š.png', 'å¹¿å‘Š2.jpg', 'å¹¿å‘Š3.jpg'],
        new: ['æ©™å¸•.jpg', 'æ½®ç”·å¸•.jpg', 'æ½®ç”·å¸•çš„åèƒŒ.jpg'],
        cover: 'å¹¿å‘Šå°é¢.gif'
      },
      questions: [
        {id:0,text:'æ‰¾å‡ºé‡Œé¢æ‰€æœ‰ç”·åŒ',type:'special',onSelect:()=>({ok:false,msg:'å“ˆå“ˆéª—ä½ çš„ï¼Œæˆ‘åªè®¾ç½®äº†å•é€‰'})},
        {id:1,text:'æ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆ',type:'single',correctIdx:0,onCorrect:'ä½ çœ‹èµ·æ¥å¾ˆå¥½åƒ',onWrong:'Cazzoï¼Œä½ ä¸è®¤è¯†æˆ‘å—',achievement:'chef'},
        {id:2,text:'æ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ',type:'single',correctIdx:3,onCorrect:'éš”å£ä»–ç”·äººåœ¨åŒæŒing',onWrong:'å†é€‰é”™å°±è¿‡æ¥å¿ƒç†æ²»ç–—',achievement:'therapist'},
        {id:3,text:'æ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·',type:'multi-text',onSelect:(idx)=>{if(idx===0||idx===1){unlockAchievement('straight');return{ok:true,msg:'ğŸ’æˆ‘ä»¬æ˜¯çœŸæ­£çš„â™‚ç›´ç”·â™‚å‘€'};}else{unlockAchievement('gayPride');return{ok:true,msg:'ğŸŒˆğŸŒˆğŸŒˆéª„å‚²ä¹‹â™‚GAYğŸŒˆğŸŒˆğŸŒˆ'};}}},
        {id:4,text:'è°æ²¡æœ‰å¯¹è±¡ï¼Ÿ',type:'single-key',correct:'é…’é¦†ä¼™è®¡',msgWin:'å›ç­”æ­£ç¡®ï¼',msgLose:'å›ç­”é”™è¯¯ï¼',achievement:'pBrother'},
        {id:5,text:'é€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€‚',type:'single-key',correct:'å®‹',msgWin:'å®‹é…±å®‹é…±æˆ‘ä»¬å–œæ¬¢ä½ â¤ï¸',msgLose:'å¥½åƒä¹Ÿæ²¡é”™...',achievement:'deepWaterCity'},
        {id:6,text:'å¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿ',type:'single-key',correct:'æœå—',msgWin:'æœå“¥è¯·è¡¨æ¼”ä¸€ä¸‹é‚£ä¸ªï¼ğŸ’°ğŸ’°ğŸ’°',msgLose:'ä¸ï¼Œè¿™ä½åº”è¯¥ä¸ä¼šç»™ä½ é’±ã€‚',achievement:'goldCoin'},
        {id:7,text:'ä½ å¥½ã€‚è¯·å¬·â€”â€”',type:'single-key',correct:'Adams',msgWin:'â€œæˆ‘å¯æ˜¯ç›´ç”·å‘€ï¼â€',msgLose:'è¯¶ï¼Ÿé‚£ä¹Ÿä¸é”™ã€‚'}
      ],
      achievements: {
        straight: {name:'æˆ‘æ˜¯ç›´ç”·',desc:'å‹‡æ•¢æ‰¿è®¤è‡ªå·±çš„èº«ä»½',method:'é€‰æ‹©ã€Œæ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·ã€é¢˜ç›®ä¸­çš„ç›´ç”·é€‰é¡¹'},
        gayPride: {name:'éª„å‚²ä¹‹GAY',desc:'ä¸ºè‡ªå·±çš„èº«ä»½æ„Ÿåˆ°éª„å‚²',method:'é€‰æ‹©ã€Œæ‰¾å‡ºå›¾ä¸­çš„ç›´ç”·ã€é¢˜ç›®ä¸­çš„GAYé€‰é¡¹'},
        chef: {name:'ä½ æ˜¯é£Ÿæå—',desc:'æ‰¾åˆ°çœŸæ­£çš„å¨å¸ˆ',method:'æ­£ç¡®å›ç­”ã€Œæ‰¾å‡ºçœŸæ­£çš„å¨å¸ˆã€é¢˜ç›®'},
        therapist: {name:'å¿ƒç†æ²»ç–—å¸ˆ',desc:'æ‰¾åˆ°å¤±å»çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆ',method:'æ­£ç¡®å›ç­”ã€Œæ‰¾å‡ºå¤±å»äº†çƒæ£çš„å¿ƒç†æ²»ç–—å¸ˆã€é¢˜ç›®'},
        maxScore: {name:'å¤©é€‰ç”·åŒğŸŒˆ',desc:'è¾¾åˆ°æ»¡åˆ†100åˆ†',method:'åœ¨æ¸¸æˆä¸­è·å¾—100åˆ†'},
        forgotWho: {name:'å¥½åƒå¿˜äº†è°...',desc:'æ€»è§‰å¾—æ¼æ‰äº†ä»€ä¹ˆé‡è¦çš„äºº',method:'è¿ç»­4æ¬¡ä¸é€‰æ‹©img3.jpgå›¾ç‰‡'},
        forceful: {name:'å¼ºäººæ‰€éš¾â™‚',desc:'å¯¹æŸä¸ªé€‰é¡¹æœ‰ç€æ‰§ç€çš„åçˆ±',method:'è¿ç»­4æ¬¡é€‰æ‹©img1.jpgå›¾ç‰‡'},
        omg: {name:'OMGâ™‚',desc:'ä½ å‘ç°äº†éšè—çš„ç§˜å¯†ï¼',method:'é‡ç½®æˆå°±æ—¶é€‰æ‹©"yeahâ™‚"é€‰é¡¹',hidden:true},
        pBrother: {name:'P...På¼Ÿï¼Ÿ',desc:'åœ¨ã€Œè°æ²¡æœ‰å¯¹è±¡ï¼Ÿã€é—®é¢˜ä¸­é€‰æ‹©é…’é¦†ä¼™è®¡',method:'å›ç­”ã€Œè°æ²¡æœ‰å¯¹è±¡ï¼Ÿã€é—®é¢˜å¹¶é€‰æ‹©é…’é¦†ä¼™è®¡'},
        witheredGrass: {name:'ç”Ÿå‘½ä¸ºä½•è‡ªç§°æ¯è‰ï¼Ÿ',desc:'è¿ç»­5æ¬¡ä¸é€‰æ‹©Adams',method:'ç­”é¢˜æ—¶è¿ç»­5æ¬¡ä¸é€‰Adamså›¾ç‰‡'},
        heLovesYou: {name:'ä»–è¯´ä»–çˆ±ä½ ã€‚',desc:'æœå—é—®é¢˜ä¸­é€‰æ‹©ç¬¬4å¼ å›¾ç‰‡',method:'å›ç­”ã€Œå¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿã€æ—¶é€‰ç¬¬4ä¸ªé€‰é¡¹'},
        goldCoin: {name:'çˆ†ç‚¹é‡‘å¸ï¼Ÿ',desc:'ç¬¬ä¸€æ¬¡é€‰æ‹©æœå—å¹¶ç­”å¯¹',method:'é¦–æ¬¡å›ç­”ã€Œå¤§å¯Œå“¥æ˜¯å“ªä½ï¼Ÿã€æ—¶é€‰å¯¹æœå—'},
        deepWaterCity: {name:'æ·±æ°´åŸæ•…äº‹',desc:'æ­£ç¡®å›ç­”ã€Œé€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€',method:'ç­”å¯¹ã€Œé€‰å‡ºçœŸçš„ä¸æ˜¯ç›´ç”·çš„äººã€é—®é¢˜'},
        fashionIcon: {name:'è¡£å“è¾¾äººâ¤ï¸',desc:'ç‚¹å¼€æ–°æ·»åŠ çš„å¹¿å‘Š',method:'ç‚¹å‡»ã€Œâ™‚â™‚ç«çƒ­æ¢è£…ã€å¹¿å‘Šå¹¶æŸ¥çœ‹'},
        schiller: {name:'Schiller.',desc:'ç‚¹å¼€åŸæœ‰å¹¿å‘Šå¹¶çœ‹åˆ°æŒ‡å®šå›¾ç‰‡',method:'ç‚¹å‡»åŸæœ‰å¹¿å‘Šä¸”éšæœºåˆ°ç¬¬ä¸€å¼ å¹¿å‘Šå›¾æ—¶è§£é”'}
      },
      timeLimit: 8,
      scorePerCorrect: 5,
      maxScore: 100
    };

    // ========== å…¨å±€çŠ¶æ€ ==========
    let gameState = {
      isPlaying: false,
      currentQuestion: null,
      score: 0,
      round: 0,
      timeLeft: 0,
      timer: null,
      correctCount: 0,
      wrongCount: 0,
      consecutiveImg1Count: 0,
      consecutiveNotImg3Count: 0,
      consecutiveNotAdams: 0,
      firstChooseChaonan: false,
      hasGotPBrother: false,
      unlockedAchievements: new Set(JSON.parse(localStorage.getItem('unlockedAchievements')) || []),
      triggeredScorePopups: new Set()
    };

    // ========== DOMå…ƒç´  ==========
    const el = {
      gameBGM: document.getElementById('gameBGM'),
      ad1BGM: document.getElementById('ad1BGM'),
      ad2BGM: document.getElementById('ad2BGM'),
      correctSound: document.getElementById('correctSound'),
      wrongSound: document.getElementById('wrongSound'),
      questionText: document.getElementById('questionText'),
      roundNum: document.getElementById('roundNum'),
      optionsGrid: document.getElementById('optionsGrid'),
      messageBox: document.getElementById('messageBox'),
      scoreNum: document.getElementById('scoreNum'),
      timerNum: document.getElementById('timerNum'),
      startBtn: document.getElementById('startBtn'),
      resetBtn: document.getElementById('resetBtn'),
      achievementBtn: document.getElementById('achievementBtn'),
      resetAchieveBtn: document.getElementById('resetAchieveBtn'),
      originalAd: document.getElementById('originalAd'),
      originalAdClose: document.getElementById('originalAdClose'),
      originalAdCta: document.getElementById('originalAdCta'),
      newAd: document.getElementById('newAd'),
      newAdClose: document.getElementById('newAdClose'),
      newAdCta: document.getElementById('newAdCta'),
      adCoverGif: document.getElementById('adCoverGif'),
      adConfirmModal: document.getElementById('adConfirmModal'),
      adConfirmBtn: document.getElementById('adConfirmBtn'),
      adCancelBtn: document.getElementById('adCancelBtn'),
      adImgModal: document.getElementById('adImgModal'),
      adImgCloseBtn: document.getElementById('adImgCloseBtn'),
      adImgContent: document.getElementById('adImgContent'),
      resetAchieveModal: document.getElementById('resetAchieveModal'),
      resetAchieveConfirm: document.getElementById('resetAchieveConfirm'),
      resetAchieveYeah: document.getElementById('resetAchieveYeah'),
      achievementWall: document.getElementById('achievementWall'),
      achievementWallClose: document.getElementById('achievementWallClose'),
      achievementList: document.getElementById('achievementList')
    };
// ========== éŸ³é¢‘æ§åˆ¶ï¼ˆæ‰‹æœºç«¯å…¼å®¹ï¼‰ ==========
    function playAudio(audioEl) {
      audioEl.currentTime = 0;
      // ç§»åŠ¨ç«¯å¼ºåˆ¶ç”¨æˆ·äº¤äº’åæ’­æ”¾
      audioEl.play().catch(err => {
        document.body.addEventListener('click', () => audioEl.play(), { once: true });
      });
    }

    function playGameBGM() {
      el.gameBGM.pause();
      el.ad1BGM.pause();
      el.ad2BGM.pause();
      playAudio(el.gameBGM);
    }

    function playAd1BGM() {
      el.gameBGM.pause();
      el.ad2BGM.pause();
      playAudio(el.ad1BGM);
    }

    function playAd2BGM() {
      el.gameBGM.pause();
      el.ad1BGM.pause();
      playAudio(el.ad2BGM);
    }

    function playCorrectSound() {
      playAudio(el.correctSound);
    }

    function playWrongSound() {
      playAudio(el.wrongSound);
    }

    // ========== å·¥å…·å‡½æ•° ==========
    function handleImageError(img, altText) {
      img.onerror = () => {
        img.parentElement.innerHTML = `<div class="img-placeholder">${altText}<br>åŠ è½½å¤±è´¥</div>`;
      };
    }

    function shuffleArray(arr) {
      const newArr = [...arr];
      for (let i = newArr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
      }
      return newArr;
    }

    function getRandomOptions(correctKey = null, correctIdx = null) {
      const allKeys = Object.keys(CONFIG.answerImages);
      let finalOptions = [];
      if (correctKey) {
        const otherKeys = allKeys.filter(key => key !== correctKey);
        const randomOthers = shuffleArray(otherKeys).slice(0, 3);
        finalOptions = shuffleArray([...randomOthers, correctKey]);
      } else if (correctIdx !== null) {
        const imgKeys = ['img1', 'img2', 'img3', 'img4'];
        finalOptions = shuffleArray(imgKeys);
      } else {
        finalOptions = shuffleArray(allKeys).slice(0, 4);
      }
      return finalOptions;
    }

    function unlockAchievement(achievementId) {
      if (gameState.unlockedAchievements.has(achievementId)) return;
      gameState.unlockedAchievements.add(achievementId);
      localStorage.setItem('unlockedAchievements', JSON.stringify(Array.from(gameState.unlockedAchievements)));
      renderAchievementWall();
      const achievement = CONFIG.achievements[achievementId];
      showMessage(`è§£é”æˆå°±ï¼š${achievement.name}`, 'win');
    }

    function showMessage(text, type = 'normal') {
      el.messageBox.textContent = text;
      el.messageBox.className = `message-box msg-${type}`;
    }

    function toggleModal(modal, show) {
      if (show) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      } else {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    }

    function showScorePopup(score) {
      if (gameState.triggeredScorePopups.has(score)) return;
      gameState.triggeredScorePopups.add(score);
      if (score === 50) showMessage('å·²è·å¾—50åˆ†ï¼ç¦»æ»¡åˆ†ä¸è¿œäº†', 'win');
      if (score === CONFIG.maxScore) {
        showMessage('æ»¡åˆ†ï¼è§£é”ã€Œå¤©é€‰ç”·åŒğŸŒˆã€æˆå°±', 'win');
        unlockAchievement('maxScore');
      }
    }

    // ========== æ¸¸æˆæ ¸å¿ƒé€»è¾‘ ==========
    function initGame() {
      bindAllEvents();
      handleImageError(el.adCoverGif, 'å¹¿å‘Šå°é¢');
      renderAchievementWall();
      resetGame();
      // æ‰‹æœºç«¯é¦–æ¬¡ç‚¹å‡»æ¿€æ´»éŸ³é¢‘
      document.body.addEventListener('click', () => {
        el.gameBGM.load();
        el.ad1BGM.load();
        el.ad2BGM.load();
      }, { once: true });
    }

    function bindAllEvents() {
      // æ¸¸æˆæŒ‰é’®ï¼ˆåŒäº‹ä»¶ç»‘å®š+å…œåº•onclickï¼‰
      el.startBtn.addEventListener('click', startGame);
      el.startBtn.addEventListener('touchstart', (e) => {e.preventDefault(); startGame();}, { passive: false });
      el.startBtn.onclick = startGame;

      el.resetBtn.addEventListener('click', resetGame);
      el.resetBtn.addEventListener('touchstart', (e) => {e.preventDefault(); resetGame();}, { passive: false });
      el.resetBtn.onclick = resetGame;

      el.achievementBtn.addEventListener('click', () => {
        el.achievementWall.classList.add('show');
        renderAchievementWall();
      });
      el.achievementBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        el.achievementWall.classList.add('show');
        renderAchievementWall();
      }, { passive: false });
      el.achievementBtn.onclick = () => {
        el.achievementWall.classList.add('show');
        renderAchievementWall();
      };

      el.achievementWallClose.addEventListener('click', () => el.achievementWall.classList.remove('show'));
      el.achievementWallClose.addEventListener('touchstart', (e) => {
        e.preventDefault();
        el.achievementWall.classList.remove('show');
      }, { passive: false });
      el.achievementWallClose.onclick = () => el.achievementWall.classList.remove('show');

      // é‡ç½®æˆå°±
      el.resetAchieveBtn.addEventListener('click', () => toggleModal(el.resetAchieveModal, true));
      el.resetAchieveBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        toggleModal(el.resetAchieveModal, true);
      }, { passive: false });
      el.resetAchieveBtn.onclick = () => toggleModal(el.resetAchieveModal, true);

      el.resetAchieveConfirm.addEventListener('click', () => {
        resetAchievements(false);
        toggleModal(el.resetAchieveModal, false);
      });
      el.resetAchieveConfirm.addEventListener('touchstart', (e) => {
        e.preventDefault();
        resetAchievements(false);
        toggleModal(el.resetAchieveModal, false);
      }, { passive: false });
      el.resetAchieveConfirm.onclick = () => {
        resetAchievements(false);
        toggleModal(el.resetAchieveModal, false);
      };

      el.resetAchieveYeah.addEventListener('click', () => {
        resetAchievements(true);
        toggleModal(el.resetAchieveModal, false);
      });
      el.resetAchieveYeah.addEventListener('touchstart', (e) => {
        e.preventDefault();
        resetAchievements(true);
        toggleModal(el.resetAchieveModal, false);
      }, { passive: false });
      el.resetAchieveYeah.onclick = () => {
        resetAchievements(true);
        toggleModal(el.resetAchieveModal, false);
      };

      // å¹¿å‘Šäº‹ä»¶
      bindAdEvents();
    }

    function startGame() {
      if (gameState.isPlaying) return;
      gameState.isPlaying = true;
      gameState.round = 0;
      gameState.score = 0;
      gameState.correctCount = 0;
      gameState.wrongCount = 0;
      gameState.consecutiveImg1Count = 0;
      gameState.consecutiveNotImg3Count = 0;
      el.scoreNum.textContent = '0';
      playGameBGM(); // æ’­æ”¾æ¸¸æˆBGM
      nextRound();
    }

    function nextRound() {
      clearInterval(gameState.timer);
      gameState.currentQuestion = shuffleArray(CONFIG.questions)[0];
      gameState.round++;
      gameState.timeLeft = CONFIG.timeLimit;
      el.questionText.textContent = gameState.currentQuestion.text;
      el.roundNum.textContent = gameState.round;
      el.timerNum.textContent = `${gameState.timeLeft}s`;
      showMessage('è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ', 'normal');
      renderOptions();
      gameState.timer = setInterval(() => {
        gameState.timeLeft--;
        el.timerNum.textContent = `${gameState.timeLeft}s`;
        if (gameState.timeLeft <= 0) {
          clearInterval(gameState.timer);
          showMessage('æ—¶é—´åˆ°ï¼å›ç­”é”™è¯¯', 'lose');
          playWrongSound();
          gameState.wrongCount++;
          gameState.consecutiveImg1Count = 0;
          gameState.consecutiveNotImg3Count = 0;
          gameState.consecutiveNotAdams = 0;
          setTimeout(() => gameState.isPlaying && nextRound(), 1500);
        }
      }, 1000);
    }

    function renderOptions() {
      el.optionsGrid.innerHTML = '';
      const q = gameState.currentQuestion;
      let options = [];
      if (q.type === 'single-key') options = getRandomOptions(q.correct);
      else if (q.type === 'single') options = getRandomOptions(null, q.correctIdx);
      else options = getRandomOptions();

      options.forEach((key, index) => {
        const optionItem = document.createElement('div');
        optionItem.className = 'option-item';
        optionItem.dataset.key = key;
        optionItem.dataset.index = index + 1;

        const img = document.createElement('img');
        img.src = CONFIG.answerImages[key];
        img.alt = key;
        img.className = 'option-img';
        handleImageError(img, key);
        optionItem.appendChild(img);

        // é€‰é¡¹ç‚¹å‡»ï¼ˆåŒäº‹ä»¶+å…œåº•ï¼‰
        optionItem.addEventListener('click', handleOptionClick);
        optionItem.addEventListener('touchstart', (e) => {
          e.preventDefault();
          handleOptionClick.call(optionItem);
        }, { passive: false });
        optionItem.onclick = handleOptionClick.bind(optionItem);

        el.optionsGrid.appendChild(optionItem);
      });
    }
function handleOptionClick() {
      if (!gameState.isPlaying) return;
      clearInterval(gameState.timer);
      gameState.isPlaying = false;

      const selectedKey = this.dataset.key;
      const selectedIndex = Number(this.dataset.index);
      const q = gameState.currentQuestion;
      let isCorrect = false;
      let resultMsg = '';

      if (q.type === 'single-key') {
        isCorrect = selectedKey === q.correct;
        resultMsg = isCorrect ? q.msgWin : q.msgLose;
      } else if (q.type === 'single') {
        isCorrect = (selectedKey === `img${q.correctIdx + 1}`);
        resultMsg = isCorrect ? q.onCorrect : q.onWrong;
      } else if (q.type === 'special' || q.type === 'multi-text') {
        const res = q.onSelect(selectedIndex - 1);
        isCorrect = res.ok;
        resultMsg = res.msg;
      }

      // æ’­æ”¾éŸ³æ•ˆ
      isCorrect ? playCorrectSound() : playWrongSound();

      if (isCorrect) {
        gameState.correctCount++;
        gameState.score += CONFIG.scorePerCorrect;
        if (gameState.score > CONFIG.maxScore) gameState.score = CONFIG.maxScore;
        el.scoreNum.textContent = gameState.score;
        showMessage(resultMsg, 'win');
        if (gameState.score === 50 || gameState.score === CONFIG.maxScore) showScorePopup(gameState.score);
        if (q.achievement) unlockAchievement(q.achievement);
      } else {
        gameState.wrongCount++;
        showMessage(resultMsg, 'lose');
        gameState.consecutiveImg1Count = 0;
        gameState.consecutiveNotImg3Count = 0;
        gameState.consecutiveNotAdams = 0;
      }

      // æˆå°±åˆ¤æ–­
      if (selectedKey === 'img1') {
        gameState.consecutiveImg1Count++;
        if (gameState.consecutiveImg1Count >= 4) {
          unlockAchievement('forceful');
          gameState.consecutiveImg1Count = 0;
        }
      } else gameState.consecutiveImg1Count = 0;

      if (selectedKey !== 'img3') {
        gameState.consecutiveNotImg3Count++;
        if (gameState.consecutiveNotImg3Count >= 4) {
          unlockAchievement('forgotWho');
          gameState.consecutiveNotImg3Count = 0;
        }
      } else gameState.consecutiveNotImg3Count = 0;

      if (q.id === 4 && selectedKey === 'é…’é¦†ä¼™è®¡' && !gameState.hasGotPBrother) {
        unlockAchievement('pBrother');
        gameState.hasGotPBrother = true;
      }

      if (selectedKey !== 'Adams') {
        gameState.consecutiveNotAdams++;
        if (gameState.consecutiveNotAdams >= 5) {
          unlockAchievement('witheredGrass');
          gameState.consecutiveNotAdams = 0;
        }
      } else gameState.consecutiveNotAdams = 0;

      if (q.id === 6 && selectedIndex === 4) unlockAchievement('heLovesYou');
      if (q.id === 6 && isCorrect && !gameState.firstChooseChaonan) {
        unlockAchievement('goldCoin');
        gameState.firstChooseChaonan = true;
      }
      if (q.id === 5 && isCorrect) unlockAchievement('deepWaterCity');

      setTimeout(() => {
        gameState.isPlaying = true;
        playGameBGM();
        nextRound();
      }, 1500);
    }

    function resetGame() {
      clearInterval(gameState.timer);
      el.gameBGM.pause();
      el.ad1BGM.pause();
      el.ad2BGM.pause();
      gameState = {
        isPlaying: false,
        currentQuestion: null,
        score: 0,
        round: 0,
        timeLeft: 0,
        timer: null,
        correctCount: 0,
        wrongCount: 0,
        consecutiveImg1Count: 0,
        consecutiveNotImg3Count: 0,
        consecutiveNotAdams: 0,
        firstChooseChaonan: false,
        hasGotPBrother: false,
        unlockedAchievements: gameState.unlockedAchievements,
        triggeredScorePopups: new Set()
      };
      el.scoreNum.textContent = '0';
      el.timerNum.textContent = '--';
      el.roundNum.textContent = '0';
      el.questionText.textContent = 'å‡†å¤‡å¼€å§‹æ¸¸æˆ';
      el.optionsGrid.innerHTML = '';
      showMessage('ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€å¼€å§‹æŒ‘æˆ˜', 'normal');
    }

    function resetAchievements(isYeah) {
      gameState.unlockedAchievements.clear();
      localStorage.removeItem('unlockedAchievements');
      renderAchievementWall();
      showMessage('æˆå°±å·²é‡ç½®', 'normal');
      if (isYeah) unlockAchievement('omg');
    }

    function renderAchievementWall() {
      el.achievementList.innerHTML = '';
      Object.entries(CONFIG.achievements).forEach(([id, achievement]) => {
        const isUnlocked = gameState.unlockedAchievements.has(id);
        const isHidden = achievement.hidden || false;
        const item = document.createElement('div');
        item.className = `achievement-item ${isUnlocked ? 'unlocked' : ''} ${isHidden ? 'hidden' : ''}`;
        item.innerHTML = `
          <h3 class="achievement-name">${isUnlocked ? 'âœ…' : 'ğŸ”’'} ${achievement.name}</h3>
          <p class="achievement-desc">${achievement.desc}</p>
          <p class="achievement-method">è§£é”æ–¹æ³•ï¼š${achievement.method}</p>
        `;
        el.achievementList.appendChild(item);
      });
    }

    // ========== å¹¿å‘Šé€»è¾‘ï¼ˆä¿®å¤Schilleræˆå°±ï¼‰ ==========
    function bindAdEvents() {
      // åŸæœ‰å¹¿å‘Šå…³é—­
      el.originalAdClose.addEventListener('click', () => toggleModal(el.adConfirmModal, true));
      el.originalAdClose.addEventListener('touchstart', (e) => {
        e.preventDefault();
        toggleModal(el.adConfirmModal, true);
      }, { passive: false });
      el.originalAdClose.onclick = () => toggleModal(el.adConfirmModal, true);

      // åŸæœ‰å¹¿å‘ŠCTA
      el.originalAdCta.addEventListener('click', () => {
        showRandomAdImg('original');
        playAd1BGM();
      });
      el.originalAdCta.addEventListener('touchstart', (e) => {
        e.preventDefault();
        showRandomAdImg('original');
        playAd1BGM();
      }, { passive: false });
      el.originalAdCta.onclick = () => {
        showRandomAdImg('original');
        playAd1BGM();
      };

      // æ–°å¹¿å‘Šå…³é—­
      el.newAdClose.addEventListener('click', () => {
        el.newAd.style.display = 'none';
        showMessage('å·²å…³é—­æ¢è£…å¹¿å‘Š', 'normal');
        if (gameState.isPlaying) playGameBGM();
      });
      el.newAdClose.addEventListener('touchstart', (e) => {
        e.preventDefault();
        el.newAd.style.display = 'none';
        showMessage('å·²å…³é—­æ¢è£…å¹¿å‘Š', 'normal');
        if (gameState.isPlaying) playGameBGM();
      }, { passive: false });
      el.newAdClose.onclick = () => {
        el.newAd.style.display = 'none';
        showMessage('å·²å…³é—­æ¢è£…å¹¿å‘Š', 'normal');
        if (gameState.isPlaying) playGameBGM();
      };

      // æ–°å¹¿å‘ŠCTA
      el.newAdCta.addEventListener('click', () => {
        showRandomAdImg('new');
        playAd2BGM();
      });
      el.newAdCta.addEventListener('touchstart', (e) => {
        e.preventDefault();
        showRandomAdImg('new');
        playAd2BGM();
      }, { passive: false });
      el.newAdCta.onclick = () => {
        showRandomAdImg('new');
        playAd2BGM();
      };

      // å¹¿å‘Šç¡®è®¤å¼¹çª—
      el.adConfirmBtn.addEventListener('click', () => {
        toggleModal(el.adConfirmModal, false);
        showRandomAdImg('original');
        playAd1BGM();
      });
      el.adConfirmBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        toggleModal(el.adConfirmModal, false);
        showRandomAdImg('original');
        playAd1BGM();
      }, { passive: false });
      el.adConfirmBtn.onclick = () => {
        toggleModal(el.adConfirmModal, false);
        showRandomAdImg('original');
        playAd1BGM();
      };

      el.adCancelBtn.addEventListener('click', () => {
        toggleModal(el.adConfirmModal, false);
        el.originalAd.style.display = 'none';
        showMessage('å·²å…³é—­å¹¿å‘Šä¸“åŒº', 'normal');
      });
      el.adCancelBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        toggleModal(el.adConfirmModal, false);
        el.originalAd.style.display = 'none';
        showMessage('å·²å…³é—­å¹¿å‘Šä¸“åŒº', 'normal');
      }, { passive: false });
      el.adCancelBtn.onclick = () => {
        toggleModal(el.adConfirmModal, false);
        el.originalAd.style.display = 'none';
        showMessage('å·²å…³é—­å¹¿å‘Šä¸“åŒº', 'normal');
      };

      // å¹¿å‘Šå›¾ç‰‡å¼¹çª—å…³é—­
      el.adImgCloseBtn.addEventListener('click', () => {
        toggleModal(el.adImgModal, false);
        if (gameState.isPlaying) playGameBGM();
      });
      el.adImgCloseBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        toggleModal(el.adImgModal, false);
        if (gameState.isPlaying) playGameBGM();
      }, { passive: false });
      el.adImgCloseBtn.onclick = () => {
        toggleModal(el.adImgModal, false);
        if (gameState.isPlaying) playGameBGM();
      };

      // ç‚¹å‡»ç©ºç™½å¤„å…³é—­å¹¿å‘Šå¼¹çª—
      el.adImgModal.addEventListener('click', (e) => {
        if (e.target === el.adImgModal) {
          toggleModal(el.adImgModal, false);
          if (gameState.isPlaying) playGameBGM();
        }
      });
    }

    // Schilleræˆå°±ï¼šä»…éšæœºåˆ°ç¬¬ä¸€å¼ å¹¿å‘Šå›¾æ—¶è§£é”
    function showRandomAdImg(type) {
      const adImgs = type === 'original' ? CONFIG.adMaterials.original : CONFIG.adMaterials.new;
      const randomImg = shuffleArray(adImgs)[0];

      el.adImgContent.innerHTML = `<img src="${randomImg}" alt="å¹¿å‘Šå›¾">`;
      const img = el.adImgContent.querySelector('img');
      handleImageError(img, 'å¹¿å‘Šå›¾');

      toggleModal(el.adImgModal, true);

      // æˆå°±è§£é”
      if (type === 'original' && randomImg === CONFIG.adMaterials.original[0]) {
        unlockAchievement('schiller');
      } else if (type === 'new') {
        unlockAchievement('fashionIcon');
      }
    }

    // åˆå§‹åŒ–ï¼ˆDOMåŠ è½½å®Œæˆåæ‰§è¡Œï¼‰
    document.addEventListener('DOMContentLoaded', initGame);
  </script>
</body>
</html>